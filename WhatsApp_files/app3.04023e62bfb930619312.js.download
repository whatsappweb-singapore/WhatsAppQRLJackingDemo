/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([66],{'"bieaecaddi"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ATTACH_MEDIA_STATE=void 0;var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bebcachjfd"'),b=n(y),T=i('"biafgdghfb"'),E=a(T),M=i('"dafchjdebe"'),C=n(M),S=i('"ecjafdibeh"'),j=i('"cehbbagije"'),k=n(j),A=i('"cfddajhbjb"'),P=n(A),w=i('"djeidhfjae"'),O=i('"bjjbbjfiee"'),I={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=I;var L=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,y.prop)(),a.file=(0,y.prop)(),a.uiProcessed=(0,y.prop)(),a.fileOrigin=(0,y.prop)(),a.state=(0,y.session)(),a.mediaPrep=(0,y.session)(),a.mimetype=(0,y.session)(),a.processPromise=(0,y.session)(),a.exception=(0,y.session)(),a.chat=(0,y.session)(),a.caption=(0,y.session)(),a.type=(0,y.session)(O.TYPE.UNKNOWN),a.preview=(0,y.session)(),a.fullPreview=(0,y.session)(),a.fullPreviewSize=(0,y.session)(),a.filename=(0,y.session)(),a.pdfPages=(0,y.session)(),a.isGif=(0,y.session)(),a.gifAttribution=(0,y.session)(),a.previewable=(0,y.derived)(a._previewable,["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"_previewable",value:function(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case O.TYPE.DOCUMENT:return!!this.filename;case O.TYPE.IMAGE:case O.TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case O.TYPE.AUDIO:case O.TYPE.PTT:case O.TYPE.UNKNOWN:return!0;default:throw new Error("Unsupported attach media type "+this.type)}}},{key:"initialize",value:function(){if((0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"initialize",this).call(this),!(this.file instanceof s["default"]))throw new Error("cannot process non-promise file");this.processFile(this.file)}},{key:"processFile",value:function(e){this.state=I.PROCESSING,this.processPromise=this._processFilePromiseHelper(e)}},{key:"_processFilePromiseHelper",value:function(e){var t=this;return e.then(function(e){t.set(e);var i={},a=e.file,n=e.isGif,r=e.gifAttribution;n?(i.asGif=n,i.gifAttribution=r):e.type===S.FILETYPE.DOCUMENT&&(i.asDocument=!0);var s=P["default"].createFromData(a,a.type),o=(0,w.prepRawMedia)(s,i);return t.set({mediaPrep:o}),o.waitForPrep().then(function(e){var i=e.documentPreview,a=window.URL.createObjectURL(e.mediaBlob),n={file:e.mediaBlob,fullPreview:a,type:e.type,filename:e.filename,mimetype:e.mimetype,preview:e.preview,state:I.READY,isGif:e.isGif,fullPreviewSize:void 0,pdfPages:void 0};e.fullWidth&&e.fullHeight&&(n.fullPreviewSize={height:e.fullHeight,width:e.fullWidth}),e.type===O.TYPE.IMAGE&&(n.preview=a),e.type===O.TYPE.DOCUMENT&&i&&(n.fullPreview=i.url,n.preview=i.thumbUrl,n.fullPreviewSize={height:i.height,width:i.width},n.pdfPages=i.pdfPages),t.set(n),k["default"].assert(t.previewable,"AttachMedia processFile","Invariant violated, processed file is not previewable")()})})["catch"](E.InvalidMediaFileType,E.InvalidImageFileType,function(i){return t._processFilePromiseHelper(e.then(function(e){return e.type=S.FILETYPE.DOCUMENT,e}))})["catch"](C["default"],E.MediaFileFailedLoad,E.MediaFileEmpty,function(e){return t.set({exception:e,state:I.ERROR}),t})["catch"](function(e){return t.set({exception:new E.InvalidMediaFileType,state:I.ERROR}),t})}},{key:"sendToChat",value:function(e,t){if(!this.mediaPrep)throw new Error("MediaPrep not available");if(this.state===I.ERROR)throw new Error(this.exception);if(!(this.state!==I.PROCESSING||this.previewable&&t.addEvenWhilePreparing))throw new Error("Media still processing");if(this.state===I.READY)return void this.mediaPrep.sendToChat(e,t);var i={mimetype:this.mimetype};switch(this.type){case O.TYPE.VIDEO:i.isGif=this.isGif,i.gifAttribution=this.gifAttribution;case O.TYPE.IMAGE:i.width=this.fullPreviewSize.width,i.height=this.fullPreviewSize.height,i.body=this.preview,t.placeholderProps=i;break;case O.TYPE.DOCUMENT:i.pageCount=this.pdfPages,i.filename=this.filename,i.body=this.preview,t.placeholderProps=i;break;case O.TYPE.AUDIO:case O.TYPE.PTT:}this.mediaPrep.sendToChat(e,t)}},{key:"getFileType",value:function(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,S.typeFromMimetype)(this.file.type)}},{key:"delete",value:function(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this)}}]),t}(b["default"]);L.Proxy="attachMedia",t["default"]=(0,y.defineModel)(L)},'"beijgedgcc"':function(e,t){"use strict";var i={cache:{},"delete":function(){this.cache={}}};e.exports=i},'"idehabijh"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bebcachjfd"'),g=a(p),v=i('"ebhdebaagj"'),_=a(v),m=i('"bafjcjabca"'),y=a(m),b=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,p.prop)(),a.contact=(0,p.session)(),n=i,(0,c["default"])(a,n)}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"initialize",value:function(){this.addChild("contact",_["default"].Contact.gadd(this.id))}}]),t}(g["default"]);b.Collection="Blocklist",b.Proxy="blocklist",b.idClass=y["default"],t["default"]=(0,p.defineModel)(b)},'"bgabbbeeca"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"idehabijh"'),g=a(p),v=i('"bdcdfifjcj"'),_=a(v),m=i('"ebhdebaagj"'),y=a(m),b=function(e){function t(){(0,o["default"])(this,t);var e=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return e.listenTo(e,"add",e.blockContact),e.listenTo(e,"remove",e.unblockContact),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"blockContact",value:function(e,t){var i=e.id,a=y["default"].Contact.get(i);a&&(a.isContactBlocked=!0)}},{key:"unblockContact",value:function(e,t){var i=e.id,a=y["default"].Contact.get(i);a&&(a.isContactBlocked=!1)}}]),t}(_["default"]);b.model=g["default"],t["default"]=new b},'"djgdfihedd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULTS=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bebcachjfd"'),g=a(p),v=i('"bafjcjabca"'),_=a(v),m=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,p.prop)(),a.tag=(0,p.prop)(),a.address=(0,p.prop)(),a.description=(0,p.prop)(),a.vertical=(0,p.prop)(),a.email=(0,p.prop)(),a.website=(0,p.prop)(),a.latitude=(0,p.prop)(),a.longitude=(0,p.prop)(),a.businessHours=(0,p.prop)(),a.stale=(0,p.session)(!0),n=i,(0,c["default"])(a,n)}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"markStale",value:function(){this.stale=!0,this.hasObservers()&&this.find()}}]),t}(g["default"]);m.Collection="BusinessProfile",m.Proxy="businessProfile",m.idClass=_["default"],t["default"]=(0,p.defineModel)(m);t.DEFAULTS={address:null,description:null,vertical:null,email:null,website:null}},'"bbdgfgchj"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessProfileCollection=void 0;var n=i('"djecddgbji"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"cehbbagije"'),_=a(v),m=i('"djgdfihedd"'),y=a(m),b=i('"bdcdfifjcj"'),T=a(b),E=i('"dgfhfgbdeb"'),M=a(E),C=i('"bgafgbafci"'),S=a(C),j=i('"hgcadabag"'),k=t.BusinessProfileCollection=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"parseBusinessHours",value:function(e){var t=e.config,i={};return t.forEach(function(e){var t=e.day_of_week,a=e.mode;if(a===j.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){var n=e.open_time,r=e.close_time;i[t]||(i[t]={mode:a,hours:[]}),n&&r&&i[t].hours&&i[t].hours.push([n,r])}else i[t]={mode:a}}),{config:i}}},{key:"_find",value:function(e){var t=this,i=this.gadd(e);return M["default"].queryBusinessProfile([{wid:i.id,tag:i.tag}]).then(function(i){if(!Array.isArray(i))return _["default"].error("Received invalid business profile response")(i),null;if(0===i.length)return _["default"].info("Store:BusinessProfile:find No businessProfile found for "+String(e))(),{id:e};var a=i[0],n={id:a.wid,tag:a.tag},r=a.profile;if(r){var s=r.business_hours;s&&(r.business_hours=void 0,r.businessHours=t.parseBusinessHours(s)),S["default"].assign(n,m.DEFAULTS,r)}return n})}},{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.stale&&e.hasObservers()}).map(function(t){return e.find(t.id)})}},{key:"handle",value:function(e){var t=(0,r["default"])(e,1),i=t[0];i&&i.tag||_["default"].error("Store:BusinessProfile:handle Received invalid update from server")(i);var a=this.gadd(i.wid);i.tag!==a.tag&&a.markStale()}}]),t}(T["default"]);k.model=y["default"],k.staleCollection=!0,t["default"]=new k},'"hgcadabag"':function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"],t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"}},'"cfjdefbdfa"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){var i=e||"EMPTY";return t in U[i]}Object.defineProperty(t,"__esModule",{value:!0});var r,s,o,d,u,l,c=i('"cfdcajecde"'),f=a(c),h=i('"ddcedhgjff"'),p=a(h),g=i('"ebfebbhae"'),v=a(g),_=i('"cfcbddfj"'),m=a(_),y=i('"dfhdhdbidh"'),b=a(y),T=i('"bejijbfaij"'),E=a(T),M=i('"bebcachjfd"'),C=a(M),S=i('"bbcaiaajeg"'),j=a(S),k=i('"fhabbhhjc"'),A=a(k),P=i('"jfefjijii"'),w=a(P),O=i('"dhbgbihhjb"'),I=i('"bbbjcafhhg"'),L=a(I),N=i('"djdcdaecea"'),R=a(N),D=i('"caijeihhcg"'),G=a(D),F=function(e){function t(){var e,i,a,n;(0,v["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,b["default"])(this,(e=t.__proto__||(0,p["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,M.prop)(),a.peerJid=(0,M.prop)(),a.offerTime=(0,M.prop)(),a.startTime=(0,M.prop)(),a.isVideo=(0,M.prop)(!1),a.isGroupCall=(0,M.prop)(!1),a.canHandleLocally=(0,M.prop)(!1),a.outgoing=(0,M.prop)(!1),a.webClientShouldHandle=(0,M.prop)(!1),a.participants=(0,M.collection)(j["default"]),a._state=(0,M.prop)(),n=i,(0,b["default"])(a,n)}return(0,E["default"])(t,e),(0,m["default"])(t,[{key:"getState",value:function(){return this._state}},{key:"setState",value:function(e){n(this._state,e)&&(this.webClientShouldHandle||e===O.CALL_STATES.INCOMING_RING||(e=O.CALL_STATES.HANDLED_REMOTELY,L["default"].callId===this.id&&G["default"].callEndByHandledRemotely()),this._state!==O.CALL_STATES.CONNECTION_LOST&&e===O.CALL_STATES.ACTIVE&&(this.startTime=Date.now()),this._state=e,this.handleNotification(),this.potentiallyUpdateCallUi())}},{key:"handleNotification",value:function(){var e=this.getState();w["default"].tosShowCallNotification&&(e===O.CALL_STATES.INCOMING_RING?A["default"].alertCall(this.peerJid,this.id,this.isVideo,this.canHandleLocally):A["default"].cancelCall(this.peerJid))}},{key:"potentiallyUpdateCallUi",value:function(){var e=L["default"].callId===this.id;e?this.setCallUiProps():!L["default"].callId&&this.getState()===O.CALL_STATES.INCOMING_RING&&R["default"].supportsFeature(R["default"].F.VOIP_INDIVIDUAL_INCOMING)&&this.canHandleLocally&&(L["default"].callId=this.id,this.setCallUiProps())}},{key:"setCallUiProps",value:function(){L["default"].type=this.isVideo?I.CALL_TYPES.VIDEO:I.CALL_TYPES.VOICE,L["default"].state=this.getUiState(),L["default"].to=this.outgoing?this.peerJid:w["default"].me,L["default"].from=this.outgoing?w["default"].me:this.peerJid,L["default"].startTime=this.startTime,L["default"].outgoing=this.outgoing,L["default"].state===I.CALL_UI_STATES.ENDED&&(L["default"].peerBusy=!1)}},{key:"getUiState",value:function(){var e=this.getState();switch(e){case O.CALL_STATES.INCOMING_RING:return I.CALL_UI_STATES.INCOMING_RING;case O.CALL_STATES.OUTGOING_RING:return I.CALL_UI_STATES.OUTGOING_RING;case O.CALL_STATES.CONNECTING:return I.CALL_UI_STATES.CONNECTING;case O.CALL_STATES.CONNECTION_LOST:return I.CALL_UI_STATES.RECONNECTING;case O.CALL_STATES.ACTIVE:return I.CALL_UI_STATES.ACTIVE;case O.CALL_STATES.HANDLED_REMOTELY:return I.CALL_UI_STATES.NONE;case O.CALL_STATES.ENDED:return I.CALL_UI_STATES.ENDED;case O.CALL_STATES.REJECTED:return I.CALL_UI_STATES.REJECTED;case O.CALL_STATES.REMOTE_CALL_IN_PROGRESS:return I.CALL_UI_STATES.REMOTE_CALL_IN_PROGRESS;case O.CALL_STATES.FAILED:return I.CALL_UI_STATES.FAILED;default:return I.CALL_UI_STATES.NONE}}}]),t}(C["default"]);F.Collection="Call",F.Proxy="call",t["default"]=(0,M.defineModel)(F);var U={EMPTY:(r={},(0,f["default"])(r,O.CALL_STATES.INCOMING_RING,!0),(0,f["default"])(r,O.CALL_STATES.CONNECTING,!0),(0,f["default"])(r,O.CALL_STATES.REJECTED,!0),(0,f["default"])(r,O.CALL_STATES.HANDLED_REMOTELY,!0),(0,f["default"])(r,O.CALL_STATES.ENDED,!0),(0,f["default"])(r,O.CALL_STATES.FAILED,!0),r),INCOMING_RING:(s={},(0,f["default"])(s,O.CALL_STATES.HANDLED_REMOTELY,!0),(0,f["default"])(s,O.CALL_STATES.CONNECTING,!0),(0,f["default"])(s,O.CALL_STATES.ACTIVE,!0),(0,f["default"])(s,O.CALL_STATES.REJECTED,!0),(0,f["default"])(s,O.CALL_STATES.ENDED,!0),(0,f["default"])(s,O.CALL_STATES.REMOTE_CALL_IN_PROGRESS,!0),(0,f["default"])(s,O.CALL_STATES.FAILED,!0),s),OUTGOING_RING:(o={},(0,f["default"])(o,O.CALL_STATES.ACTIVE,!0),(0,f["default"])(o,O.CALL_STATES.REJECTED,!0),(0,f["default"])(o,O.CALL_STATES.ENDED,!0),(0,f["default"])(o,O.CALL_STATES.FAILED,!0),o),CONNECTING:(d={},(0,f["default"])(d,O.CALL_STATES.OUTGOING_RING,!0),(0,f["default"])(d,O.CALL_STATES.ACTIVE,!0),(0,f["default"])(d,O.CALL_STATES.ENDED,!0),(0,f["default"])(d,O.CALL_STATES.REMOTE_CALL_IN_PROGRESS,!0),(0,f["default"])(d,O.CALL_STATES.FAILED,!0),d),CONNECTION_LOST:(u={},(0,f["default"])(u,O.CALL_STATES.ACTIVE,!0),(0,f["default"])(u,O.CALL_STATES.ENDED,!0),(0,f["default"])(u,O.CALL_STATES.FAILED,!0),u),ACTIVE:(l={},(0,f["default"])(l,O.CALL_STATES.ENDED,!0),(0,f["default"])(l,O.CALL_STATES.FAILED,!0),(0,f["default"])(l,O.CALL_STATES.CONNECTION_LOST,!0),l),HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{}}},'"dgbfgjhfih"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"dhbgbihhjb"'),_=i('"gaigjdbia"'),m=i('"bgafgbafci"'),y=a(m),b=i('"cfjdefbdfa"'),T=a(b),E=i('"bbbjcafhhg"'),M=a(E),C=i('"cehbbagije"'),S=a(C),j=i('"cjgaefccab"'),k=i('"bdcdfifjcj"'),A=a(k),P=i('"caijeihhcg"'),w=a(P),O=i('"bffeacbdd"'),I=a(O),L=function(e){function t(){var e,i,a,n;(0,u["default"])(this,t);for(var r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(s))),a.pendingOffers={},a.pendingVoipCapChecks={},n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"handleQuery",value:function(e){return r["default"].resolve()}},{key:"handle",value:function(e){var t=this,i=e.shift();if(i.data){var a=I["default"].parseCallSignalingMsg(i);if(!a)return;var n=a.call_id,s=void 0,o=null,d=null,u=null;switch(a.type){case _.TYPE.OFFER:s=v.CALL_STATES.INCOMING_RING,o=a.isVideoCall,d=a.isGroupCall,u=a.t,w["default"].isInitialized()&&(this.pendingVoipCapChecks[n]=(0,P.checkVoipCapability)(y["default"].assign({},a)),this.pendingOffers[n]=r["default"].sit("receivedKey",function(e){return I["default"].receiveCallOfferKey(e,a),a}).endWithControls("receivedKey"));break;case _.TYPE.OFFER_RECEIPT:s=v.CALL_STATES.CONNECTING;break;case _.TYPE.PREACCEPT:s=v.CALL_STATES.OUTGOING_RING;break;case _.TYPE.ACCEPT_RECEIPT:s=v.CALL_STATES.ACTIVE;break;case _.TYPE.ACCEPT:s=v.CALL_STATES.ACTIVE;break;case _.TYPE.REJECT:this.cleanupPendingOffer(a.call_id),s=v.CALL_STATES.REJECTED;break;case _.TYPE.TERMINATE:s=v.CALL_STATES.ENDED,M["default"].callId===n&&w["default"].endCall(),this.cleanupPendingOffer(n)}this.pendingVoipCapChecks[n]?this.pendingVoipCapChecks[n].then(function(e){var r=void 0;r=!d&&(o?e&&(0,j.supportsVideoCalling)():e),t.processIncomingCall(n,i.from,s,{isVideo:o,isGroupCall:d,canHandleLocally:r,offerTime:u}),r&&t.pendingOffers[n]?t.pendingOffers[n].then(function(){w["default"].handleIncomingSignalingMessage(a)}):t.cleanupPendingOffer(n)})["finally"](function(){delete t.pendingVoipCapChecks[n]}):this.pendingOffers[n]?(this.processIncomingCall(n,i.from,s),this.pendingOffers[n].then(function(){w["default"].handleIncomingSignalingMessage(a)})):(this.processIncomingCall(n,i.from,s,{isVideo:o,isGroupCall:d,canHandleLocally:!1,offerTime:u}),w["default"].isInitialized()&&w["default"].handleIncomingSignalingMessage(a))}else{var l=void 0;switch(i.type){case"offer_key":var c=this.pendingOffers[i.id];c?c.control.receivedKey(i.key):S["default"].warn("received offer_key: no pending offer")();break;case"accept":l=v.CALL_STATES.ACTIVE,this.cleanupPendingOffer(i.id);break;case"reject":l=v.CALL_STATES.REJECTED,this.cleanupPendingOffer(i.id);break;case"terminate":l=v.CALL_STATES.ENDED,this.cleanupPendingOffer(i.id)}this.processIncomingCall(i.id,void 0,l)}}},{key:"processIncomingCall",value:function(e,t,i,a){if(i){var n={id:e};null!=t&&(n.peerJid=t),a&&(a=y["default"].omitBy(a,function(e){return null==e}),y["default"].merge(n,a)),this.add(n,{merge:!0});var r=this.assertGet(e);r.setState(i)}}},{key:"cleanupPendingOffer",value:function(e){delete this.pendingOffers[e]}}]),t}(A["default"]);L.model=T["default"],t["default"]=new L},'"hgiheeefg"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.callId=(0,f.prop)(),a.isIncoming=(0,f.prop)(!1),a.isRinging=(0,f.prop)(!1),a.isInterrupted=(0,f.prop)(!1),a.isMuted=(0,f.prop)(!1),a.isTrafficStopped=(0,f.prop)(!1),a.isInvitingToGroupCall=(0,f.prop)(!1),a.isVideoStopped=(0,f.prop)(!1),a.isVideoPaused=(0,f.prop)(!1),a.isVideoDecodePaused=(0,f.prop)(!1),a.isVideoDecodeStarted=(0,f.prop)(!1),a.isOfferingVideoUpgrade=(0,f.prop)(!1),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);p.Proxy="callParticipant",t["default"]=(0,f.defineModel)(p)},'"bbcaiaajeg"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bgafgbafci"'),h=a(f),p=i('"hgiheeefg"'),g=a(p),v=i('"bdcdfifjcj"'),_=a(v),m=function(e){function t(){return(0,o["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,c["default"])(t,e),t}(_["default"]);m.model=g["default"],m.comparator=function(e,t){return e.id===t.id?0:h["default"].lt(e.id,t.id)?-1:1},t["default"]=m},'"cdddhdbhhc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_TYPES=t.CALL_UI_STATES=void 0;var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"bebcachjfd"'),_=a(v),m=t.CALL_UI_STATES={NONE:"NONE",OUTGOING_RING:"OUTGOING_RING",INCOMING_RING:"INCOMING_RING",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED"},y=(t.CALL_TYPES={VOICE:"VOICE",VIDEO:"VIDEO"},function(e){function t(){var e,i,a,n;(0,u["default"])(this,t);for(var r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(s))),a.callId=(0,v.session)(),a.state=(0,v.session)(m.NONE),a.from=(0,v.session)(),a.to=(0,v.session)(),a.type=(0,v.session)(),a.muted=(0,v.session)(),a.peerMuted=(0,v.session)(),a.speaker=(0,v.session)(),a.outgoing=(0,v.session)(),a.startTime=(0,v.session)(),a.showFullscreenCallView=(0,v.session)(!1),a.showCallStatusBar=(0,v.session)(!1),a.externalInputAvailable=(0,v.session)(),a.interrupted=(0,v.session)(),a.peerBusy=(0,v.session)(),a.peerVideoState=(0,v.session)(),n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"onStateChange",value:function(){}},{key:"onAudioOutputChange",value:function(){}},{key:"overrideOutputRoute",value:function(e){return r["default"].resolve()}}]),t}(_["default"]));y.Proxy="callUi",t["default"]=y},'"bbbjcafhhg"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_UI_STATES=t.CALL_TYPES=t.OUTPUT_DEVICES=void 0;var n=i('"bebcachjfd"'),r=i('"bghdgegcca"'),s=i('"cdddhdbhhc"'),o=a(s);t.OUTPUT_DEVICES=r.OUTPUT_DEVICES,t.CALL_TYPES=s.CALL_TYPES,t.CALL_UI_STATES=s.CALL_UI_STATES;var d=(0,n.defineModel)(o["default"]);t["default"]=new d},'"dejhjidfgh"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var i=e.pin||0,a=t.pin||0;if(i||a)return i!==a?i>a?-1:1:e.id.toString()<t.id.toString()?-1:1;var n=e.t||0,r=t.t||0;return n!==r?n>r?-1:1:e.id.toString()<t.id.toString()?-1:1}function s(e,t){switch(t){case"text":return e.type===F["default"].MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===F["default"].MSG_TYPE.IMAGE;case"video":return e.type===F["default"].MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===F["default"].MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===F["default"].MSG_TYPE.AUDIO;case"ptt":return e.type===F["default"].MSG_TYPE.PTT;case"document":return e.type===F["default"].MSG_TYPE.DOCUMENT;case"location":return e.type===F["default"].MSG_TYPE.LOCATION;case"vcard":return e.type===F["default"].MSG_TYPE.VCARD||e.type===F["default"].MSG_TYPE.MULTI_VCARD;case"url":return e.type===F["default"].MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===F["default"].MSG_TYPE.STICKER;case void 0:return!1;default:return!1}}function o(e){return new pe["default"].WebcMessageQuery({webcResponseBytes:0,webcMessageCount:0,webcTextMessageCount:0,webcVideoMessageCount:0,webcPhotoMessageCount:0,webcAudioMessageCount:0,webcPttMessageCount:0,webcStickerMessageCount:0,webcDocumentMessageCount:0,webcOtherMessageCount:0,webcMessageQueryTrigger:e})}function d(e,t){e.webcMessageCount+=t.length;for(var i=0,a=t[i];i<t.length;++i,a=t[i])switch(a.type){case G.MSG_TYPE.CHAT:case G.MSG_TYPE.LOCATION:case G.MSG_TYPE.PAYMENT:case G.MSG_TYPE.VCARD:case G.MSG_TYPE.CIPHERTEXT:case G.MSG_TYPE.MULTI_VCARD:case G.MSG_TYPE.REVOKED:case G.MSG_TYPE.OVERSIZED:e.webcTextMessageCount+=1;break;case G.MSG_TYPE.IMAGE:e.webcPhotoMessageCount+=1;break;case G.MSG_TYPE.VIDEO:e.webcVideoMessageCount+=1;break;case G.MSG_TYPE.AUDIO:e.webcAudioMessageCount+=1;break;case G.MSG_TYPE.PTT:e.webcPttMessageCount+=1;break;case G.MSG_TYPE.STICKER:e.webcStickerMessageCount+=1;break;case G.MSG_TYPE.DOCUMENT:e.webcDocumentMessageCount+=1;break;default:e.webcOtherMessageCount+=1}}Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_KIND=void 0;var u=i('"dghibdgiba"'),l=n(u),c=i('"cfdcajecde"'),f=n(c),h=i('"ecejadjgjf"'),p=n(h),g=i('"cdehffajbd"'),v=n(g),_=i('"ddcedhgjff"'),m=n(_),y=i('"ebfebbhae"'),b=n(y),T=i('"cfcbddfj"'),E=n(T),M=i('"dfhdhdbidh"'),C=n(M),S=i('"cdfdhedgig"'),j=n(S),k=i('"bejijbfaij"'),A=n(k);t.ChatComparator=r;var P=i('"biafgdghfb"'),w=a(P),O=i('"bgfahifgbh"'),I=a(O),L=i('"bgafgbafci"'),N=n(L),R=i('"ifeajjdda"'),D=n(R),G=i('"deijabejja"'),F=n(G),U=i('"cdhdbfibgi"'),x=n(U),Y=i('"ebbfhbdfgd"'),B=n(Y),V=i('"ddebcfiabb"'),q=n(V),H=i('"bhchacaadd"'),W=n(H),K=i('"eagaagffca"'),z=n(K),Q=i('"jidadafab"'),J=n(Q),X=i('"fhabbhhjc"'),Z=n(X),$=i('"jfefjijii"'),ee=n($),te=i('"djgdgcgjh"'),ie=n(te),ae=i('"cfafceedhd"'),ne=n(ae),re=i('"bgcgghjida"'),se=n(re),oe=i('"djdcdaecea"'),de=n(oe),ue=i('"bfchcffjhf"'),le=n(ue),ce=i('"cehbbagije"'),fe=n(ce),he=i('"dacbaddbce"'),pe=n(he),ge=i('"bjjbbjfiee"'),ve=n(ge),_e=i('"bidieaecca"'),me=n(_e),ye=i('"dhjiafjcai"'),be=n(ye),Te=i('"ecdjibbjgf"'),Ee=n(Te),Me=i('"dhcbeegjcf"'),Ce=n(Me),Se=i('"bgaddigcjb"'),je=n(Se),ke=i('"dafgbfehgf"'),Ae=n(ke),Pe=i('"ebhdebaagj"'),we=n(Pe),Oe=i('"djddhaidag"'),Ie=n(Oe),Le=i('"cggjbbfigd"'),Ne=n(Le),Re=i('"jjjaidhci"'),De=n(Re),Ge=i('"hcddbeaic"'),Fe=n(Ge),Ue=i('"bafjcjabca"'),xe=n(Ue),Ye=i('"dgfhfgbdeb"'),Be=n(Ye),Ve=i('"cgdjeaccg"'),qe=n(Ve),He=i('"dfahgfjgfj"'),We=n(He),Ke=i('"jfijghaad"'),ze=n(Ke),Qe=i('"chddjeicgh"'),Je=n(Qe),Xe=i('"ciehgcaebf"'),Ze=i('"cjcecfehgh"'),$e=i('"bebcachjfd"'),et=i('"djeidhfjae"'),tt=3e5,it={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"};t.CHAT_KIND=it;var at=function(e){function t(){var e,i,a,n;(0,b["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,C["default"])(this,(e=t.__proto__||(0,m["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,$e.prop)(),a.t=(0,$e.prop)(),a.unreadCount=(0,$e.prop)(0),a.archive=(0,$e.prop)(),a.isReadOnly=(0,$e.prop)(),a.isAnnounceGrpRestrict=(0,$e.prop)(),a.modifyTag=(0,$e.prop)(),a.muteExpiration=(0,$e.prop)(0),a.name=(0,$e.prop)(),a.notSpam=(0,$e.prop)(),a.pin=(0,$e.prop)(),a.changeNumberOldJid=(0,$e.prop)(),a.changeNumberNewJid=(0,$e.prop)(),a.lastReceivedKey=(0,$e.prop)(),a.createdLocally=(0,$e.session)(),a.pendingAction=(0,$e.session)(),a.formattedTitle=(0,$e.session)(),a.active=(0,$e.session)(),a.pausedTimerId=(0,$e.session)(),a.presenceResendTimerId=(0,$e.session)(),a.recording=(0,$e.session)(),a.typing=(0,$e.session)(),a.colors=(0,$e.session)(),a.composeContents=(0,$e.session)(function(){return{}}),a.composeAttachMediaContents=(0,$e.session)(),a.squelch=(0,$e.session)(),a.pendingSeenCount=(0,$e.session)(0),a.unreadMsgAnchor=(0,$e.session)(),a.markedUnread=(0,$e.session)(),a.trusted=(0,$e.session)(),a.canSend=(0,$e.session)(),a.promises=(0,$e.session)(function(){return{}}),a.ftsCache=(0,$e.session)(function(){return{}}),a.composeQuotedMsg=(0,$e.session)(),a.composeQuotedMsgRemoteJid=(0,$e.session)(),a.quotedMsgAdminGroupJid=(0,$e.session)(),a.groupMetadata=(0,$e.session)(),a.presence=(0,$e.session)(),a.mute=(0,$e.session)(),a.contact=(0,$e.session)(),a.liveLocation=(0,$e.session)(),a.liveLocationQueried=(0,$e.session)(!1),a.ackedProps=(0,$e.session)(function(){return{}}),a.mediaCount=(0,$e.session)(0),a.linkCount=(0,$e.session)(0),a.docCount=(0,$e.session)(0),a.vcardDismissed=(0,$e.session)(!1),a.kind=(0,$e.derived)(a._kind),a.isUser=(0,$e.derived)(a._isUser),a.isPSA=(0,$e.derived)(a._isPSA),a.isGroup=(0,$e.derived)(a._isGroup),a.isBroadcast=(0,$e.derived)(a._isBroadcast),a.hasUnread=(0,$e.derived)(a._hasUnread,["unreadCount"]),a.shouldShowUnreadDivider=(0,$e.derived)(a._shouldShowUnreadDivider,["unreadCount","unreadMsgAnchor"]),a.isVisible=(0,$e.derived)(a._isVisible,["createdLocally","msgs","msgsLength"]),a.previewMessage=(0,$e.derived)(a._previewMessage,["msgs","msgsChanged"]),a.showChangeNumberNotification=(0,$e.derived)(a._showChangeNumberNotification,["changeNumberOldJid","changeNumberNewJid","id","isUser"]),n=i,(0,C["default"])(a,n)}return(0,A["default"])(t,e),(0,E["default"])(t,[{key:"initialize",value:function(){var e=se["default"].markStart("initChat");(0,j["default"])(t.prototype.__proto__||(0,m["default"])(t.prototype),"initialize",this).call(this),this._addQueue=new le["default"],this._sendQueue=new le["default"],this._promises=null,this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",we["default"].Presence.gadd(this.id));var i=Ee["default"].get(this.id);if(i?this.addChild("mute",i):this.addChild("mute",Ee["default"].gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",we["default"].Contact.gadd(this.id)),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var a=void 0;this.isBroadcast&&!we["default"].GroupMetadata.get(this.id)&&(a=!0),this.addChild("groupMetadata",we["default"].GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(this.groupMetadata.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata,"change:participants change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly(),this.updateIsAnnounceGrpRestrict();var n=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Ce["default"].update(n)["catch"](w.WapDrop,function(){}),we["default"].GroupMetadata.update(n)["catch"](w.WapDrop,function(){})}),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),a&&we["default"].GroupMetadata.update(n)["catch"](w.WapDrop,function(){})}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted);var r=this.getCollection();r.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](function(){}),r.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=N["default"].debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,
this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache),se["default"].markEnd(e)}},{key:"_kind",value:function(){return xe["default"].isGroup(this.id)?it.GROUP:xe["default"].isBroadcast(this.id)?it.BROADCAST:xe["default"].isUser(this.id)?it.CHAT:void fe["default"].log("chat:unknown kind id:"+this.id.toString())()}},{key:"_isUser",value:function(){return xe["default"].isUser(this.id)}},{key:"_isPSA",value:function(){return xe["default"].isPSA(this.id)}},{key:"_isGroup",value:function(){return xe["default"].isGroup(this.id)}},{key:"_isBroadcast",value:function(){return xe["default"].isBroadcast(this.id)}},{key:"_hasUnread",value:function(){return 0!==this.unreadCount}},{key:"_shouldShowUnreadDivider",value:function(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){var e=this.unreadMsgAnchor.msgChunk.getModelsArray();return this.unreadMsgAnchor!==N["default"].find(e,{isUnreadType:!0})}if(this.msgs.msgLoadState.noEarlierMsgs){var t=this.msgs.filter(function(e){return e.isUnreadType});return t.length!==this.unreadCount}return!0}},{key:"_isVisible",value:function(){return!!this._isVisibleLatched||!xe["default"].isStatusV3(this.id)&&(this._isVisibleLatched=!this.createdLocally||this.msgs.some(function(e){return e.type!==F["default"].MSG_TYPE.E2E_NOTIFICATION}),this._isVisibleLatched)}},{key:"_previewMessage",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==F["default"].MSG_TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}},{key:"_showChangeNumberNotification",value:function(){if(!de["default"].supportsFeature(de["default"].F.CHANGE_NUMBER_V_2))return!1;var e=this.changeNumberOldJid,t=this.changeNumberNewJid,i=this.id,a=this.isUser;if(!a)return!1;if(!e&&!t)return!1;var n=t||i,r=we["default"].Contact.get(n);return!r||!r.isMyContact}},{key:"set",value:function(e,i,a){return"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(i):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration),(0,j["default"])(t.prototype.__proto__||(0,m["default"])(t.prototype),"set",this).call(this,e,i,a)}},{key:"addPendingAction",value:function(e){var t=this;if(e.isPending()){var i=function(){t.decPending()};e.then(i,i),this.pendingAction++}}},{key:"decPending",value:function(){this.pendingAction>0?this.pendingAction--:(fe["default"].log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"addAndSendMsg",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=v["default"].resolve(e).then(function(e){var t=me["default"].add(e)[0];if(t)return t.waitForPrep()["return"](t);throw new w.ModelCreateError(me["default"]._model.prototype.Collection,e)}),n=this._addQueue.enqueue(a).then(function(e){return t.msgs.add(e)[0]}),r=i?n.then(i)["return"](n):n,s=this.sendMsg(r);return[n,s]}},{key:"sendMsg",value:function(e){return this._sendQueue.enqueue(e).then(function(e){return me["default"].send(e)})}},{key:"onActiveUpdate",value:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active}},{key:"onPendingActionUpdate",value:function(){this.pendingAction<0&&(fe["default"].log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"onNotSpamChange",value:function(){var e=this.getCollection();e.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}},{key:"hasMaybeSentMsgToChat",value:function(){return N["default"].some(this.getAllMsgs(),function(e){return e.isSentByMe})}},{key:"isTrusted",value:function(){var e=!1;return this.isGroup?e=this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e}},{key:"updateMuteExpiration",value:function(){this.muteExpiration=Number(this.mute.expiration)}},{key:"updateTitle",value:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}},{key:"title",value:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle}},{key:"sendExit",value:function(){var e=this;if(!this.isGroup)return v["default"].reject(new w.ActionError);if(this.promises.sendExit)return this.promises.sendExit;var t=this.promises.sendExit=Be["default"].leaveGroup(this.id),i=new Xe.ActionType(l10n.t("action_group_exiting")),a=t.then(function(e){return 200===e.status?new Xe.ActionType(l10n.t("action_group_exited")):e.status>=400?new Xe.ActionType(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return fe["default"].error("models:chat:sendExit dropped")(e),new Xe.ActionType(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:(0,Xe.genId)(),initialAction:i,pendingAction:a})),t.then(function(t){200!==t.status||t._duplicate||e.exit()})["finally"](function(){e.promises.sendExit=null})}},{key:"exit",value:function(){this.isGroup&&(this.groupMetadata.participants.remove(ee["default"].me),this.isReadOnly=!0)}},{key:"sendDelete",value:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.getLastMsgKeyForAction(),i=t?this.msgs.get(t):void 0,a=this.promises.sendDelete=Be["default"].sendConversationDelete(this.id,t),n=this.kind,r=void 0;switch(n){case it.GROUP:r=l10n.t("action_group_deleting");break;case it.BROADCAST:r=l10n.t("action_broadcast_deleting");break;case it.CHAT:r=l10n.t("action_chat_deleting")}r=new Xe.ActionType(r);var s=a.bind(this).then(function(e){if(200===e.status)switch(n){case it.GROUP:return new Xe.ActionType(l10n.t("action_group_deleted"));case it.BROADCAST:return new Xe.ActionType(l10n.t("action_broadcast_deleted"));case it.CHAT:return new Xe.ActionType(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(n){case it.GROUP:return new Xe.ActionType(l10n.t("action_group_delete_failed"));case it.BROADCAST:return new Xe.ActionType(l10n.t("action_broadcast_delete_failed"));case it.CHAT:return new Xe.ActionType(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){fe["default"].error("models:chat:sendDelete dropped")(e);var t=void 0;switch(n){case it.GROUP:t=l10n.t("action_group_delete_failed");break;case it.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case it.CHAT:t=l10n.t("action_chat_delete_failed")}return new Xe.ActionType(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:(0,Xe.genId)(),initialAction:r,pendingAction:s})),a.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var a=this.getLastMsgKeyForAction();t&&t.equals(a)||t===a?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(i)}})["finally"](function(){e.promises.sendDelete=null})}},{key:"updateCanSend",value:function(){return this.isReadOnly||this.isAnnounceGrpRestrict?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}},{key:"sendClear",value:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var i=this.getLastMsgKeyForAction(),a=i?this.msgs.get(i):void 0,n=this.promises.sendClear=Be["default"].sendConversationClear(this.id,i,!e),r=new Xe.ActionType(l10n.t("action_chat_clearing")),s=n.then(function(e){return 200===e.status?new Xe.ActionType(l10n.t("action_chat_cleared")):e.status>=400?new Xe.ActionType(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(i){return fe["default"].error("models:chat:sendClear dropped")(i),new Xe.ActionType(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:(0,Xe.genId)(),initialAction:r,pendingAction:s})),n.then(function(i){200!==i.status||i._duplicate||t.deleteMsgsBeforeMsgInclusive(a,e)})["finally"](function(){t.promises.sendClear=null})}},{key:"delete",value:function(){(0,j["default"])(t.prototype.__proto__||(0,m["default"])(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.cancelPendingPromises(),this.presence["delete"](),this.liveLocation&&this.liveLocation["delete"](),Z["default"].clearChat(this),this.groupMetadata&&this.groupMetadata["delete"](),this.mediaMsgs&&this.mediaMsgs["delete"](),this.linkMsgs&&this.linkMsgs["delete"](),this.docMsgs&&this.docMsgs["delete"]();var e=this.starredMsgs;e&&(e["delete"](),e.stopListening(),e.reset()),this.receivedVCardMsgs&&this.receivedVCardMsgs["delete"](),Fe["default"].deletComposeContent(this.id)}},{key:"isDirty",value:function(){return 0!==this.unreadCount}},{key:"resetMediaMsgs",value:function(){var e=this.mediaMsgs,t=this.linkMsgs,i=this.docMsgs;e&&(e["delete"](),e.queryMedia(this)),t&&(t["delete"](),t.queryLinks(this)),i&&(i["delete"](),i.queryDocs(this))}},{key:"addMediaMsgs",value:function(e,t){if(e){var i=Array.isArray(e)?e:[e],a=[],n=[],r=[];i.forEach(function(e){e.isMedia&&a.push(e),e.isDoc&&r.push(e),e.linkPreview&&n.push(e)}),this.mediaMsgs&&a.length&&this.mediaMsgs.add(a,t),this.linkMsgs&&n.length&&this.linkMsgs.add(n,t),this.docMsgs&&r.length&&this.docMsgs.add(r,t)}}},{key:"onNewMsg",value:function(e){if(e&&(e.isSentByMe&&!this.notSpam&&(this.notSpam=!0),"i"!==e.eventType)){var t={};t.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.updateMediasCountOnMsg(e),this.archive&&(t.archive=!1),this.promises.setArchive&&this.promises.setArchive.cancel(),e.isSentByMe?this.markedUnread=!1:(this.presence.handle({id:this.id,participant:e.author,type:"paused"}),"a"!==e.eventType&&"d"!==e.eventType||(t.unreadCount=this.unreadCount+1||1)),e.isSentByMeFromWeb&&e.promises.sendPromise?this.setAndKeepPrevious(t,e.promises.sendPromise):this.set(t);var i=ne["default"].get(this.id);if(i&&(i.timestamp=J["default"].globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||we["default"].GroupMetadata.trigger("group_participant_change_"+ee["default"].me.toString(),this.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&Z["default"].alertNewMsg(e),this.msgs.length<F["default"].MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs(void 0,pe["default"].WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH)["catch"](w.E404,function(){})["catch"](function(e){fe["default"].log("chat:onNewMsg failed")(),fe["default"].log(e)()});break;case"s":if("gp2"===e.type&&"add"===e.subtype&&ee["default"].me.equals(N["default"].head(e.recipients))&&!this.contact.name)return;Z["default"].alertNewMsg(e),we["default"].GroupMetadata.trigger("group_participant_change_"+ee["default"].me.toString(),this.id)}var a=e.mediaData;!a||"image"!==a.type&&"video"!==a.type||Z["default"].newMediaMsg(e)}}}},{key:"setPin",value:function(e,t){var i=this;this.promises.setPin&&this.promises.setPin.cancel();var a=void 0,n=void 0;e?a=Math.round(+new Date/1e3):n=this.pin;var r=Be["default"].sendConversationPin(this.id,a,n).cancellable(),s=e?new Xe.ActionType(l10n.t("action_chat_pinning")):new Xe.ActionType(l10n.t("action_chat_unpinning"));t=t||(0,Xe.genId)();var o=r.then(function(a){var n=void 0;return 200===a.status?(n=e?l10n.t("action_chat_pinned"):l10n.t("action_chat_unpinned"),new Xe.ActionType(n,l10n.t("action_undo"),i.setPin.bind(i,!e,t))):405===a.status?new Xe.ActionType(l10n.t("action_chat_pin_failed_405")):a.status>=400?e?new Xe.ActionType(l10n.t("action_chat_pin_failed")):new Xe.ActionType(l10n.t("action_chat_unpin_failed")):void 0})["catch"](function(a){fe["default"].error("models:chat:setPin dropped")(a);var n=e?l10n.t("action_chat_pin_failed"):l10n.t("action_chat_unpin_failed");return new Xe.ActionType(n,l10n.t("action_try_again"),i.setPin.bind(i,e,t))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:t,initialAction:s,pendingAction:o})),this.promises.setPin=r.bind(this).then(function(e){200!==e.status||e._duplicate||(this.pin=a)})["finally"](function(){i.promises.setPin=null})}},{key:"setArchive",value:function i(e,t){var a=this;if(this.archive===e)return v["default"].reject(new w.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var n=this.getLastMsgKeyForAction(),r=Be["default"].sendConversationArchive(this.id,e,n).cancellable(),s=e?new Xe.ActionType(l10n.t("action_chat_archiving")):new Xe.ActionType(l10n.t("action_chat_unarchiving"));t=t||(0,Xe.genId)();var o=r.then(function(i){var n=void 0;return 200===i.status?(n=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new Xe.ActionType(n,l10n.t("action_undo"),a.setArchive.bind(a,!e,t))):i.status>=400?e?new Xe.ActionType(l10n.t("action_chat_archive_failed")):new Xe.ActionType(l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(i){fe["default"].error("models:chat:setArchive dropped")(i);var n=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new Xe.ActionType(n,l10n.t("action_try_again"),a.setArchive.bind(a,e,t))});Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:t,initialAction:s,pendingAction:o}));var i=this.promises.setArchive=r.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e,e&&(this.pin=void 0))})["finally"](function(){a.promises.setArchive=null});return i.archive=e,i}},{key:"canPin",value:function(){if(this.archive)return!1;var e=this.promises&&this.promises.setArchive;return(!e||!e.archive)&&de["default"].supportsFeature(de["default"].F.PIN)}},{key:"canArchive",value:function(){return!this.isBroadcast||de["default"].supportsFeature(de["default"].F.ARCHIVE_BROADCAST)}},{key:"sendSeen",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.markedUnread||0===this.unreadCount)return v["default"].resolve();if(!Ie["default"].available&&e)return this.listenTo(Ie["default"],"change:available",this.sendSeen),v["default"].resolve();this.stopListening(Ie["default"],"change:available",this.sendSeen);var t=this.unreadCount-this.pendingSeenCount,i=this.unreadCount===-1&&t===-1;if(t<=0&&!i)return v["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var a=this,n=function(){a.pendingSeenCount=a.pendingSeenCount-t,a.pendingSeenCount<0&&(fe["default"].error("models:chat:sendSeen unread "+a.unreadCount+" pending: "+a.pendingSeenCount+" delta: "+t)(),a.pendingSeenCount=0)},r=this.getLastMsgKeyForAction();return Be["default"].sendConversationSeen(this.id,r,t).bind(this).then(function(e){return n(),200!==e.status||e._duplicate||this.markSeen(t),e})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(e){n(),fe["default"].error("models:chat:sendConversationSeen dropped")()})}},{key:"markSeen",value:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:e===-1&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1}},{key:"markUnread",value:function(e,t){var i=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;var a=this.promises.markUnread=e?this.sendUnseen():this.sendSeen(),n=e?new Xe.ActionType(l10n.t("action_chat_marking_unread")):new Xe.ActionType(l10n.t("action_chat_marking_read"));t=t||(0,Xe.genId)();var r=a.then(function(a){if(200===a.status){var n=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new Xe.ActionType(n,l10n.t("action_undo"),i.markUnread.bind(i,!e,t))}if(a.status>=400)return e?new Xe.ActionType(l10n.t("action_chat_mark_unread_failed")):new Xe.ActionType(l10n.t("action_chat_mark_read_failed"));throw new Error("invalid response status")})["catch"](function(a){var n=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new Xe.ActionType(n,l10n.t("action_try_again"),i.markUnread.bind(i,e,t))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:t,initialAction:n,pendingAction:r})),a["finally"](function(){i.promises.markUnread=null})}},{key:"sendUnseen",value:function(){var e=this,t=this.getLastMsgKeyForAction();return Be["default"].sendConversationUnseen(this.id,t).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})}},{key:"markUnseen",value:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1}},{key:"markRecording",value:function(){var e=this;if((this.presence.isOnline||this.isGroup)&&!this.recording){var t=this.id;Be["default"].sendChatstateRecording(t).then(function(e){e.status>=400&&fe["default"].error("models:chat send presence recording error "+t.toString())()})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(){}),this.presenceResendTimerId=setTimeout(function(){return e._resendPresence()},F["default"].PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1}},{key:"markComposing",value:function(){var e=this;if((this.presence.isOnline||this.isGroup)&&!this.typing){var t=this.id;Be["default"].sendChatstateComposing(t).then(function(e){e.status>=400&&fe["default"].error("models:chat send presence composing error "+t.toString())()})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(){}),this.presenceResendTimerId=setTimeout(function(){return e._resendPresence()},F["default"].PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=setTimeout(function(){return e.markPaused()},F["default"].SEND_PAUSED_WAIT)}},{key:"markPaused",value:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;Be["default"].sendChatstatePaused(e).then(function(t){t.status>=400&&fe["default"].error("models:chat send presence paused error "+e.toString())()})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(){})}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1}},{key:"sendDismissChangeNumber",value:function(){var e=this;if(this.promises.sendDismissChangeNumber)return this.promises.sendDismissChangeNumber;var t=Be["default"].sendConversationDismissChangeNumber(this.id);this.promises.sendDismissChangeNumber=t;var i=new Xe.ActionType(l10n.t("action_chat_dismissing_change_number_notification")),a=t.then(function(e){return 200===e.status?new Xe.ActionType(l10n.t("action_chat_dismissed_change_number_notification")):e.status>=400?new Xe.ActionType(l10n.t("action_chat_dismiss_change_number_notification_failed")):void 0})["catch"](function(t){return fe["default"].error("models:chat:sendDismissChangeNumber dropped")(t),new Xe.ActionType(l10n.t("action_chat_dismiss_change_number_notification_failed"),l10n.t("action_try_again"),e.sendDismissChangeNumber.bind(e))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:(0,Xe.genId)(),initialAction:i,pendingAction:a})),t.then(function(t){200!==t.status||t._duplicate||(e.changeNumberOldJid=e.changeNumberNewJid=void 0)})["finally"](function(){e.promises.sendDismissChangeNumber=null})}},{key:"_resendPresence",value:function(){var e=this,t=this.id;if(this.recording)Be["default"].sendChatstateRecording(t).then(function(e){e.status>=400&&fe["default"].error("models:chat send presence resend recording error "+t.toString())()})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(){});else{if(!this.typing)return void this.unset("presenceResendTimerId");Be["default"].sendChatstateComposing(t).then(function(e){e.status>=400&&fe["default"].error("models:chat send presence resend composing error "+t.toString())()})["catch"](w.WapDrop,w.ProtoVersionUndefined,function(){})}this.presenceResendTimerId=setTimeout(function(){return e._resendPresence()},F["default"].PRESENCE_RESEND_WAIT)}},{key:"_messageSent",value:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1}},{key:"_presenceOnlineChanged",value:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))}},{key:"handleGroupAction",value:function(e,t,i){var a=this;switch(e){case"subject":return void(this.contact.name=i.subject);case"add":case"promote":case"demote":var n="promote"===e,r=N["default"].map(i.participants,function(e){return{id:e,isAdmin:n}});return this.groupMetadata.participants.add(r,{merge:!0}),void("add"===e&&N["default"].forEach(i.participants,function(e){we["default"].GroupMetadata.trigger("group_participant_change_"+e,a.id)}));case"remove":var s=this.groupMetadata;return N["default"].each(i.participants,function(e){s.participants.remove(e)}),void N["default"].forEach(i.participants,function(e){we["default"].GroupMetadata.trigger("group_participant_change_"+e,a.id)});case"modify":return;case"invite":return void(i.code?this.groupMetadata.inviteCode=i.code:fe["default"].error("model:chat:handleGroupAction:invalid invite code: "+i.code+" for "+this.id.toString())());case"desc_add":return void this.groupMetadata.set({desc:i.desc,descId:i.descId,descTime:i.descTime,descOwner:t});case"desc_remove":return void(this.groupMetadata.descId===i.descId&&this.groupMetadata.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));case"restrict":return void(this.groupMetadata.restrict=!!i);case"announce":return void(this.groupMetadata.announce=!!i);default:return}}},{key:"setComposeContents",value:function(e){this.composeContents=e}},{key:"getSessionPersistedComposeContent",value:function(){return Fe["default"].getComposeContent(this.id)}},{key:"getComposeContents",value:function(){return N["default"].isEmpty(this.composeContents)?this.getSessionPersistedComposeContent()||{}:this.composeContents}},{key:"setComposeAttachMediaContents",value:function(e){this.composeAttachMediaContents=e}},{key:"preload",value:function(){1===this.msgs.length&&this.loadEarlierMsgs()["catch"](w.E404,function(){})["catch"](function(e){fe["default"].log("chat:preload failed")(),fe["default"].log(e)()})}},{key:"onEmptyMRM",value:function(){fe["default"].log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()["catch"](w.E404,function(){})["catch"](function(e){fe["default"].log("chat:onEmptyMRM failed")(),fe["default"].log(e)()})}},{key:"loadEarlierMsgs",value:function(e,t){return t=t||pe["default"].WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL,e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?v["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e,t).then(function(t){return e&&Array.isArray(t)&&t.length<F["default"].PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})}},{key:"isMostRecentCMC",value:function(e){return this.msgs===e}},{key:"loadRecentMsgs",value:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?v["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e,pe["default"].WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL)}},{key:"_loadMsgs",value:function(e,t,i){var a=void 0;a="after"===e?t.last():t.head();var n={};a?n=a.id.clone():n.remote=this.id,n.count=F["default"].PAGE_SIZE,n.direction=e;var r=o(i),s=function(e){r.webcResponseBytes+=e.binarySize};return this._loadMsgsPromiseLoop(a,t,me["default"].findQuery.bind(me["default"],n,{logOnSend:s}),e,r)}},{key:"_updateMsgLoadState",value:function(e,t,i){var a=e&&e.msgChunk&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&a&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===i?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!1)}},{key:"_loadMsgsPromiseLoop",value:function(e,t,i,a,n){var r=this,s=performance.now();switch("after"===a?(t.msgLoadState.isLoadingRecentMsgs=!0,n.webcMessageQueryType=pe["default"].WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===a?(t.msgLoadState.isLoadingEarlierMsgs=!0,n.webcMessageQueryType=pe["default"].WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===a&&(t.msgLoadState.isLoadingAroundMsgs=!0,n.webcMessageQueryType=pe["default"].WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),navigator.connection&&(n.webcBrowserNetworkType=navigator.connection.effectiveType),this.kind){case it.CHAT:n.webcChatType=pe["default"].WEBC_CHAT_TYPE.INDIVIDUAL;case it.GROUP:n.webcChatType=pe["default"].WEBC_CHAT_TYPE.GROUP;case it.BROADCAST:n.webcChatType=pe["default"].WEBC_CHAT_TYPE.BROADCAST_LIST}"number"==typeof this.initialIndex&&(n.webcChatPosition=this.initialIndex);var o=v["default"].loop(function(o,u,l){var c=v["default"].delay(De["default"].expBackoff(l,12e4,1e3,.1)),f="CONNECTED"===Ae["default"].stream?v["default"].resolve():I.waitForBBEvent(Ae["default"],"change:stream",function(){return"CONNECTED"===Ae["default"].stream});return f.then(function(){return r.regCancellablePromise(i()).then(function(i){n.webcQueryT=Math.ceil(performance.now()-s);var u=void 0;Array.isArray(i[0])?(u=i[0][0],i.forEach(function(e){return d(n,e)})):(u=i[0],d(n,i)),n.webcEarliestMessageT=u.t,u.msgChunk===r.msgs&&(n.webcEarliestMessageIndex=r.msgs.length-1),n.commit(),r._updateMsgLoadState(e,t,a),o(i)})})["catch"](function(e){return!(e instanceof v["default"].CancellationError)},function(i){return l>3||404===i?(r._updateMsgLoadState(e,t,a),fe["default"].error("chat:loadMsgs:error "+String(i))(),404===i?v["default"].reject(new w.E404):v["default"].reject(new w.GaveUpRetry("Gave up msg fetch after "+l+" tries"))):c})},0);return"after"===a?t.loadRecentPromise=o:"before"===a?t.loadEarlierPromise=o:"around"===a&&(t.loadAroundPromise=o),o}},{key:"getSearchContext",value:function(e,t){var i=this,a=void 0,n=void 0;e instanceof ve["default"]?a=e:e instanceof be["default"]&&(n=e);var r=a?a.msgChunk:void 0,s=(0,p["default"])(F["default"].PAGE_SIZE/3*2);if(!r||!r.msgLoadState.contextLoaded){r||(r=new W["default"],this.msgChunks.push(r),a&&r.add(a));var d=a?a.id.clone():n.clone();d.count=s;var u=function(){if(a)return a.msgChunk;var e=me["default"].get(n);return e&&e.msgChunk?e.msgChunk:r},l=o(pe["default"].WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK),c=function(e){l.webcResponseBytes+=e.binarySize};this._loadMsgsPromiseLoop(a,r,me["default"].getContext.bind(me["default"],d,u,c),"around",l).then(function(e){var t=u();t&&r&&t!==r&&i.notifyMsgCollectionMerge(t,r,t);var o=e[0],d=n?me["default"].get(n):a;d&&Array.isArray(o)&&o.length<s&&(d.msgChunk.msgLoadState.noEarlierMsgs=!0,r&&d.msgChunk!==r&&(r.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:r,msg:a,key:n,highlightMsg:!0}}},{key:"sendStarMsgs",value:function(e,t){var i=this;return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=Be["default"].sendMessageStarred(this.id,N["default"].map(e,function(e){return e.id}),t).then(function(i){return 200===i.status&&(N["default"].forEach(e,function(e){e.set("star",t)}),t?(0,R.addStarredMsgs)(e):(0,R.removeStarredMsgs)(e)),i})["finally"](function(){i.promises.sendStarMsgs=null})}},{key:"sendRevokeMsgs",value:function(e,t){var i=this;return this.promises.sendRevokeMsgs?this.promises.sendRevokeMsgs:this.promises.sendRevokeMsgs=v["default"].all(e.map(function(e){return e.sendRevoke(t)}))["finally"](function(){i.promises.sendRevokeMsgs=null})}},{key:"sendNotSpam",value:function(e,t){var i=this;if(this.notSpam)return v["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;var a=this.promises.sendNotSpam=Be["default"].sendConversationNotSpam(this.id);if(e){var n=new Xe.ActionType(l10n.t("action_mark_as_not_spam"));t=t||(0,Xe.genId)();var r=a.then(function(e){if(200===e.status)return new Xe.ActionType(l10n.t("action_marked_as_not_spam"));if(e.status>=400)return new Xe.ActionType(l10n.t("action_mark_as_not_spam_failed"));throw new Error("invalid response status")})["catch"](function(a){return fe["default"].error("models:chat:sendNotSpam dropped")(a),new Xe.ActionType(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),i.sendNotSpam.bind(i,e,t))});Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:t,initialAction:n,pendingAction:r}))}return a["finally"](function(){i.isTrusted(),i.promises.sendNotSpam=null})}},{key:"sendSpamReport",value:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;var i=this.promises.sendSpamReport=Be["default"].sendSpamReport(this.id),a=new Xe.ActionType(l10n.t("action_spam_report"));e=e||(0,Xe.genId)();var n=i.then(function(e){return 200===e.status?new Xe.ActionType(l10n.t("action_spam_reported")):e.status>=400?new Xe.ActionType(l10n.t("action_spam_report_failed")):void 0})["catch"](function(i){return fe["default"].error("models:chat:sendSpamReport dropped")(i),new Xe.ActionType(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:e,initialAction:a,pendingAction:n})),i["finally"](function(){t.promises.sendSpamReport=null})}},{key:"reportSpamBlockClear",value:function(){var e=this;if(this.promises.reportSpamBlockClear)return this.promises.reportSpamBlockClear;if(this.isGroup)return v["default"].reject(new w.ActionError);var t=this.sendSpamReport();return this.promises.reportSpamBlockClear=t.then(function(){return(0,Ze.blockContact)(e.contact)}).then(function(){return e.sendClear(!1)})["catch"](function(){})["finally"](function(){e.promises.reportSpamBlockClear=null}),this.promises.reportSpamBlockClear}},{key:"reportSpamExitClear",value:function(){var e=this;if(this.promises.reportSpamExitClear)return this.promises.reportSpamExitClear;if(!this.isGroup)return v["default"].reject(new w.ActionError);var t=void 0,i=this.sendSpamReport();if(this.isReadOnly)t=i;else{var a=this.sendExit(),n=I.waitForBBEvent(this.msgs,"change:last",function(e){return e.isGroupLeave()});t=v["default"].all([i,a,n])}return this.promises.reportSpamExitClear=t.then(function(){return e.sendClear(!1)})["catch"](function(){})["finally"](function(){e.promises.reportSpamExitClear=null}),this.promises.reportSpamExitClear}},{key:"sendDeleteMsgs",value:function(e,t){var i=this;return this.promises.sendDeleteMsgs?this.promises.sendDeleteMsgs:this.promises.sendDeleteMsgs=Be["default"].sendMessageDelete(this.id,N["default"].map(e,function(e){return e.id}),t).then(function(t){var i=[];return 200===t.status?(N["default"].forEach(e,function(e){e["delete"]()}),e.length):(t.status>=400&&(i=N["default"].filter(e,function(e){return e.ack===-1&&(e["delete"](),!0)})),i.length)})["finally"](function(){i.promises.sendDeleteMsgs=null})}},{key:"deleteMsgs",value:function(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}},{key:"deleteMsgsOlderThan",value:function(e,t,i){var a=this.msgs,n=a.head();if(n&&!(n.t>=e)){if(n=a.last(),n&&n.t<e)return void this.deleteMsgs(t,i);var r=function(a,n,r){return a&&(i&&!s(a,i)||a.star&&!t||a.t>=e||a.isPersistent)};this.deleteMsgsPartial(r)}}},{key:"deleteMsgsBeforeMsgInclusive",value:function(e,t,i){var a=void 0;if(e){if(!this.msgs.get(e.id))return;a=this.msgs.indexOf(e)}else a=this.msgs.length;var n=function(e,n,r){return i&&!s(e,i)||e.msgChunk===this.msgs&&n>a||t&&e.star||e.isPersistent&&t};this.deleteMsgsPartial(n,!0)}},{key:"deleteMsgsPartial",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.unreadCount;if(this.getAllCMCs().forEach(function(a){var n=a.filter(function(i,a,n){return!e.apply(t,[i,a,n])});a.remove(n,void 0,i),n.forEach(function(e){e["delete"]();
})}),N["default"].clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var n=a>this.msgs.length?this.msgs.length:a;this.unreadCount=n,this.msgs.msgLoadState.noEarlierMsgs=!0}}},{key:"getFirstMsgWithStatus",value:function(){return N["default"].find(this.msgs.getModelsArray(),function(e){return!e.isNotification&&(e.isSentByMe||e.type===F["default"].MSG_TYPE.PTT)})}},{key:"getLastReceivedMsg",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}}},{key:"getLastMsgKeyForAction",value:function(){var e=this.msgs.last();if(e)return!this.lastReceivedKey||e.id.fromMe&&e.local&&0===e.ack?e.id:this.lastReceivedKey}},{key:"getLastTimestampMsg",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}}},{key:"sendMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=N["default"].trim(e);var i=t.linkPreview,a=t.quotedMsg,n=t.mentionedJidList,r=t.quotedMsgAdminGroupJid;if(""===e)return v["default"].resolve();this._messageSent();var s=this.id,o=ee["default"].me,d=new be["default"]({from:o,to:s,id:(0,We["default"])(),participant:void 0,selfDir:"out"}),u=void 0;a?u=a.contextInfo(this.id):r&&(u={quotedRemoteJid:r});var l=N["default"].defaults({id:d,body:e,type:"chat",subtype:i&&!N["default"].isEmpty(i)?"url":null,t:J["default"].globalUnixTime(),from:o,to:s,self:"out",local:!0,ack:0,urlText:this.urlText,urlNumber:this.urlNumber},i||{},u||{},{mentionedJidList:n});this.urlText&&(this.urlText=void 0),this.urlNumber&&(this.urlNumber=void 0);var c=new ve["default"](l),f=me["default"].send(c);return this.msgs.add(c),f}},{key:"sendContact",value:function(e,t){var i=t&&t.contextInfo(this.id),a=N["default"].defaults({ack:0,body:Je["default"].fromContactModel(e).vcard,from:ee["default"].me,id:new be["default"]({from:ee["default"].me,to:this.id,id:(0,We["default"])(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:J["default"].globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0},i||{});this.addAndSendMsg(a)}},{key:"sendContactList",value:function(e,t){var i=e.map(Je["default"].fromContactModel,Je["default"]),a=t&&t.contextInfo(this.id),n=N["default"].defaults({ack:0,from:ee["default"].me,id:new be["default"]({from:ee["default"].me,to:this.id,id:(0,We["default"])(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:J["default"].globalUnixTime(),to:this.id,type:"multi_vcard",vcardList:i,isNewMsg:!0},a||{});this.addAndSendMsg(n)}},{key:"forwardMessages",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.id,n=this.contact;if(n.isUser&&n.isBlocked())return v["default"].reject(new ie["default"]("Forwarded to contact is blocked",n));var r=[];return v["default"].each(e,function(e){if(e.isMMS)return(0,et.forwardMediaMsg)(e,t,i);var n=N["default"].omit(e.toJSON(),["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID"]),r=new be["default"]({from:ee["default"].me,to:a,id:(0,We["default"])(),participant:void 0,selfDir:"out"});N["default"].assign(n,{id:r,from:ee["default"].me,t:J["default"].globalUnixTime(),to:a,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:i}),t.addAndSendMsg(n)})["return"](r)}},{key:"updateReadOnly",value:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(ee["default"].me)),this.isBroadcast&&this.updateTitle()}},{key:"updateIsAnnounceGrpRestrict",value:function(){if(this.isGroup&&!this.groupMetadata.stale){var e=this.groupMetadata.participants.get(ee["default"].me);this.isAnnounceGrpRestrict=e&&!e.isAdmin&&this.groupMetadata.announce}}},{key:"sortMsgs",value:function(e){var t=e.map(function(e){var t=e.msgChunk;return{msg:e,chunkT:(0,ze["default"])(t.at(0)).t,index:t.indexOf(e)}});return N["default"].orderBy(t,["chunkT","index"]).map(function(e){return e.msg})}},{key:"_updateAssignedColor",value:function(){if(this.colors){var e=this.groupMetadata.participants,t=this.colors,i=N["default"].difference(N["default"].keys(t),e.map(function(e){return e.id.toString()}).map(qe["default"]));i.forEach(function(e){delete t[e]}),i.length&&this._saveAssignedColors()}}},{key:"loadAssignedColors",value:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),Fe["default"].getGroupParticipantAssignedColor(this.id)||{}}},{key:"saveAssignedColors",value:function(){var e=this.colors;e&&Fe["default"].setGroupParticipantAssignedColor(this.id,e)}},{key:"assignedColor",value:function(e){var t=this.colors||(this.colors=this.loadAssignedColors()),i=void 0,a=(0,qe["default"])(e.toString());if(i=t[a])return i;var n={};N["default"].forEach(t,function(e,t){n[e]?n[e].push(t):n[e]=[t]});for(var r=Number.POSITIVE_INFINITY,s=1;s<F["default"].NUM_COLORS;s++){if(!n[s]){i=s;break}n[s].length<r&&(r=n[s].length,i=s)}return t[a]=i,this._saveAssignedColors(),i}},{key:"setSubject",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments[1];if(t=t||"",t=t.trim(),!t)return v["default"].reject(new w.ActionError);if(t===this.contact.name)return v["default"].reject(new w.ActionError);var a=Be["default"].changeSubject(this.id,t),n=this.contact.name,r=new Xe.ActionType(l10n.t("action_group_renaming"));i=i||(0,Xe.genId)();var s=a.then(function(a){return 200===a.status?new Xe.ActionType(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,n,i)):a.status>=400?new Xe.ActionType(l10n.t("action_group_rename_failed")):void 0})["catch"](function(a){return fe["default"].error("models:chat:setSubject dropped")(a),new Xe.ActionType(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,i))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:i,initialAction:r,pendingAction:s})),a.then(function(i){200!==i.status||i._duplicate||(e.contact.name=t)})}},{key:"setGroupDesc",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Xe.genId)();if(t=t&&t.trim(),t===this.groupMetadata.desc)return v["default"].reject(new w.ActionError);""===t&&(t=null);var a=Be["default"].setGroupDescription(this.id,t,(0,We["default"])(),this.groupMetadata.descId),n=this.groupMetadata.desc,r=new Xe.ActionType(l10n.t("action_group_desc_change")),s=a.then(function(a){return 200===a.status?new Xe.ActionType(l10n.t("action_group_desc_changed",{desc:t||""}),l10n.t("action_undo"),e.setGroupDesc.bind(e,n,i)):a.status>=400?new Xe.ActionType(l10n.t("action_group_desc_change_failed")):void 0})["catch"](function(a){return fe["default"].error("models:chat:setGroupDesc dropped")(a),new Xe.ActionType(l10n.t("action_group_desc_change_failed"),l10n.t("action_try_again"),e.setGroupDesc.bind(e,t,i))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:i,initialAction:r,pendingAction:s})),a.then(function(i){200!==i.status||i._duplicate||(e.groupMetadata.desc=t||"")})}},{key:"setGroupProperty",value:function(e,t,i){var a,n=this;if(!this.groupMetadata.canSetGroupProperty())return v["default"].reject(new w.ActionError);if(!e)return v["default"].reject(new w.ActionError);var r=Be["default"].setGroupProperty(this.id,e,t),s=(a={},(0,f["default"])(a,F["default"].GROUP_SETTING_TYPE.ANNOUNCEMENT,{"true":[l10n.t("changing_web_group_announcement_to_on"),l10n.t("changed_web_group_announcement_to_on")],"false":[l10n.t("changing_web_group_announcement_to_off"),l10n.t("changed_web_group_announcement_to_off")]}),(0,f["default"])(a,F["default"].GROUP_SETTING_TYPE.RESTRICT,{"true":[l10n.t("changing_web_group_restrict_to_on"),l10n.t("changed_web_group_restrict_to_on")],"false":[l10n.t("changing_web_group_restrict_to_off"),l10n.t("changed_web_group_restrict_to_off")]}),(0,f["default"])(a,F["default"].GROUP_SETTING_TYPE.NO_FREQUENTLY_FORWARDED,{"true":[l10n.t("changing_web_group_no_frequently_forwarded_to_on"),l10n.t("changed_web_group_no_frequently_forwarded_to_on")],"false":[l10n.t("changing_web_group_no_frequently_forwarded_to_off"),l10n.t("changed_web_group_no_frequently_forwarded_to_off")]}),a),o=s[e][t.toString()],d=new Xe.ActionType(o[0]);i=i||(0,Xe.genId)();var u=r.then(function(e){return 200===e.status?new Xe.ActionType(o[1]):404===e.status?new Xe.ActionType(l10n.t("action_change_group_property_failed")+" "+l10n.t("action_group_failed_404")):void 0})["catch"](function(a){return fe["default"].error("")(a),new Xe.ActionType(l10n.t("action_change_group_property_failed"),l10n.t("action_try_again"),n.setGroupProperty.bind(n,e,t,i))});return Z["default"].openToast(je["default"].createElement(Xe.ActionToast,{id:i,initialAction:d,pendingAction:u})),r.then(function(i){200!==i.status||i._duplicate||n.groupMetadata.set(F["default"].GROUP_SETTING_TO_METADATA[e],t)})}},{key:"unstarAll",value:function(){var e=this.getAllMsgs();e.forEach(function(e){e&&(e.star=!1)}),(0,R.removeStarredMsgs)(e)}},{key:"constructMediaMsgs",value:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new q["default"],t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t}},{key:"fts",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments[2];if(1===i){var n=this.ftsCache[e];if(n)return n;var r=me["default"].search(e,i,a,this.id);this.ftsCache[e]=r;var s=function(){t.ftsCache[e]=null};return N["default"].delay(s,tt),r["catch"](s),r}return me["default"].search(e,i,a,this.id)}},{key:"_clearFtsCache",value:function(){this.ftsCache={}}},{key:"updateSortTime",value:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=this.regCancellablePromise(v["default"].delay(0)).then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,v["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?v["default"].resolve():e.pendingMsgs?v["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var i=e.getLastTimestampMsg();e.t=i?i.t:void 0}})["catch"](function(){})["finally"](function(){e.promises.updateSortTime=void 0}))}},{key:"removeFromCollection",value:function(e){e.star&&(0,R.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e),this.updateMediasCountOnMsg(e,!0)}},{key:"getMediaMsgs",value:function(){return this.mediaMsgs||(this.mediaMsgs=new q["default"]),this.mediaMsgs}},{key:"getLinkMsgs",value:function(){return this.linkMsgs||(this.linkMsgs=new B["default"]),this.linkMsgs}},{key:"getDocMsgs",value:function(){return this.docMsgs||(this.docMsgs=new x["default"]),this.docMsgs}},{key:"getReceivedVCardMsgs",value:function(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVCardMsgs||(this.receivedVCardMsgs=new z["default"],this.receivedVCardMsgs.parent=this),this.receivedVCardMsgs)}},{key:"dismissVCard",value:function(){this.vcardDismissed=!0}},{key:"updateMediasCountOnMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(de["default"].supportsFeature(de["default"].F.MEDIAS_COUNT)){var i=t?-1:1;e.isMedia&&(this.mediaCount+=i);var a=e.getLinks().length;if(a){var n=i*a;this.linkCount+=n}e.isDoc&&(this.docCount+=i)}}},{key:"resetMediasCount",value:function(e){de["default"].supportsFeature(de["default"].F.MEDIAS_COUNT)&&(e.mediaCount&&(this.mediaCount=e.mediaCount),e.linkCount&&(this.linkCount=e.linkCount),e.docCount&&(this.docCount=e.docCount))}},{key:"getStarredMsgs",value:function(){var e=this,t=this.starredMsgs;return t||(this.starredMsgs=t=new R.StarredMsgCollection,this.starredMsgs.add(D["default"].filter(function(t){return t.chat===e}))),t}},{key:"setAndKeepPrevious",value:function(e,t){var i=this,a=(0,l["default"])(e);a.forEach(function(e){e in i.ackedProps||(i.ackedProps[e]=i[e])}),t["finally"](function(){a.forEach(function(e){delete i.ackedProps[e]})}),this.set(e)}},{key:"getAckedPhoneProps",value:function(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}},{key:"regCancellablePromise",value:function(e){var t=this;return this._promises||(this._promises=[]),this._promises.push(e),e.cancellable()["finally"](function(){t._promises=N["default"].without(t._promises,e),t._promises&&0===t._promises.length&&(t._promises=null)})}},{key:"cancelPendingPromises",value:function(){this._promises&&this._promises.length>0&&(this._promises.forEach(function(e){e.cancel()}),this._promises=null)}},{key:"matchFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!N["default"].isEmpty(e)||(e.label?N["default"].includes(this.labels,e.label):e.kind===F["default"].SMB_SEARCH_FILTERS.UNREAD?!!this.hasUnread:e.kind===this.kind)}}]),t}(Ne["default"]);at.Collection="Chat",at.Proxy="chat",at.idClass=xe["default"],t["default"]=(0,$e.defineModel)(at)},'"bfhecaifff"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"deehjbcdej"'),s=n(r),o=i('"djecddgbji"'),d=n(o),u=i('"bgjiajcadc"'),l=n(u),c=i('"cdehffajbd"'),f=n(c),h=i('"ddcedhgjff"'),p=n(h),g=i('"ebfebbhae"'),v=n(g),_=i('"cfcbddfj"'),m=n(_),y=i('"dfhdhdbidh"'),b=n(y),T=i('"cdfdhedgig"'),E=n(T),M=i('"bejijbfaij"'),C=n(M),S=i('"bgafgbafci"'),j=n(S),k=i('"biafgdghfb"'),A=a(k),P=i('"bgfahifgbh"'),w=a(P),O=i('"ifeajjdda"'),I=n(O),L=i('"ciehgcaebf"'),N=i('"bdcdfifjcj"'),R=n(N),D=i('"dejhjidfgh"'),G=n(D),F=i('"fhabbhhjc"'),U=n(F),x=i('"jfefjijii"'),Y=n(x),B=i('"deijabejja"'),V=n(B),q=i('"dafijcgehj"'),H=n(q),W=i('"degdhgidga"'),K=n(W),z=i('"cehbbagije"'),Q=n(z),J=i('"dhjiafjcai"'),X=n(J),Z=i('"dfahgfjgfj"'),$=n(Z),ee=i('"dhcbeegjcf"'),te=n(ee),ie=i('"cgedjbeaff"'),ae=n(ie),ne=i('"bgaddigcjb"'),re=n(ne),se=i('"dafgbfehgf"'),oe=n(se),de=i('"dfcdjadaii"'),ue=n(de),le=i('"hjcebdiai"'),ce=n(le),fe=i('"ebhdebaagj"'),he=n(fe),pe=i('"cibffdighd"'),ge=i('"hcddbeaic"'),ve=n(ge),_e=i('"cjcecfehgh"'),me=i('"dgfhfgbdeb"'),ye=n(me),be=i('"bafjcjabca"'),Te=n(be),Ee=function(e){function t(){(0,v["default"])(this,t);var e=(0,b["default"])(this,(t.__proto__||(0,p["default"])(t)).call(this));return e.notSpam={},e.promises={sendUnstarAll:null,initializeRestFromTabletCache:null},e.keysForResyncMsgs=void 0,e._sortEnabled=!1,e.enableSortListener(),e.listenTo(oe["default"],"change:stream",function(){oe["default"].stream===se.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})}),e.listenToOnce(e,"sort",j["default"].debounce(e.setIndexes,100)),e}return(0,C["default"])(t,e),(0,m["default"])(t,[{key:"enableSortListener",value:function(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:isVisible",this.sort),e&&this.sort(),this._sortEnabled=!0)}},{key:"disableSortListener",value:function(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}},{key:"setIndexes",value:function(){this.forEach(function(e,t){e.initialIndex=t})}},{key:"active",value:function a(){var a=j["default"].head(this.filter(function(e){return e.active}));return a?a:void 0}},{key:"_find",value:function(e){return f["default"].resolve({id:e,createdLocally:!0})}},{key:"_findQuery",value:function(e){var t=this,i={},a=performance.now(),n=function(e){i.binarySize=e.binarySize};return ye["default"].chatFindQuery(!!e.retry,n).then(function(e){return"preempted"===e?f["default"].reject("chats preempted"):(i.timing=Math.ceil(performance.now()-a),i.size=e.length,Y["default"].platform===x.PLATFORMS.IPHONE&&(j["default"].isEmpty(e)?he["default"].Msg.trigger(V["default"].COLLECTION_HAS_SYNCED):setTimeout(function(){he["default"].Msg.trigger(V["default"].COLLECTION_HAS_SYNCED)},2500)),t.trigger(V["default"].COLLECTION_HAS_SYNCED,i),f["default"].resolve(e))})}},{key:"handle",value:function(e){var t=e.shift(),i=this;if(Array.isArray(t)){var a=[],n=[];t.forEach(function(e){if("c.us"===e.id)n.push(e);else{var t=!!i.get(e.id),r=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag","pin","modify"].indexOf(e.type)>-1;r?t&&r?n.push(e):Q["default"].log("Model:chat:handle received junk chat record: "+(0,l["default"])(e))():a.push(e)}});var r=j["default"].findIndex(a,function(e){return Te["default"].isPSA(e.id)});r>-1&&(a[r].name=l10n.t("whatsapp_psa_contact_name")),i.add(a,{merge:!0}),n.forEach(function(e){var t=e.type;if("c.us"===e.id){switch(i.disableSortListener(),t){case"clear":Q["default"].log("Model:chat:handle:clear:all before:"+e.before+" kind:"+e.kind)(),i.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)});break;case"delete":Q["default"].log("Model:chat:handle:delete:all")(),i.toArray().forEach(function(e){e.isGroup?e.deleteMsgs(!0):e["delete"]()});break;case"archive":Q["default"].log("Model:chat:handle:archive:all")(),i.forEach(function(e){e.archive=!0,e.pin=void 0});break;case"unarchive":Q["default"].log("Model:chat:handle:unarchive:all")(),i.forEach(function(e){e.archive=!1});break;case"unstar":Q["default"].log("Model:chat:handle:unstar:all")(),I["default"]["delete"](),i.forEach(function(e){e.unstarAll()});break;default:Q["default"].error("Model:chat:handle unknown "+(0,l["default"])(e),e)()}i.enableSortListener()}else{var a=i.get(e.id);if(!a)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var n=e.keys.length,r="star"===t,s=[],o=[],u=[],c=!1,f=0;f<n;f++){var h=void 0,p=void 0,g=void 0,v=void 0,_=void 0,m=e.keys[f];if(Array.isArray(m)){var y=(0,d["default"])(m,3);h=y[0],p=y[1],g=y[2],v=new X["default"]({fromMe:p,remote:e.id,id:h,participant:g}),_=he["default"].Msg.get(v),_?"clear"===t?_["delete"]():(_.star=r,u.push(_)):r&&(c=!0)}else!j["default"].isObject(m)||"star"!==t&&"unstar"!==t||(v=m.id,_=he["default"].Msg.get(m.id),_?(_.star=r,u.push(_)):o.push(m));s.push(v&&v.toString())}"star"!==t&&"unstar"!==t||I["default"].process(r,o,u,c),Q["default"].log("model:Chat:handle:messages:"+[t,e.id,s.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?a.deleteMsgsOlderThan(e.before,e.star,e.kind):a.deleteMsgs(e.star,e.kind),Q["default"].log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag,e.kind].join())()):"unstar"===t&&(a.unstarAll(),Q["default"].log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(a.modifyTag=e.modifyTag);break;case"delete":a["delete"](),Q["default"].log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":a.archive=!0,a.pin=void 0;break;case"unarchive":a.archive=!1;break;case"spam":a.notSpam=e.notSpam;break;case"modify_tag":a.modifyTag=e.modifyTag;break;case"pin":a.pin=e.pin;break;case"modify":a.changeNumberOldJid=e.changeNumberOldJid,a.changeNumberNewJid=e.changeNumberNewJid}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=i.get(e);t&&t.exit()});else if("preempt"===t.cmd)this.add(t.response,{merge:!0}),Y["default"].platform===x.PLATFORMS.IPHONE&&(j["default"].isEmpty(t.response)?he["default"].Msg.trigger(V["default"].COLLECTION_HAS_SYNCED):setTimeout(function(){he["default"].Msg.trigger(V["default"].COLLECTION_HAS_SYNCED)},2500)),this.trigger(V["default"].COLLECTION_HAS_SYNCED,{count:t.response.length,binarySize:t.binarySize});else if("action"===t.cmd){var o=t.id,u=t.data;if("create"===u[0]||"introduce"===u[0]){var c=u[1],f=u[2],h=[].concat((0,s["default"])(j["default"].map(f.admins,function(e){return{id:e,isAdmin:!0}})),(0,s["default"])(j["default"].map(f.superadmins||[],function(e){return{id:e,isAdmin:!0,isSuperAdmin:!0}})),(0,s["default"])(j["default"].map(f.regulars,function(e){return{id:e,isAdmin:!1}})));he["default"].GroupMetadata.add({id:o,creation:f.creation,owner:c,participants:h,stale:!1,desc:f.desc,descId:f.descId,descTime:f.descTime,descOwner:f.descOwner,restrict:!!f.restrict,announce:!!f.announce},{merge:!0}),he["default"].Contact.add({id:o,name:f.subject},{merge:!0});var p=this.get(o);if(!p)return;var g=p.msgs.last();if(!g)return;"gp2"===g.type&&"add"===g.subtype&&(he["default"].GroupMetadata.trigger("group_participant_change_"+Y["default"].me.toString(),o),Te["default"].equals(j["default"].head(g.recipients),Y["default"].me)&&U["default"].alertNewMsg(g))}else{var v=this.get(t.id);v?v.handleGroupAction.apply(v,t.data):Q["default"].error("model:chat: unknown chat for action "+(0,l["default"])(t))()}}else Q["default"].error("model:chat: unknown payload: "+(0,l["default"])(t))()}},{key:"createGroup",value:function(e,t,i,a,n,r,s,o){var d=this,u=j["default"].map(a,"id"),l=ye["default"].createGroup(e,u,r,(0,$["default"])(),s,o),c=new L.ActionType(l10n.t("action_group_creating"));n=n||(0,L.genId)();var f=l.then(function(e){return 200===e.status?new L.ActionType(l10n.t("action_group_created")):406===e.status?new L.ActionType(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):429===e.status?new L.ActionType(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_429")):void 0})["catch"](function(r){return Q["default"].error("models:chatCollection:createGroup dropped")(r),new L.ActionType(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),d.createGroup.bind(d,e,t,i,a,n))});return U["default"].openToast(re["default"].createElement(L.ActionToast,{id:n,initialAction:c,pendingAction:f})),l.then(function(e){if(200===e.status&&e.gid&&d.find(e.gid).then(function(e){U["default"].openChatBottom(e).then(function(t){t&&U["default"].focusChatTextInput(e)})}),200===e.status&&!e._duplicate&&t&&i){var a=te["default"].gadd(e.gid);return(0,pe.setProfilePic)(a,t,i)}200===e.status&&e._duplicate&&Q["default"].error("createGroup failed to set picture.")()})}},{key:"sync",value:function(){return this.findQuery({})["catch"](A.WapDrop,function(){}),f["default"].all([w.waitForBBEvent(this,V["default"].COLLECTION_HAS_SYNCED),he["default"].Msg._hasSynced()])}},{key:"getKeysForResyncMsgs",value:function(){var e=this.filter(function(e){return e.isVisible});return e.map(function(e){var t=e.getAckedPhoneProps(),i=e.lastReceivedKey;return i&&(t.id=i.id,t.fromMe=i.fromMe.toString(),t.participant=i.participant),t})}},{key:"setKeysForResyncMsgs",value:function(e){this.keysForResyncMsgs=e}},{key:"resetKeysForResyncMsgs",value:function(){this.keysForResyncMsgs=void 0}},{key:"resyncMessages",value:function(){var e=this;Q["default"].log("ChatStore:resyncMessages")();var t=this.keysForResyncMsgs||this.getKeysForResyncMsgs();return ye["default"].resyncMessages(t).then(function(t){if(t.status>=400)return Q["default"].error("ChatStore:resyncMessages resume error "+t.status)(),f["default"].reject(new Error("ChatStore:resyncMessages resume error "+t.status));Q["default"].log("ChatStore:resyncMessages resume success")();var i=e.keysForResyncMsgs&&e.promises.initializeRestFromTabletCache?e.promises.initializeRestFromTabletCache:f["default"].resolve();return i.then(function(){t.checksum&&he["default"].Contact.resyncContacts(t.checksum),t.statusChecksum&&he["default"].StatusV3.sync(t.statusChecksum),t.quickRepliesChecksum&&ae["default"].sync(t.quickRepliesChecksum),t.labelsChecksum&&K["default"].sync(t.labelsChecksum),t.stickerPackChecksum&&ce["default"].sync(t.stickerPackChecksum),e.disableSortListener(),t.data.forEach(function(t){if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){var i=t.keys[0];t.firstUnreadKey=new X["default"]({id:i[0],fromMe:i[1],participant:i[2],remote:t.id})}if("delete"!==t.type&&!Te["default"].isPSA(t.id)){var a=he["default"].Contact.get(t.id);a?t.name&&(a.name=t.name):he["default"].Contact.add({id:t.id,name:t.name})}var n=e.get(t.id);if(!n)return void e.add(t);if("clear"===t.type){n.resetMediaMsgs();var r=[];n.msgs.forEach(function(e){return r.push(e)}),n.msgChunks.length&&n.msgChunks.forEach(function(e){e.forEach(function(e){return r.push(e)})}),n.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration}),j["default"].each(r,function(e){e["delete"]()}),Q["default"].log("model:chat:resume: cleared chat for "+t.id)()}else"delete"===t.type?(n["delete"](),Q["default"].log("model:chat:resume: deleted chat for "+t.id)()):n.set(t,{merge:!0})})})["finally"](function(){e.enableSortListener(!0)})})["catch"](A.WapDrop,function(e){return Q["default"].error("ChatStore:resyncMessages resume dropped")(),f["default"].reject(e)})["finally"](function(){e.resetKeysForResyncMsgs()})}},{key:"unstarAllMessages",value:function(e,t){var i=this,a=t?t.promises:this.promises,n=t?t.id:void 0;if(a.sendUnstarAll)return a.sendUnstarAll;var r=a.sendUnstarAll=ye["default"].sendUnstarAll(n),s=new L.ActionType(l10n.t("action_message_unstarring_all")),o=r.then(function(e){return 200===e.status?new L.ActionType(l10n.t("action_message_unstarred_all")):e.status>=400?new L.ActionType(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(a){return Q["default"].error("models:chat:sendUnstarAll dropped")(a),new L.ActionType(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return i.unstarAllMessages(e,t)})});return U["default"].openToast(re["default"].createElement(L.ActionToast,{id:(0,L.genId)(),initialAction:s,pendingAction:o})),r.then(function(a){200===a.status&&(j["default"].forEach(e,function(e){e.set("star",!1)}),t?(0,O.removeStarredMsgs)(e):(I["default"].reset(),ue["default"].reset(),i.forEach(function(e){e.starredMsgs&&e.starredMsgs.reset()})))})["finally"](function(){a.sendUnstarAll=null})}},{key:"forwardMessagesToChats",value:function(e,t){var a=i('"cicafdbeje"'),n=f["default"].map(e,function(e){return f["default"].props({message:e,canForward:e.canForward()})});return f["default"].map(t,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?(0,_e.unblockContact)(e.contact):f["default"].resolve(!0),f["default"].all([n,t]).spread(function(t,i){var a=j["default"].map(j["default"].filter(t,{canForward:!0}),"message"),n=j["default"].map(j["default"].filter(t,{canForward:!1}),"message");return f["default"].props({chat:e,undelivered:e.forwardMessages(a,!0),canForward:a,cannotForward:n})})}).then(function(e){var t=j["default"].compact(e.map(function(e){var t=e.chat,i=e.undelivered,n=e.canForward,r=e.cannotForward,s=null;return(i.length||r.length)&&(s=a.formatForwardError({chat:t,undelivered:i,canForward:n,cannotForward:r})),s?{chat:t,reason:s}:null}));if(t.length)throw new H["default"](t);return!0})}},{key:"saveToCache",value:function(){if(Y["default"].me){var e=t.cachePolicy.id;Q["default"].log("ChatCollection:saveToCache save: "+String(e))();var i=this.map(function(e,t){var i=e.toJSON();return i.msgs=e.msgs?e.msgs.slice(t<50?-10:-3).map(function(e){return e.toJSON()}):[],i});ve["default"].setCollection(e,i,!0)}}},{key:"delete",value:function(){(0,E["default"])(t.prototype.__proto__||(0,p["default"])(t.prototype),"delete",this).call(this),this.listenToOnce(this,"sort",j["default"].debounce(this.setIndexes,100))}}]),t}(R["default"]);Ee.model=G["default"],Ee.comparator=D.ChatComparator,Ee.cachePolicy={id:"chat",policy:N.CACHE_POLICY.IMMEDIATE,trigger:"add\n        sort\n        remove\n        reset\n        change:id\n        change:t\n        change:unreadCount\n        change:archive\n        change:isReadOnly\n        change:isAnnounceGrpRestrict\n        change:modifyTag\n        change:muteExpiration\n        change:name\n        change:notSpam\n        change:pin\n        change:changeNumberOldJid\n        change:changeNumberNewJid\n        change:lastReceivedKey\n        change:msg:ack"},t["default"]=new Ee},'"cdhdbfibgi"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"biafgdghfb"'),b=a(y),T=i('"deijabejja"'),E=n(T),M=i('"bjjbbjfiee"'),C=n(M),S=i('"bidieaecca"'),j=n(S),k=i('"bdcdfifjcj"'),A=n(k),P=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.hasDocBefore=!0,n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.stopListening(),this.reset()}},{key:"queryDocs",value:function(e,t){var i=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=j["default"].queryMedia(t.id.remote,E["default"].MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<E["default"].MEDIA_QUERY_LIMIT)&&(i.hasDocBefore=!1),i.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}})["catch"](b.WapDrop,b.ProtoVersionUndefined,404,function(){})["finally"](function(){i.queryDocBefore=null,i.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var a=e.msgs;if(0===this.length){if(!a||0===a.length)return this.hasDocBefore=!1,new s["default"](function(e){e({eof:!0})});this.add(a.filter(function(e){return e.isDoc}),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new s["default"](function(e){e({eof:!0})});if(this.length<=2*E["default"].MEDIA_QUERY_LIMIT){var n=0===this.length?a.head():this.head();return this.queryDocs(e,n)}return new s["default"](function(e){e({eof:!1})})}}]),t}(A["default"]);P.model=C["default"],t["default"]=P},'"ebbfhbdfgd"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"biafgdghfb"'),b=a(y),T=i('"deijabejja"'),E=n(T),M=i('"bjjbbjfiee"'),C=n(M),S=i('"bidieaecca"'),j=n(S),k=i('"bdcdfifjcj"'),A=n(k),P=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.hasLinkBefore=!0,n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.stopListening(),this.reset()}},{key:"queryLinks",value:function(e,t){var i=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=j["default"].queryMedia(t.id.remote,E["default"].MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){
return(!e||e.length<E["default"].MEDIA_QUERY_LIMIT)&&(i.hasLinkBefore=!1),i.add(e,{at:0}),i.createLinksAndAddMsgs(e),{length:e.length}})["catch"](b.WapDrop,b.ProtoVersionUndefined,404,function(){})["finally"](function(){i.queryLinkBefore=null,i.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var a=e.msgs.getModelsArray();if(0===this.length){if(!a||0===a.length)return this.hasLinkBefore=!1,new s["default"](function(e){e({eof:!0})});this.add(a.filter(function(e){return e.getLinks().length>0}),{at:0}),this.createLinksAndAddMsgs(a)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new s["default"](function(e){e({eof:!0})});if(this.length<=2*E["default"].MEDIA_QUERY_LIMIT){var n=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,n)}return new s["default"](function(e){e({eof:!1})})}},{key:"createLinksAndAddMsgs",value:function(e){var t=this,i=[];s["default"].loop(function(t,a,n){e.length===n&&t();var r=e[n],s=r.getLinks();s.length&&i.push(r)}).then(function(){t.add(i),t.trigger("query_link_before")})}}]),t}(A["default"]);P.model=C["default"],P.comparator=function(e,t){return e.t-t.t},t["default"]=P},'"ddebcfiabb"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgafgbafci"'),b=n(y),T=i('"biafgdghfb"'),E=a(T),M=i('"deijabejja"'),C=n(M),S=i('"bjjbbjfiee"'),j=n(S),k=i('"bidieaecca"'),A=n(k),P=i('"bdcdfifjcj"'),w=n(P),O={before:"before",after:"after"},I=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.hasMediaBefore=!0,a.hasMediaAfter=!0,n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.stopListening()}},{key:"contains",value:function(e){return this.indexOf(e)>-1}},{key:"getAfter",value:function(e){var t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}},{key:"getBefore",value:function(e){var t=this.indexOf(e);return t<=0?null:this.at(t-1)}},{key:"loadEarlierMedias",value:function(){var e=this.head();e&&this.queryMedia(null,e)}},{key:"loadRecentMedias",value:function(){var e=this.last();e&&this.queryMedia(null,e,O.after)}},{key:"loadMoreAroundIfNeeded",value:function(e){if(e){var t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}}},{key:"queryMedia",value:function(e,t){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.before;if(!t&&e){var n=e.msgs;if(!n||0===n.length)return this.hasMediaBefore=!1,new s["default"](function(e){e({eof:!0})});this.add(n.filter(function(e){return e.isMedia}),{at:0});var r=this.toArray();if(this.downloadMedias(r),e.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new s["default"](function(e){e({eof:!0})});if(r.length<=2*C["default"].MEDIA_QUERY_LIMIT){var o=0===r.length?n.head():b["default"].head(r);return this.queryMedia(e,o)}return new s["default"](function(e){e({eof:!1})})}if(t&&a===O.before){if(this.queryMediaBefore)return this.queryMediaBefore;var d=0;return this.queryMediaBefore=A["default"].queryMedia(t.id.remote,C["default"].MEDIA_QUERY_LIMIT,a,t.isMedia?t.id:void 0).then(function(t){var a=t.messages;(!a||a.length<C["default"].MEDIA_QUERY_LIMIT)&&(i.hasMediaBefore=!1);var n=[];a&&a.length>0&&(n=a.filter(function(e){return e.isMedia}),i.downloadMedias(n)),i.add(n,{at:0});var r={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return e&&e.resetMediasCount(r),d=n.length,{length:d}})["catch"](E.WapDrop,E.ProtoVersionUndefined,404,function(){})["finally"](function(){i.queryMediaBefore=null,i.trigger("query_media_before",d)}),this.trigger("query_media_before",0),this.queryMediaBefore}if(t&&a===O.after)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=A["default"].queryMedia(t.id.remote,C["default"].MEDIA_QUERY_LIMIT,a,t.id).then(function(t){var a=t.messages;(!a||a.length<C["default"].MEDIA_QUERY_LIMIT)&&(i.hasMediaAfter=!1);var n=[];a&&a.length>0&&(n=a.filter(function(e){return e.isMedia}),i.downloadMedias(n)),i.add(n);var r={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return e&&e.resetMediasCount(r),{length:n.length}})["catch"](E.WapDrop,E.ProtoVersionUndefined,404,function(){})["finally"](function(){i.queryMediaAfter=null,i.trigger("query_media_after")})}},{key:"downloadMedias",value:function(e){b["default"].forEach(e,function(e){e.downloadMedia()})}}]),t}(w["default"]);I.model=j["default"],t["default"]=I},'"bhchacaadd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=void 0;var n=i('"cfcbddfj"'),r=a(n),s=i('"cdfdhedgig"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"bebcachjfd"'),_=a(v),m=i('"bjjbbjfiee"'),y=a(m),b=i('"ebhdebaagj"'),T=a(b),E=i('"bdcdfifjcj"'),M=a(E),C=function(e){function t(){var e,i,a,n;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(s))),a.noEarlierMsgs=(0,v.prop)(),a.isLoadingEarlierMsgs=(0,v.prop)(),a.isLoadingRecentMsgs=(0,v.prop)(),a.isLoadingAroundMsgs=(0,v.prop)(),a.contextLoaded=(0,v.prop)(),n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),t}(_["default"]);C.Proxy="msgLoad";var S=t.MsgLoadState=(0,v.defineModel)(C),j=function(e){function t(){(0,c["default"])(this,t);var e=(0,h["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this));return e.msgLoadState=new S({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),e.listenTo(e,"add remove reset sort",e.triggerChangeLast),e}return(0,g["default"])(t,e),(0,r["default"])(t,[{key:"delete",value:function(){this.stopListening(),(0,o["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"delete",this).call(this),this.msgLoadState["delete"]()}},{key:"triggerChangeLast",value:function(e,t,i){var a=this.last();if(this._last!==a){this._last=a;var n=!1;t&&t.indexOf(e)>-1&&i&&i.add&&!i.remove&&(n=!0),this.trigger("change:last",a,n)}}},{key:"add",value:function(e,i){var a=this,n=(0,o["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"add",this).call(this,e,i),r=T["default"].Msg.add(n,i);return r.forEach(function(e){e&&a.isModel(e)&&(e.msgChunk=a)}),n&&this.trigger("bulk_add",n,i),n}},{key:"remove",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(0,o["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"remove",this).call(this,e,i),r=!!i&&i.silent,s=n.filter(function(e){return!!e});return s.length&&!r&&(this.trigger("remove_msgs",s,i),a||this.trigger("update_sort_time")),n}},{key:"replace",value:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;var i=e.getModelsArray();this.set(i,{silent:!0,merge:!1}),i.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",i)}}]),t}(M["default"]);j.model=y["default"],t["default"]=j},'"dhcgjabjfc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=i('"bafjcjabca"'),g=a(p),v="defaultPreference",_=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.wallpaperColor=(0,f.prop)(),a.saveToCameraRoll=(0,f.prop)(),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);_.Collection="ChatPreference",_.Proxy="chatPreference",_.idClass=g["default"],_.idWhitelist=[v],t.DEFAULT_PREFERENCE=v,t["default"]=(0,f.defineModel)(_)},'"bfbbbhhbif"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=i('"deehjbcdej"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"cdfdhedgig"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"bdcdfifjcj"'),y=a(m),b=i('"dhcgjabjfc"'),T=a(b),E=i('"deijabejja"'),M=a(E),C=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"initializeFromCache",value:function(e){e=e||[],this.add([{id:b.DEFAULT_PREFERENCE,wallpaperColor:M["default"].DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0}].concat((0,r["default"])(e)),{merge:!0})}},{key:"get",value:function(e){return(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"get",this).call(this,e)||(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"get",this).call(this,b.DEFAULT_PREFERENCE)}},{key:"delete",value:function(){(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"delete",this).call(this),this.add({id:b.DEFAULT_PREFERENCE,wallpaperColor:M["default"].DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0})}}]),t}(y["default"]);C.model=T["default"],C.cachePolicy={id:"chat_preference",policy:m.CACHE_POLICY.LOAD,delay:1e3},e.exports=new C},'"eagaagffca"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"bejijbfaij"'),v=n(g),_=i('"bdcdfifjcj"'),m=n(_),y=i('"bjjbbjfiee"'),b=n(y),T=i('"djdcdaecea"'),E=n(T),M=i('"biafgdghfb"'),C=a(M),S=i('"bidieaecca"'),j=n(S),k=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.syncPromise=null,a.isSynced=!1,n=i,(0,p["default"])(a,n)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"onResume",value:function(){this.isSynced=!1,this.sync(this.parent)}},{key:"sync",value:function(e){var t=this;return E["default"].supportsFeature(E["default"].F.INDEX_RECEIVED_VCARD)?this.isSynced?s["default"].resolve():this.syncPromise?this.syncPromise:(this.syncPromise=j["default"].queryVCard(e.id).then(function(e){return t.add(e)})["catch"](C.E499,function(){})["catch"](function(){})["finally"](function(){t.isSynced=!0,t.syncPromise=null}),this.syncPromise):(this.isSynced=!0,s["default"].resolve())}}]),t}(m["default"]);k.model=b["default"],k.resumeOnAvailable=!0,t["default"]=k},'"beedadgbij"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}var r=i('"djecddgbji"'),s=n(r),o=i('"bfhecaifff"'),d=n(o),u=i('"deijabejja"'),l=n(u),c=i('"cjgfdijdhj"'),f=n(c),h=i('"cehbbagije"'),p=n(h),g=i('"gidjgebhh"'),v=a(g),_=i('"biafgdghfb"'),m=a(_),y=i('"dhcbeegjcf"'),b=n(y),T=i('"bfhdcihhcd"'),E=n(T),M=i('"bbfdbjiiha"'),C=n(M),S=i('"bhgjfefcea"'),j=n(S),k={handle:function(e){var t=(0,s["default"])(e,1),i=t[0];switch(i.type){case"const":l["default"][i.key]=i.value;break;case"read":if(i.isStatus){j["default"].handle([i]);break}case"unread":var a=d["default"].get(i.jid);a&&("read"===i.type?a.markSeen():"unread"===i.type&&a.markUnseen());break;case"picture":b["default"].imageChanged(i.jid,i.tag);break;case"log":v.upload("server-requested",!0,!0);break;case"privacy":if(i.jid){var n=E["default"].get(i.jid);n&&n.reset(),b["default"].update(i.jid)["catch"](m.WapDrop,function(){}),C["default"].update(i.jid)["catch"](m.WapDrop,function(){})}else p["default"].error("Store:Cmd:handle:privacy no jid",i)();break;case"identity":if(i.jid){var r=f["default"].get(i.jid);r?r.updateIdentity(i):p["default"].error("Store:Cmd:handle:identity no contact",i)()}else p["default"].error("Store:Cmd:handle:identity no jid",i)();break;default:p["default"].warn("Store:Cmd:handle:unknown "+i.type,i)()}}};e.exports=k},'"bcihgfbdeb"':function(e,t,i){"use strict";e.exports={AllStarredMsgs:i('"ifeajjdda"')["default"],Blocklist:i('"bgabbbeeca"')["default"],BusinessProfile:i('"bbdgfgchj"')["default"],Call:i('"dgbfgjhfih"')["default"],Chat:i('"bfhecaifff"')["default"],ChatPreference:i('"bfbbbhhbif"'),Cmd:i('"beedadgbij"'),Conn:i('"jfefjijii"')["default"],Contact:i('"cjgfdijdhj"')["default"],ConversionTuple:i('"cfafceedhd"'),EmojiVariant:i('"dajejfbchh"')["default"],GroupMetadata:i('"bfibgjihae"'),Label:i('"degdhgidga"')["default"],LiveLocation:i('"cgbccbigbh"')["default"],Msg:i('"bidieaecca"')["default"],MsgInfo:i('"eagaccadah"')["default"],Mute:i('"ecdjibbjgf"')["default"],Presence:i('"bfhdcihhcd"')["default"],ProfilePicThumb:i('"dhcbeegjcf"')["default"],QuickReply:i('"cgedjbeaff"')["default"],RecentEmoji:i('"dajfehefaj"')["default"],RecentSticker:i('"debfbgiegd"')["default"],ServerProps:i('"bjhdjifgah"')["default"],StarredGifMsgs:i('"dfcdjadaii"'),Status:i('"bbfdbjiiha"')["default"],StatusV3:i('"bhgjfefcea"')["default"],Sticker:i('"djbjahehie"')["default"],StickerPack:i('"hjcebdiai"')["default"],Stream:i('"djddhaidag"')["default"],Wap:i('"dgfhfgbdeb"')["default"],Wid:i('"beijgedgcc"')}},'"cababebgga"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"dejhjidfgh"'),g=a(p),v=i('"bfhecaifff"'),_=a(v),m=i('"jfefjijii"'),y=a(m),b=i('"dafgbfehgf"'),T=a(b),E=i('"ebhdebaagj"'),M=a(E),C=i('"bdcdfifjcj"'),S=a(C),j=function(e){function t(e,i){(0,o["default"])(this,t);var a=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return a.stale=!1,a.add(e,{silent:!0}),a.contact=i,a.listenTo(M["default"].GroupMetadata,"group_participant_change_"+y["default"].me.toString(),a.updateCommonGroups),a.listenTo(M["default"].GroupMetadata,"group_participant_change_"+a.contact.toString(),a.updateCommonGroups),a.listenTo(T["default"],"change:stream",function(){T["default"].stream===b.STREAM.DISCONNECTED&&(a.stale=!0)}),a}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"updateCommonGroups",value:function(e){var t=M["default"].GroupMetadata.assertGet(e),i=t.participants,a=y["default"].me;this.get(e)?i.get(this.contact)&&i.get(a)||this.remove(e):i.get(this.contact)&&i.get(a)&&this.add(_["default"].assertGet(e))}}]),t}(S["default"]);j.model=g["default"],j.comparator=p.ChatComparator,t["default"]=j},'"jfefjijii"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mcc,i=e.mnc;t&&"string"==typeof t&&(t=parseInt(t,10)),i&&"string"==typeof i&&(i=parseInt(i,10)),q["default"].Global.set({mcc:t||null,mnc:i||null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0;var s=i('"cdehffajbd"'),o=n(s),d=i('"djecddgbji"'),u=n(d),l=i('"ddcedhgjff"'),c=n(l),f=i('"ebfebbhae"'),h=n(f),p=i('"cfcbddfj"'),g=n(p),v=i('"dfhdhdbidh"'),_=n(v),m=i('"bejijbfaij"'),y=n(m),b=i('"bgafgbafci"'),T=n(b),E=i('"bgaddigcjb"'),M=n(E),C=i('"bebcachjfd"'),S=n(C),j=i('"ciehgcaebf"'),k=i('"baggieehcg"'),A=a(k),P=i('"jfjcddeeg"'),w=n(P),O=i('"jidadafab"'),I=n(O),L=i('"fhabbhhjc"'),N=n(L),R=i('"deijabejja"'),D=n(R),G=i('"djdcdaecea"'),F=n(G),U=i('"dgfegfjajf"'),x=n(U),Y=i('"cehbbagije"'),B=n(Y),V=i('"dacbaddbce"'),q=n(V),H=i('"ebhdebaagj"'),W=n(H),K=i('"hcddbeaic"'),z=n(K),Q=t.PLATFORMS={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"},J=function(e){function t(){var e,i,a,n;(0,h["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,_["default"])(this,(e=t.__proto__||(0,c["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,C.prop)(),a.ref=(0,C.prop)(),a.refTTL=(0,C.prop)(),a.refId=(0,C.prop)(),a.wid=(0,C.prop)(),a.connected=(0,C.prop)(),a.me=(0,C.prop)(),a.protoVersion=(0,C.prop)(),a.clientToken=(0,C.prop)(),a.serverToken=(0,C.prop)(),a.secret=(0,C.prop)(),a.isResponse=(0,C.prop)(),a.battery=(0,C.prop)(),a.plugged=(0,C.prop)(),a.lc=(0,C.prop)(),a.lg=(0,C.prop)(),a.locales=(0,C.prop)(),a.is24h=(0,C.prop)(),a.platform=(0,C.prop)(),a.phone=(0,C.prop)(),a.tos=(0,C.prop)(),a.smbTos=(0,C.prop)(0),a.pushname=(0,C.prop)(),a.blockStoreAdds=(0,C.session)(!1),a.refExpiry=(0,C.derived)(a._refExpiry,["ref","refTTL"]),a.locale=(0,C.derived)(a._locale,["lg","lc"]),a.localesList=(0,C.derived)(a._localesList,["locales","lg","lc"]),a.allLocales=(0,C.derived)(a._allLocales,["localesList"]),a.allLanguages=(0,C.derived)(a._allLanguages,["localesList"]),a.platformField=(0,C.derived)(a._platformField,["platform"]),a.tosShowCallNotification=(0,C.derived)(a._tosShowCallNotification,["tos"]),a.isSMB=(0,C.derived)(a._isSMB,["platform"]),n=i,(0,_["default"])(a,n)}return(0,y["default"])(t,e),(0,g["default"])(t,[{key:"_refExpiry",value:function(){return Date.now()+this.refTTL}},{key:"_locale",value:function(){return this.formatLocale(this.lg,this.lc)}},{key:"_localesList",value:function(){return this.locales&&this.locales.length?this.locales.split(",").map(function(e){var t=e.split("-"),i=(0,u["default"])(t,2),a=i[0],n=i[1];return a?[a,n]:null}).filter(function(e){return!!e}):this.lg?[[this.lg,this.lc]]:[]}},{key:"_allLocales",value:function(){var e=this;return T["default"].uniq(this.localesList.map(function(t){var i=(0,u["default"])(t,2),a=i[0],n=i[1];return e.formatLocale(a,n)}))}},{key:"_allLanguages",value:function(){return T["default"].uniq(this.localesList.map(function(e){var t=(0,u["default"])(e,2),i=t[0];t[1];return i}))}},{key:"_platformField",value:function(){return"wp7"===this.platform?q["default"].PLATFORM_TYPE.WP:this.platform?q["default"].PLATFORM_TYPE[this.platform.toUpperCase()]||q["default"].PLATFORM_TYPE.UNKNOWN:q["default"].PLATFORM_TYPE.UNKNOWN}},{key:"_tosShowCallNotification",value:function(){return this.tos<2}},{key:"_isSMB",value:function(){return this.platform===Q.SMBA||this.platform===Q.SMBI}},{key:"initialize",value:function(){var e=this;S["default"].prototype.initialize.call(this),this.listenTo(this,"change:locale",function(e,t){x["default"].setLocale(t,D["default"].L10N_PRIORITY.PHONE)}),this.listenTo(this,"change:plugged",T["default"].debounce(function(){q["default"].Global.webcPhoneCharging=e.plugged},5e3,{leading:!0})),this.listenTo(this,"change:phone",function(){r(e.phone)}),this.listenTo(this,"change:me",this.updateVoipAvailability),this.listenTo(F["default"],F["default"].FEATURE_CHANGE_EVENT,this.updateVoipAvailability),this.listenTo(this,"change:platform",this.handlePlatformChange)}},{key:"delete",value:function(){z["default"].setPushname(),z["default"].setLastMobilePlatform(),z["default"].setVersion(),this.clear()}},{key:"handle",value:function(e){var t=this,a=void 0,n=e.shift();n.id="1";var r=i('"dgfhfgbdeb"')["default"],s=n.protoVersion,d=n.binVersion,u=n.features;if(s){F["default"].setVersion(s),u=u||{};var l=F["default"].setFeatures(u);a=!!l.KEY_PARTICIPANT,r.setVersion(s,d,u.FLAGS),W["default"].ServerProps.webRestoreFromCache&&z["default"].setVersion({protoVersion:s,features:u.FLAGS})}if(n.initial){F["default"].setPlatform(n.platform,n.phone),z["default"].setLogoutToken(n.browserToken),n.hasOwnProperty("is24h")&&I["default"].setIs24Hour(n.is24h);var c=n.ref,f=n.serverToken,h=n.clientToken,p=n.connected;c&&p&&f&&z["default"].setRefTok(c,f),z["default"].setLoginTokens({client:h,server:f});var g=n.secret?r.setSharedSecret(n.secret):o["default"].resolve();return g.then(function(){if("true"!==n.isResponse&&A.save(),"iw"===n.lg&&(n.lg="he"),n.wid){var e=n.wid;t.me=e,n.pushname&&(t.pushname=n.pushname,W["default"].ServerProps.webRestoreFromCache&&z["default"].setPushname(n.pushname)),z["default"].setMe(e),W["default"].Contact.gadd(e)}t.set(n)})}return this.connected&&a&&(B["default"].log("models:Conn:participantChange:to:"+String(F["default"].supportsFeature(F["default"].F.KEY_PARTICIPANT)))(),w["default"].hardRefresh()),this.set(n),o["default"].resolve()}},{key:"canSetMyPushname",value:function(){return!this.isSMB}},{key:"updatePushname",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments[1];if(t=t.trim(),!t)return o["default"].reject(new j.ActionType("action_pushname_empty"));if(/[\u2714\u2705\u2611]/g.test(t))return o["default"].reject(new j.ActionType("action_pushname_set_failed_check"));var n=i('"dgfhfgbdeb"')["default"],r=n.setPushname(t),s=new j.ActionType(x["default"].t("action_pushname_setting")),d=this.pushname;a=a||(0,j.genId)();var u=r.then(function(t){return 200===t.status?new j.ActionType(x["default"].t("action_pushname_set"),x["default"].t("action_undo"),e.updatePushname.bind(e,d,a)):t.status>=400?new j.ActionType(x["default"].t("action_pushname_set_failed")):void 0})["catch"](function(t){throw B["default"].error("models:conn:updatePushname dropped")(t),new j.ActionType(x["default"].t("action_pushname_set_failed"),x["default"].t("action_try_again"),e.updatePushname.bind(e,status,a))});return N["default"].openToast(M["default"].createElement(j.ActionToast,{id:a,initialAction:s,pendingAction:u})),r.then(function(i){200!==i.status||i._duplicate||(e.pushname=t,W["default"].ServerProps.webRestoreFromCache&&z["default"].setPushname(t))})}},{key:"updateVoipAvailability",value:function(){var e=i('"caijeihhcg"')["default"];(F["default"].supportsFeature(F["default"].F.VOIP_INDIVIDUAL_OUTGOING)||F["default"].supportsFeature(F["default"].F.VOIP_INDIVIDUAL_INCOMING))&&(this.me?e.init():e.cleanup())}},{key:"handlePlatformChange",value:function(){z["default"].setLastMobilePlatform(this.platform)}},{key:"formatLocale",value:function(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}}]),t}(S["default"]);J.Proxy="conn";var X=(0,C.defineModel)(J);t["default"]=new X({id:"1"})},'"ddahgaaff"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k["default"].L10N.DEFAULT;if(window.Intl&&window.Intl.Collator){var t=window.Intl.Collator([e],{sensitivity:"base"});ne={compare:function(e,i){try{return t.compare(e,i)}catch(a){return 0}}}}else ne={compare:function(e,t){return e.localeCompare(t)}}}function r(e,t){var i=e.id.toString(),a=t.id.toString();if(i===L["default"].me.toString())return 1;if(a===L["default"].me.toString())return-1;var n=e.name,r=t.name;if(!n&&r)return 1;if(n&&!r)return-1;if(n&&r&&e.header&&t.header){var s=ne.compare(e.header,t.header);return 0===s?ne.compare(n,r):s}return i&&a?i.localeCompare(a):-1}Object.defineProperty(t,"__esModule",{value:!0});var s=i('"cdehffajbd"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"cfcbddfj"'),h=a(f),p=i('"dfhdhdbidh"'),g=a(p),v=i('"cdfdhedgig"'),_=a(v),m=i('"bejijbfaij"'),y=a(m);t.ContactComparator=r;var b=i('"bgafgbafci"'),T=a(b),E=i('"bebcachjfd"'),M=a(E),C=i('"bgabbbeeca"'),S=a(C),j=i('"deijabejja"'),k=a(j),A=i('"fhabbhhjc"'),P=a(A),w=i('"cababebgga"'),O=a(w),I=i('"jfefjijii"'),L=a(I),N=i('"djdcdaecea"'),R=a(N),D=i('"cehbbagije"'),G=a(D),F=i('"ebhdebaagj"'),U=a(F),x=i('"dhcbeegjcf"'),Y=a(x),B=i('"bbfdbjiiha"'),V=a(B),q=i('"bafjcjabca"'),H=a(q),W=i('"dgfhfgbdeb"'),K=a(W),z=i('"dgfegfjajf"'),Q=a(z),J=i('"cgdjeaccg"'),X=a(J),Z=i('"eahfcjjjie"'),$=a(Z),ee=i('"dfjcdaddbe"'),te=a(ee),ie=i('"eaafgdhhia"'),ae=a(ie),ne=void 0,re=function(e){function t(){var e,i,a,n;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,g["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,E.prop)(),a.name=(0,E.prop)(),a.shortName=(0,E.prop)(),a.pushname=(0,E.prop)(),a.type=(0,E.prop)("in"),a.plaintextDisabled=(0,E.prop)(),a.verifiedName=(0,E.prop)(),a.isBusiness=(0,E.prop)(),a.isEnterprise=(0,E.prop)(),a.verifiedLevel=(0,E.prop)(),a.statusMute=(0,E.prop)(),a.sectionHeader=(0,E.prop)(),a.isContactBlocked=(0,E.prop)(!!S["default"].get(a.id)),a.labels=(0,E.prop)(),a.verificationString=(0,E.session)(),a.verificationBinary=(0,E.session)(),a.pendingAction=(0,E.session)(),a._notifyName=(0,E.session)(null),a.promises=(0,E.session)(function(){return{}}),a.status=(0,E.session)(),a.profilePicThumb=(0,E.session)(),a.businessProfile=(0,E.session)(),a.commonGroups=(0,E.session)(),a.liveLocations=(0,E.session)(),a.notifyName=(0,E.derived)(a._notifyNameFunction,["_notifyName","pushname","isBusiness","verifiedLevel","verifiedName"]),a.mentionName=(0,E.derived)(a._mentionName,["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),a.displayName=(0,E.derived)(a._displayName,["id","mentionName","isMe"]),a.userid=(0,E.derived)(a._userid),a.userhash=(0,E.derived)(a._userhash),a.searchName=(0,E.derived)(a._searchName,["name","id"]),a.searchVerifiedName=(0,E.derived)(a._searchVerifiedName,["verifiedLevel","verifiedName"]),a.header=(0,E.derived)(a._header,["name"]),a.isMe=(0,E.derived)(a._isMe),a.isUser=(0,E.derived)(a._isUser),a.isGroup=(0,E.derived)(a._isGroup),a.isBroadcast=(0,E.derived)(a._isBroadcast),a.isPSA=(0,E.derived)(a._isPSA),a.formattedShortNameWithNonBreakingSpaces=(0,E.derived)(a._formattedShortNameWithNonBreakingSpaces,["shortName","formattedName","id"]),a.formattedShortName=(0,E.derived)(a._formattedShortName,["shortName","formattedName","id"]),a.formattedName=(0,E.derived)(a._formattedName,["name","id"]),a.formattedUser=(0,E.derived)(a._formattedUser,["name","id"]),a.isWAContact=(0,E.derived)(a._isWAContact,["type"]),a.isMyContact=(0,E.derived)(a._isMyContact,["name"]),a.showBusinessCheckmark=(0,E.derived)(a._showBusinessCheckmark,["isBusiness","verifiedLevel","name","verifiedName"]),a.showBusinessVname=(0,E.derived)(a._showBusinessVname,["isBusiness","verifiedLevel","name","verifiedName"]),n=i,(0,g["default"])(a,n)}return(0,y["default"])(t,e),(0,h["default"])(t,[{key:"_notifyNameFunction",value:function(){return this.isBusiness&&this.verifiedLevel!==k["default"].VERIFIED_LEVEL.HIGH?this.verifiedName:R["default"].supportsFeature(R["default"].F.CONTACT_HAS_PUSHNAME)?this.pushname:this._notifyName?this._notifyName.name:void 0}},{key:"_mentionName",value:function(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==k["default"].VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}},{key:"_displayName",value:function(){return this.isMe?L["default"].pushname:this.mentionName||(0,te["default"])(this.id)}},{key:"_userid",value:function(){return this.isUser?H["default"].user(this.id):null}},{key:"_userhash",value:function(){return this.isUser?(0,X["default"])((this.id.user||"")+"WA_ADD_NOTIF"):null}},{key:"_searchName",value:function(){return H["default"].isPSA(this.id)?Q["default"].accentFold(Q["default"].t("whatsapp_psa_contact_name")):this.name?Q["default"].accentFold(this.name):null}},{key:"_searchVerifiedName",value:function(){return this.verifiedLevel!==k["default"].VERIFIED_LEVEL.HIGH?null:this.verifiedName?Q["default"].accentFold(this.verifiedName):null}},{key:"_header",value:function(){if(this.name){var e=this.name.toLowerCase(),t=$["default"].alpha.exec(e);if(t&&0===t.index||t&&$["default"].noDigits.test(e.slice(t.index))){var i=t[0],a=Q["default"].removeAccents(i);return ne.compare(a,i)?i:a}return"#"}}},{key:"_isMe",value:function(){return this.id.equals(L["default"].me)}},{key:"_isUser",value:function(){return H["default"].isUser(this.id)}},{key:"_isGroup",value:function(){return H["default"].isGroup(this.id)}},{key:"_isBroadcast",value:function(){return H["default"].isBroadcast(this.id)}},{key:"_isPSA",value:function(){return H["default"].isPSA(this.id)}},{key:"_formattedShortNameWithNonBreakingSpaces",value:function(){return this.id?this.isMe?Q["default"].t("web_you"):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g,"\xa0"):""}},{key:"_formattedShortName",value:function(){return this.id?this.isMe?Q["default"].t("web_you"):this.shortName||this.formattedName:""}},{key:"_formattedName",value:function(){if(!this.id)return"";if(this.isMe)return Q["default"].t("web_you");if(H["default"].isPSA(this.id))return Q["default"].t("whatsapp_psa_contact_name");var e=void 0;return this.name||(e=(0,te["default"])(this.id)),this.name||e}},{key:"_formattedUser",value:function(){return this.getFormattedUser()}},{key:"_isWAContact",value:function(){return this.isUser&&"in"===this.type}},{key:"_isMyContact",value:function(){return!!(this.isUser&&this.name&&this.name.length)}},{key:"_showBusinessCheckmark",value:function(){return this.isBusiness&&this.verifiedLevel===k["default"].VERIFIED_LEVEL.HIGH&&this.name===this.verifiedName}},{key:"_showBusinessVname",value:function(){return this.isBusiness&&this.verifiedLevel===k["default"].VERIFIED_LEVEL.HIGH&&this.name!==this.verifiedName}},{key:"initialize",value:function(){(0,_["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"initialize",this).call(this),this.id&&(H["default"].user(this.id)&&this.addChild("status",V["default"].gadd(this.id)),this.addChild("profilePicThumb",Y["default"].gadd(this.id)),this.isBusiness&&this.addChild("businessProfile",U["default"].BusinessProfile.gadd(this.id)),this.listenTo(this,"change:isBusiness",this.onIsBusinessChange),this.pendingAction=0,L["default"].isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection)))}},{key:"addLabelsToCollection",value:function(){(0,ae["default"])(this.id.toString(),this.labels,"Contact")}},{key:"addPendingAction",value:function(e){var t=this;if(e.isPending()){var i=function(){t.decPending()};e.then(i,i),this.pendingAction++}return e}},{key:"decPending",value:function(){this.pendingAction>0?this.pendingAction--:(G["default"].log("contact:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"isBlocked",value:function(){return!!S["default"].get(this.id)}},{key:"findCommonGroups",value:function(){var e=this;return this.promises.findCommonGroups?this.promises.findCommonGroups:this.commonGroups&&!this.commonGroups.stale?o["default"].resolve():this.promises.findCommonGroups=K["default"].commonGroupsFind(this.id).then(function(t){if(200===t.status){var i=T["default"].compact(t.groups.map(function(e){return U["default"].Chat.get(e)}));return e.commonGroups?(e.commonGroups.set(i),e.commonGroups.stale=!1):e.commonGroups=new O["default"](i,e.id),
!0}return G["default"].error("models:Contact:findCommonGroups error: "+t.status)(),o["default"].reject(new Error("models:Contact:findCommonGroups error: "+t.status))})["finally"](function(){e.promises.findCommonGroups=null})}},{key:"searchMatch",value:function(e,t,i){return R["default"].supportsFeature(R["default"].F.LABELS_DISPLAY)&&i?!(e&&this.searchName&&this.searchName.indexOf(e)<0)&&T["default"].includes(this.labels,i):!!e&&(!!(this.searchName&&this.searchName.indexOf(e)>-1)||(!!(this.userid&&this.userid.indexOf(e)>-1)||(!!(t&&this.userid&&this.userid.indexOf(t)>-1)||(!!(this.searchVerifiedName&&this.searchVerifiedName.indexOf(e)>-1)||!!(this.pushname&&Q["default"].accentFold(this.pushname).indexOf(e)>-1)))))}},{key:"queryIdentity",value:function(){var e=this;return this.verificationBinary&&this.verificationString?o["default"].resolve():this.promises.queryIdentity?this.promises.queryIdentity:this.promises.queryIdentity=K["default"].queryIdentity(this.id).then(function(t){e.updateIdentity(t)})["catch"](function(e){G["default"].error("models:contact:queryIdentity error: "+String(e))()})["finally"](function(){e.promises.queryIdentity=null})}},{key:"updateIdentity",value:function(e){e.status&&e.status>=400?(this.unset("verificationBinary"),this.unset("verificationString")):(this.verificationBinary=e.binary,this.verificationString=e.string)}},{key:"onIsBusinessChange",value:function(){if(this.isBusiness&&!this.businessProfile)this.addChild("businessProfile",U["default"].BusinessProfile.gadd(this.id));else if(!this.isBusiness&&this.businessProfile){var e=this.businessProfile;this.stopListening(e),this.businessProfile=void 0,e["delete"]()}}},{key:"getFormattedUser",value:function(){return this.id?H["default"].isPSA(this.id)?Q["default"].t("whatsapp_psa_contact_name"):this.name?this.name:Q["default"].isRTL()?Q["default"].embedLTR((0,te["default"])(this.id)):(0,te["default"])(this.id):""}},{key:"addLiveLocation",value:function(e){this.liveLocations||(this.liveLocations=[]),this.liveLocations.push(e)}},{key:"removeLiveLocation",value:function(e){if(this.liveLocations){for(var t=this.liveLocations.length-1;t>=0;t--)if(this.liveLocations[t]===e){this.liveLocations.splice(t,1);break}0===this.liveLocations.length&&(this.liveLocations=null)}}},{key:"set",value:function(e,i,a){var n=(0,_["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"set",this).call(this,e,i,a);if("string"!=typeof e&&i&&i.merge&&n){if(n.isPSA)return n;!e.name&&n.name&&(n.unset("name"),n.unset("shortName")),!e.verifiedName&&n.verifiedName&&n.unset("verifiedName")}return n}}]),t}(M["default"]);re.Collection="Contact",re.Proxy="contact",re.idClass=H["default"],n(),P["default"].on("set_locale",n),t["default"]=(0,E.defineModel)(re)},'"cjgfdijdhj"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"bgjiajcadc"'),s=n(r),o=i('"cdehffajbd"'),d=n(o),u=i('"ddcedhgjff"'),l=n(u),c=i('"dfhdhdbidh"'),f=n(c),h=i('"bejijbfaij"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"ebfebbhae"'),m=n(_),y=i('"cfcbddfj"'),b=n(y),T=i('"bgafgbafci"'),E=n(T),M=i('"biafgdghfb"'),C=a(M),S=i('"fhabbhhjc"'),j=n(S),k=i('"jfefjijii"'),A=n(k),P=i('"deijabejja"'),w=n(P),O=i('"ddahgaaff"'),I=n(O),L=i('"cehbbagije"'),N=n(L),R=i('"jfijghaad"'),D=n(R),G=i('"bgfahifgbh"'),F=a(G),U=i('"dafgbfehgf"'),x=n(U),Y=i('"ebhdebaagj"'),B=n(Y),V=i('"bdcdfifjcj"'),q=n(V),H=i('"dgfhfgbdeb"'),W=n(H),K=i('"bafjcjabca"'),z=n(K),Q=i('"hcddbeaic"'),J=n(Q),X=function(){function e(){(0,m["default"])(this,e),this._map={},this.length=0}return(0,b["default"])(e,[{key:"put",value:function(t){var i=e.getSidelistHash(t);if(i&&!this._map[i]){if(this._map[i]){var a=this._map[i];a instanceof z["default"]?this._map[i]=[a,t.id]:a instanceof Array&&a.push(t.id)}else this._map[i]=t.id;this.length++}}},{key:"remove",value:function(t){var i=e.getSidelistHash(t);if(i&&this._map[i]){var a=(0,D["default"])(this._map[i]);a instanceof z["default"]?delete this._map[i]:a instanceof Array&&E["default"].remove(a,function(e){return e.equals(t.id)}),this.length++}}},{key:"get",value:function(e){var t=this._map[e];return t instanceof z["default"]?[t]:t}},{key:"clear",value:function(){this._map={},this.length=0}}],[{key:"getSidelistHash",value:function(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(N["default"].error("Store:Contact can't call slice on contact.userhash")(e.userhash),null):null}}]),e}(),Z=function(e){function t(){(0,m["default"])(this,t);var e=(0,f["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return e._contactHashes=new X,e.checksum=void 0,e._frequentContacts={},e._sort=E["default"].debounce(function(){return(0,v["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"sort",e).call(e)},1e3),e._silentSort=E["default"].debounce(function(){return(0,v["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"sort",e).call(e,{silent:!0})},1e3),e.listenTo(j["default"],"locale_change",e.sort),e.listenTo(e,"change:name",e.sort),e.listenTo(x["default"],"change:stream",function(){x["default"].stream===U.STREAM.RESUMING&&e.forEach(function(e){e.unset("verificationString"),e.unset("verificationBinary")})}),e.listenTo(e,"add",e.contactAdded),e.listenTo(e,"remove",e.contactRemoved),e}return(0,p["default"])(t,e),(0,b["default"])(t,[{key:"sort",value:function(e){return e&&e.silent?this._silentSort():this._sort()}},{key:"initializeFromCache",value:function(e){var t=this;e&&(e.forEach(function(e){var i=t.get(e.id);i&&e.isMe&&i.set("plaintextDisabled",!0)}),N["default"].log("Store:Contact init from cache")(),this.add(e,{silent:!0,merge:!0}))}},{key:"contactAdded",value:function(e){this._contactHashes.put(e)}},{key:"contactRemoved",value:function(e){this._contactHashes.remove(e)}},{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"delete",this).call(this),delete this.checksum,J["default"].setContactChecksum(),this._frequentContacts={},this._contactHashes.clear()}},{key:"isFilteredContact",value:function(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}},{key:"getFilteredContacts",value:function(){return this.filter(function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact})}},{key:"mungePSAContact",value:function(e){if(Array.isArray(e)){var t=E["default"].findIndex(e,function(e){return e&&z["default"].isPSA(e.id)}),i=e[t];t>-1&&i&&(i.name=l10n.t("whatsapp_psa_contact_name"),i.shortName=l10n.t("whatsapp_psa_contact_name"))}}},{key:"_find",value:function(e){var t=this.get(e);return t?d["default"].resolve(t):d["default"].resolve({id:e})}},{key:"_findQuery",value:function(e){var t=this,i=performance.now(),a={},n=function(e){a.binarySize=e.binarySize};return W["default"].contactFindQuery(e.retry,n).then(function(e){return"preempted"===e.data?d["default"].reject("contacts preempted"):(a.count=e.data.length,a.timing=Math.ceil(performance.now()-i),t.trigger(w["default"].COLLECTION_HAS_SYNCED,a),t.mungePSAContact(e.data),e.checksum&&(t.checksum=e.checksum,N["default"].log("Store:Contact:query update checksum "+e.checksum)()),d["default"].resolve(e.data))})}},{key:"handle",value:function(e){var t=this,i=function(e){t.add(e,{merge:!0});var i=t.get(e.id);i&&i.isMe&&i.set("plaintextDisabled",!0)},a=e.shift();if(Array.isArray(a)){var n=e.shift();if(n&&"remove"===n.missing){var r={};a.forEach(function(e){r[e.id]=!0}),this.forEach(function(e){var t=e.get("id");!z["default"].isUser(t)||r[t]||e.isPSA||(e.unset("name"),e.unset("shortName"))})}n&&n.checksum&&(this.checksum=n.checksum,N["default"].log("Store:Contact:handle update checksum "+n.checksum)()),this.mungePSAContact(a),a.forEach(i),N["default"].log("Store:Contact:handle updated "+a.map(function(e){return e.id}).join())()}else if("preempt"===a.cmd){if(this.mungePSAContact(a.response),this.add(a.response,{merge:!0}),a.checksum&&(this.checksum=a.checksum,N["default"].log("Store:Contact:handle update checksum "+a.checksum)()),A["default"].me){var o=this.get(A["default"].me);o&&o.set("plaintextDisabled",!0)}this.trigger(w["default"].COLLECTION_HAS_SYNCED,{count:a.response.length,binarySize:a.binarySize})}else if("frequent"===a.type)delete a.type,this._frequentContacts=a;else if("sidelist"===a.type){var d=a.notification,u=a.action,l=a.hash,c=this._contactHashes.get(l);if(!c)return;"business"===d&&"profile"===u&&c.forEach(function(e){var i=t.get(e);i?i.businessProfile&&i.businessProfile.markStale():N["default"].assert(!1,l,"Stale wid in contact hash index. Users: "+(t._getUserCount()+", Hashes: "+t._contactHashes.length))()})}else N["default"].error("Store:Contact:handle unknown: "+(0,s["default"])(a))()}},{key:"sync",value:function(){return this.findQuery({})["catch"](C.WapDrop,function(){}),F.waitForBBEvent(this,w["default"].COLLECTION_HAS_SYNCED)}},{key:"resyncContacts",value:function(e){var t=this;"undefined"!=typeof this.checksum&&"undefined"!=typeof e&&(this.checksum!==e?this.findQuery({retry:!0}).then(function(e){if(Array.isArray(e)){t.mungePSAContact(e),N["default"].log("Store:Contact:resync success")();var i=void 0,a=void 0,n={};for(a=0;a<e.length;a++)i=e[a],i&&(n[i.id]=i);for(a=0;a<t.length;a++)i=t.at(a),!i||n[i.id]||i.isPSA||(i.isGroup?B["default"].Chat.get(i.id)||(i.unset("name"),i.unset("shortName")):(i.unset("name"),i.unset("shortName")))}else N["default"].error("Store:Contact.resync error "+(0,s["default"])(e),e)()})["catch"](C.WapDrop,function(){}):N["default"].log("Store:Contact:resync checksum match")())}},{key:"frequentContacts",value:function(e,t){var i=this,a=e&&this._frequentContacts[e];if(a||(a=this._frequentContacts.message),!a)return[];var n=t&&t.id;return a.map(function(e){return i.get(e)}).filter(function(e){return!!e&&!e.id.equals(n)})}},{key:"_getUserCount",value:function(){return this.map(function(e){return e.isUser?1:0}).reduce(function(e,t){return e+t},0)}},{key:"saveToCache",value:function(){(0,v["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"saveToCache",this).call(this),J["default"].setContactChecksum(this.checksum)}}]),t}(q["default"]);Z.model=I["default"],Z.comparator=O.ContactComparator,Z.cachePolicy={id:"contact",policy:V.CACHE_POLICY.IMMEDIATE,trigger:"add\n        sort\n        remove\n        reset\n        change:id\n        change:name\n        change:shortName\n        change:pushname\n        change:type\n        change:plaintextDisabled\n        change:verifiedName\n        change:isBusiness\n        change:isEnterprise\n        change:verifiedLevel\n        change:statusMute\n        change:sectionHeader\n        change:isContactBlocked\n        change:labels"},t["default"]=new Z},'"ddaehgaajf"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"cdfdhedgig"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"bebcachjfd"'),_=a(v),m=i('"jidadafab"'),y=a(m),b=i('"cbgefcdega"'),T=a(b),E=i('"cehbbagije"'),M=a(E),C=i('"bgchhcbahg"'),S=a(C),j=604800,k=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,v.prop)(),a.conversionData=(0,v.prop)(),a.conversionSource=(0,v.prop)(),a.timestamp=(0,v.prop)(function(){return y["default"].globalUnixTime()}),a.alarmId=(0,v.session)(),n=i,(0,c["default"])(a,n)}return(0,g["default"])(t,e),(0,u["default"])(t,[{key:"initialize",value:function(){(0,h["default"])(t.prototype.__proto__||(0,r["default"])(t.prototype),"initialize",this).call(this),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}},{key:"_setExpiryTimer",value:function(){var e=this,t=this.timestamp+j;return t<0?(M["default"].error("Invalid conversionTuple timer")(),void this["delete"]()):void(this.alarmId=T["default"].setLocalTimeout(function(){e["delete"]()},1e3*t,this.alarmId))}},{key:"_clearAlarm",value:function(){this.alarmId&&(T["default"].clearTimeout(this.alarmId),this.alarmId=void 0)}},{key:"elapsedSeconds",value:function(){return y["default"].globalUnixTime()-this.timestamp}},{key:"formatTuple",value:function(){var e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}},{key:"toJSON",value:function(){var e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){var i=new S["default"](t);e.conversionData=i.readString(t.byteLength)}return e}},{key:"delete",value:function(){(0,h["default"])(t.prototype.__proto__||(0,r["default"])(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this._clearAlarm()}}]),t}(_["default"]);k.Collection="ConversionTuple",k.Proxy="conversionTuple",t["default"]=(0,v.defineModel)(k),t.ConversionTupleExpiry=j},'"cfafceedhd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"ddaehgaajf"'),g=a(p),v=i('"jidadafab"'),_=a(v),m=i('"bdcdfifjcj"'),y=a(m),b=i('"jaeddbjag"'),T=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"initializeFromCache",value:function(e){if(e){var t=_["default"].globalUnixTime()-p.ConversionTupleExpiry,i=e.filter(function(e){return e.timestamp-t>0}).map(function(e){var t=(0,b.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e});this.add(i),this.saveToCache()}}}]),t}(y["default"]);T.model=g["default"],T.cachePolicy={id:"conversion_tuple",policy:m.CACHE_POLICY.LOAD,delay:1e3},e.exports=new T},'"bbcjehedih"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.variant=(0,f.prop)(),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);p.Proxy="emojiVariant",t["default"]=(0,f.defineModel)(p)},'"dajejfbchh"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bdcdfifjcj"'),g=a(p),v=i('"bbcjehedih"'),_=a(v),m=i('"cjjgiaccfb"'),y=a(m),b=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"setVariant",value:function(e,t){var i=y["default"].skinToneEmojis[e];if(!i)throw new Error("attempt to store variantless emoji");this.gadd({id:i,variant:t})}},{key:"getVariant",value:function(e){if(y["default"].skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}},{key:"getVariantIfExists",value:function(e){if(y["default"].skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}return null}}]),t}(g["default"]);b.model=_["default"],b.cachePolicy={id:"emoji_variant_collection",policy:p.CACHE_POLICY.LOAD,delay:1e3},t["default"]=new b},'"ddjibjggia"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bdcdfifjcj"'),b=n(y),T=i('"bfhecaifff"'),E=n(T),M=i('"bjjbbjfiee"'),C=n(M),S=i('"biafgdghfb"'),j=a(S),k=i('"dacbaddbce"'),A=n(k),P=i('"bidieaecca"'),w=n(P),O=100,I=function(e){function t(){(0,l["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this));return e.hasMoreMsgs=!0,e.resultPage=0,e.searchPromise=null,e.searchTerm=null,e.searchLabel=null,e.updateFtsAfterMsgLabelUpdate=function(){if(e.currentLabelSearch){var t=e.filter(function(t){return!t.labels||!t.labels.includes(e.currentLabelSearch)});e.remove(t,{silent:!0})}},e.listenTo(w["default"],"remove_msgs",function(t){var i=e.remove(t,{silent:!0}).filter(function(e){return!!e});i.length&&e.trigger("bulk_remove")}),e.listenTo(E["default"],"remove",function(t){var i=[];e.forEach(function(e){e.chat===t&&i.push(e)});var a=e.remove(i,{silent:!0}).filter(function(e){return!!e});a.length&&e.trigger("bulk_remove")}),e}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"delete",value:function(e){e&&this.stopListening(),(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this)}},{key:"resetSearch",value:function(){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=null,this.searchPromise&&this.searchPromise.cancel()}},{key:"search",value:function(e,t){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e+"__"+(a.label||a.kind||"");this.currentLabelSearch=a.label;var r=!1;this.searchTerm!==n?(this.searchTerm&&0===e.indexOf(this.searchTerm)?r=!0:(this.searchTerm=n,this["delete"]()),this.resultPage=0,this.hasMoreMsgs=!0):r=!0;var o=new A["default"].UiAction({uiActionType:A["default"].UI_ACTION_TYPE.IMAGE_OPEN,uiActionPreloaded:r});if(this.searchPromise){if(this.searchTerm===n)return this.searchPromise;this.searchPromise.cancel()}var d=void 0;return d=t?t.fts(e,++this.resultPage,O):w["default"].search(e,++this.resultPage,O,void 0,a),this.searchPromise=d.cancellable().then(function(e){e.eof&&(i.hasMoreMsgs=!1),i.searchTerm!==n&&i["delete"](),i.searchTerm=n,e.messages&&i.add(e.messages.filter(function(e){return!e.isRevoked})),o.markUiActionT(),o.commit()})["catch"](j.WapDrop,s["default"].CancellationError,function(){})["finally"](function(){i.searchPromise=null,i.trigger("searchPromise_update")}),this.trigger("searchPromise_update"),this.searchPromise}}]),t}(b["default"]);I.model=C["default"],t["default"]=I},'"cfadihhfgf"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){return(0,X.ContactComparator)(e.contact,t.contact)}function s(e,t){return o(e,p,g,v,t)}function o(e,t,i,a,n){var r=void 0;if(207===e.status){var s={};for(var o in e)if(le["default"].isWid(o)){var c=e[o];if(207!==c){s[c]||(s[c]=[]);var f=q["default"].get(o);f&&s[c].push(f)}}var h=[];for(var p in s){var g=d(t,i,l,parseInt(p,10),s[p]);g&&h.push(g)}r=h.length>0?h.join("\n"):a()}else r=d(t,i,u,e.status,n);return r}function d(e,t,i,a,n){var r=n.map(function(e){return e.formattedShortName}).join(l10n.t("enumeration_comma")),s=200===a,o=s?e(r,n.length):t(r,n.length,a),d=s?"":i(a,n.length);return o+d}function u(e,t){var i="";switch(e){case 401:i=" "+l10n.t("action_group_failed_401");break;case 403:i=" "+l10n.t("action_group_failed_403");break;case 408:i=" "+l10n.t("action_participant_failed_408");break;case 404:i=" "+l10n.t("action_group_failed_404");break;case 429:i=" "+l10n.t("action_group_failed_429")}return i}function l(e,t){var i="";switch(e){case 401:case 409:break;case 404:i=" "+l10n.t("action_participant_failed_404",{_plural:t});break;case 408:i=" "+l10n.t("action_participant_failed_408",{_plural:t});break;case 500:i=" "+l10n.t("action_participant_failed_500");break;default:i=" "+l10n.t("action_participant_failed_unknown")}return i}function c(e,t){return l10n.t("action_participant_added",{participantNames:e,_plural:t})}function f(e,t,i){return l10n.t("action_participant_add_failed",{participantNames:e,_plural:t})}function h(){return l10n.t("action_participant_add_failed_partial")}function p(e,t){return l10n.t("action_participant_removed",{participantNames:e,_plural:t})}function g(e,t,i){switch(i){case 406:return l10n.t("action_participant_remove_failed_remove_creator",{participant:e});default:return l10n.t("action_participant_remove_failed",{participantNames:e,_plural:t})}}function v(){return l10n.t("action_participant_remove_failed_partial")}function _(e,t){return l10n.t("action_participant_promoted",{participantNames:e,_plural:t})}function m(e,t,i){return l10n.t("action_participant_promote_failed",{participantNames:e,_plural:t})}function y(){return l10n.t("action_participant_promote_failed_partial")}function b(e,t){return l10n.t("action_participant_demoted",{participantNames:e,_plural:t})}function T(e,t,i){switch(i){case 406:return l10n.t("action_participant_demote_failed_group_creator",{participant:e});default:return l10n.t("action_participant_demote_failed",{participantNames:e,_plural:t})}}function E(){return l10n.t("action_participant_demote_failed_partial")}Object.defineProperty(t,"__esModule",{value:!0});var M=i('"cdehffajbd"'),C=n(M),S=i('"ddcedhgjff"'),j=n(S),k=i('"ebfebbhae"'),A=n(k),P=i('"cfcbddfj"'),w=n(P),O=i('"dfhdhdbidh"'),I=n(O),L=i('"cdfdhedgig"'),N=n(L),R=i('"bejijbfaij"'),D=n(R);t.formatRemoveResult=s;var G=i('"bgaddigcjb"'),F=n(G),U=i('"bebcachjfd"'),x=n(U),Y=i('"jfefjijii"'),B=n(Y),V=i('"cjgfdijdhj"'),q=n(V),H=i('"bjgjbbhfcf"'),W=n(H),K=i('"fhabbhhjc"'),z=n(K),Q=i('"deijabejja"'),J=n(Q),X=i('"ddahgaaff"'),Z=i('"biafgdghfb"'),$=a(Z),ee=i('"djdcdaecea"'),te=n(ee),ie=i('"cehbbagije"'),ae=n(ie),ne=i('"dgfhfgbdeb"'),re=n(ne),se=i('"ciehgcaebf"'),oe=i('"bjhdjifgah"'),de=n(oe),ue=i('"bafjcjabca"'),le=n(ue),ce=i('"bgafgbafci"'),fe=n(ce),he=function(e){function t(){var e,i,a,n;(0,A["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,I["default"])(this,(e=t.__proto__||(0,j["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,U.prop)(),a.isAdmin=(0,U.prop)(),a.isSuperAdmin=(0,U.prop)(),a.contact=(0,U.session)(),n=i,(0,I["default"])(a,n)}return(0,D["default"])(t,e),(0,w["default"])(t,[{key:"initialize",value:function(){(0,N["default"])(t.prototype.__proto__||(0,j["default"])(t.prototype),"initialize",this).call(this),this.addChild("contact",q["default"].gadd(this.id))}}]),t}(x["default"]);he.Proxy="participant",he.idClass=le["default"];var pe=(0,U.defineModel)(he),ge=function(e){function t(){var e,i,a,n;(0,A["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,I["default"])(this,(e=t.__proto__||(0,j["default"])(t)).call.apply(e,[this].concat(s))),a.participants=(0,U.collection)(ve),a.id=(0,U.prop)(),a.creation=(0,U.prop)(),a.owner=(0,U.prop)(),a.desc=(0,U.prop)(),a.descId=(0,U.prop)(),a.descTime=(0,U.prop)(),a.descOwner=(0,U.prop)(),a.restrict=(0,U.prop)(),a.announce=(0,U.prop)(),a.noFrequentlyForwarded=(0,U.prop)(),a.size=(0,U.prop)(),a.stale=(0,U.session)(!0),a.trusted=(0,U.session)(!0),a.inviteCode=(0,U.session)(),a.groupInviteCodePromise=(0,U.session)(),a.revokeGroupInvitePromise=(0,U.session)(),a.groupInviteLink=(0,U.derived)(a._groupInviteLink,["inviteCode"]),n=i,(0,I["default"])(a,n)}return(0,D["default"])(t,e),(0,w["default"])(t,[{key:"_groupInviteLink",value:function(){return this.inviteCode?""+J["default"].GROUP_INVITE_LINK_URL+this.inviteCode:null}},{key:"delete",value:function(){(0,N["default"])(t.prototype.__proto__||(0,j["default"])(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.participants["delete"]()}},{key:"canSetSubject",value:function(){return!!this.participants.iAmMember()&&(!!this.participants.iAmAdmin()||(!te["default"].supportsFeature(te["default"].F.GROUPS_V_3)||this.restrict!==!0))}},{key:"canSetDescription",value:function(){return!!te["default"].supportsFeature(te["default"].F.GROUPS_V_3)&&!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)}},{key:"canSetGroupProperty",value:function(){return!!te["default"].supportsFeature(te["default"].F.GROUPS_V_3)&&!!this.participants.iAmAdmin()}},{key:"initialize",value:function(){x["default"].prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted()}},{key:"triggerParticipantsChange",value:function(){this.trigger("change:participants")}},{key:"isTrusted",value:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(le["default"].equals(this.owner,B["default"].me))return this.trusted=!0;var e=q["default"].get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.toArray(),i=0,a=t.length;i<a;++i){var n=t[i];if(n.isAdmin&&!le["default"].equals(n.id,B["default"].me)&&n.contact.isMyContact)return this.trusted=!0}return this.trusted=!1}},{key:"groupInviteCode",value:function(){var e=this;return this.groupInviteCodePromise?this.groupInviteCodePromise:this.groupInviteCodePromise=re["default"].groupInviteCode(this.id).then(function(t){return 200===t.status&&(e.inviteCode=t.code),t.status})["finally"](function(){e.groupInviteCodePromise=null})}},{key:"revokeGroupInvite",value:function(){var e=this;return this.revokeGroupInvitePromise?this.revokeGroupInvitePromise:this.revokeGroupInvitePromise=re["default"].revokeGroupInvite(this.id).then(function(t){return 200===t.status&&(e.inviteCode=t.code),t.status})["finally"](function(){e.revokeGroupInvitePromise=null})}}]),t}(x["default"]);ge.Collection="GroupMetadata",ge.Proxy="groupMetadata",ge.idClass=le["default"];var ve=function(e){function t(){return(0,A["default"])(this,t),(0,I["default"])(this,(t.__proto__||(0,j["default"])(t)).apply(this,arguments))}return(0,D["default"])(t,e),(0,w["default"])(t,[{key:"initialize",value:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(z["default"],"locale_change",this.sort)}},{key:"delete",value:function(){this.forEach(function(e){e["delete"]()}),this.stopListening(),this.reset()}},{key:"set",value:function(e,i){return i=i||{},i.isParticipantCollectionAdd||(i.remove=!0),(0,N["default"])(t.prototype.__proto__||(0,j["default"])(t.prototype),"set",this).call(this,e,i)}},{key:"add",value:function(e,i){return i=i||{},i.isParticipantCollectionAdd=!0,(0,N["default"])(t.prototype.__proto__||(0,j["default"])(t.prototype),"add",this).call(this,e,i)}},{key:"addParticipants",value:function(e,t){var i=this;if(fe["default"].some(e,function(e){return i.get(e.id)}))return ae["default"].error("models:groupMetadata:participantCollection:addParticipants already a group member")(),C["default"].reject(new $.ActionError);if(!this.canAdd())return C["default"].reject(new $.ActionError);var a=re["default"].addParticipants(this.parent.id,e.map(function(e){return e.id})),n=e.map(function(e){return e.formattedShortName}).join(l10n.t("enumeration_comma")),r=new se.ActionType(l10n.t("action_participant_adding",{participantNames:n,_plural:e.length}));t=t||(0,se.genId)();var s=a.then(function(t){var i=o(t,c,f,h,e);return new se.ActionType(i)})["catch"](function(a){return ae["default"].error("models:groupMetadata:participantCollection:addParticipants dropped")(a),new se.ActionType(l10n.t("action_participant_add_failed",{participantNames:n,_plural:e.length}),l10n.t("action_try_again"),i.addParticipants.bind(i,e,t))});return z["default"].openToast(F["default"].createElement(se.ActionToast,{id:t,initialAction:r,pendingAction:s})),a}},{key:"removeParticipants",value:function(e,t){var i=this;if(fe["default"].some(e,function(e){return!i.canRemove(e)}))return C["default"].reject(new $.ActionError);var a=re["default"].removeParticipants(this.parent.id,e.map(function(e){return e.id})),n=e.map(function(e){return e.contact.formattedShortName}).join(l10n.t("enumeration_comma")),r=new se.ActionType(l10n.t("action_participant_removing",{participantNames:n,_plural:e.length}));t=t||(0,se.genId)();var o=a.then(function(t){var i=s(t,e.map(function(e){return e.contact}));return new se.ActionType(i)})["catch"](function(a){return ae["default"].error("models:groupMetadata:participantCollection:removeParticipants dropped")(a),new se.ActionType(l10n.t("action_participant_remove_failed",{participantNames:n,_plural:e.length}),l10n.t("action_try_again"),i.removeParticipants.bind(i,e,t))});return z["default"].openToast(F["default"].createElement(se.ActionToast,{id:t,initialAction:r,pendingAction:o})),a}},{key:"promoteParticipants",value:function(e,t){var i=this;if(fe["default"].some(e,function(e){return!i.canPromote(e)}))return C["default"].reject(new $.ActionError);var a=re["default"].promoteParticipants(this.parent.id,e.map(function(e){return e.id})),n=e.map(function(e){return e.contact.formattedShortName}).join(l10n.t("enumeration_comma")),r=new se.ActionType(l10n.t("action_participant_promoting",{participantNames:n,_plural:e.length}));t=t||(0,se.genId)();var s=a.then(function(t){var i=o(t,_,m,y,e.map(function(e){return e.contact}));return new se.ActionType(i)})["catch"](function(a){return ae["default"].error("models:groupMetadata:participantCollection:removeParticipants dropped")(a),new se.ActionType(l10n.t("action_participant_promote_failed",{participantNames:n,_plural:e.length}),l10n.t("action_try_again"),i.promoteParticipants.bind(i,e,t))});return z["default"].openToast(F["default"].createElement(se.ActionToast,{id:t,initialAction:r,pendingAction:s})),a}},{key:"demoteParticipants",value:function(e,t){var i=this;if(fe["default"].some(e,function(e){return!i.canDemote(e)}))return C["default"].reject(new $.ActionError);var a=re["default"].demoteParticipants(this.parent.id,e.map(function(e){return e.id})),n=e.map(function(e){return e.contact.formattedShortName}).join(l10n.t("enumeration_comma")),r=new se.ActionType(l10n.t("action_participant_demoting",{participantNames:n,_plural:e.length}));t=t||(0,se.genId)();var s=a.then(function(t){var i=o(t,b,T,E,e.map(function(e){return e.contact}));return new se.ActionType(i)})["catch"](function(a){return ae["default"].error("models:groupMetadata:participantCollection:demoteParticipants dropped")(a),new se.ActionType(l10n.t("action_participant_demote_failed",{participantNames:n,_plural:e.length}),l10n.t("action_try_again"),i.demoteParticipants.bind(i,e,t))});return z["default"].openToast(F["default"].createElement(se.ActionToast,{id:t,initialAction:r,pendingAction:s})),a}},{key:"canAdd",value:function(){return!!this.iAmAdmin()}},{key:"canPromote",value:function(e){return!!e&&(!B["default"].me.equals(e.id)&&(!!this.iAmAdmin()&&!e.isAdmin))}},{key:"canDemote",value:function(e){if(!e)return!1;if(!this.iAmAdmin())return!1;if(B["default"].me.equals(e.id))return!1;var t=te["default"].supportsFeature(te["default"].F.GROUPS_V_3)&&de["default"].groupsV3&&e.isSuperAdmin;return!t&&!!e.isAdmin}},{key:"canRemove",value:function(e){return!!e&&(!B["default"].me.equals(e.id)&&!!this.iAmAdmin())}},{key:"canVerifyIdentity",value:function(e){return!!te["default"].supportsFeature(te["default"].F.QUERY_IDENTITY)&&(!!e&&(!B["default"].me.equals(e.id)&&!!e.contact.plaintextDisabled))}},{key:"iAmMember",value:function(){return 1===this.filter(function(e){return e.id.equals(B["default"].me);
}).length}},{key:"iAmAdmin",value:function(){return 1===this.filter(function(e){return e.id.equals(B["default"].me)&&e.isAdmin}).length}},{key:"iAmSuperAdmin",value:function(){return 1===this.filter(function(e){return e.id.equals(B["default"].me)&&e.isSuperAdmin}).length}},{key:"getAdmins",value:function(){return this.where({isAdmin:!0})}}]),t}(W["default"]);ve.model=pe,ve.comparator=r,t["default"]=(0,U.defineModel)(ge)},'"bfibgjihae"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"bejijbfaij"'),v=n(g),_=i('"bgafgbafci"'),m=n(_),y=i('"cjgfdijdhj"'),b=n(y),T=i('"cehbbagije"'),E=n(T),M=i('"bdcdfifjcj"'),C=n(M),S=i('"cfadihhfgf"'),j=n(S),k=i('"ebhdebaagj"'),A=n(k),P=i('"dgfhfgbdeb"'),w=n(P),O=i('"biafgdghfb"'),I=a(O),L=i('"bafjcjabca"'),N=n(L),R=i('"fccadfdfc"'),D=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).apply(this,arguments))}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"onResume",value:function(){var e=this;m["default"].union(A["default"].Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),A["default"].Chat.where({isBroadcast:!0})).forEach(function(t){e.find(t.id)["catch"](I.WapDrop,I.ProtoVersionUndefined,function(){})})}},{key:"_find",value:function(e){var t=this;if(N["default"].isGroup(e)){var i=A["default"].Chat.get(e);return i&&i.isReadOnly?w["default"].groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void m["default"].defer(function(){A["default"].Chat.assertGet(e)["delete"]()}):"error"===t.status?(E["default"].error("model:GroupMetadata:find error "+t.info)(),s["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):w["default"].groupMetadataFind(e).then(function(i){return i.status&&i.status>=400?{id:e,stale:!1}:i.id?(t.updateSubject(e,i.subject),{id:i.id,owner:i.owner,creation:i.creation,desc:i.desc,descId:i.descId,descOwner:i.descOwner,descTime:i.descTime,restrict:i.restrict,announce:i.announce,noFrequentlyForwarded:i.noFrequentlyForwarded,participants:i.participants}):void E["default"].warn("Store:GroupMetadata Unexpected server response")(i)})}if(N["default"].isBroadcast(e))return w["default"].contactFindBroadcast(e).then(function(i){if(200===i.status){var a=t.get(e);return a&&!a.stale?s["default"].resolve(a):{id:e,participants:i.recipients}}return 404===i.status?(E["default"].error("models:GroupMetadataCollection:_find:False broadcast list query")(),{id:e}):(E["default"].error("models:GroupMetadataCollection:_find:bclist error: "+i.status)(),s["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+i.status)))});var a="groupMetadata:find trying to fetch non-group/bclist wid "+e.toString();return E["default"].log(a)(),s["default"].reject(new Error(a))}},{key:"_handle",value:function(e){return e}},{key:"updateSubject",value:function(e,t){(0,R.isString)(t)&&b["default"].find(e).then(function(e){e.name||(e.name=t)})}}]),t}(C["default"]);D.model=j["default"],D.staleCollection=!0,e.exports=new D},'"ihfjiigda"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=parseInt(e,10);return"#"+(t>>>0).toString(16).slice(-6)}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=a(r),o=i('"ddcedhgjff"'),d=a(o),u=i('"ebfebbhae"'),l=a(u),c=i('"cfcbddfj"'),f=a(c),h=i('"dfhdhdbidh"'),p=a(h),g=i('"cdfdhedgig"'),v=a(g),_=i('"bejijbfaij"'),m=a(_);t.intColorToHex=n;var y=i('"bebcachjfd"'),b=a(y),T=i('"ebhdebaagj"'),E=a(T),M=i('"cjdifhgiac"'),C=a(M),S=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,y.prop)(),a.name=(0,y.prop)(),a.color=(0,y.prop)(),a.count=(0,y.prop)(),a.stale=(0,y.session)(!0),a.hexColor=(0,y.derived)(a._hexColor,["color"]),n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"initialize",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"initialize",this).call(this),this.labeltemColleciton=new C["default"],this.triggerLabelUpdate(),this.listenTo(this,"change:name",this.triggerLabelUpdate),this.listenTo(this,"change:color",this.triggerLabelUpdate),this.listenTo(this,"change:count",this.triggerLabelUpdate)}},{key:"_hexColor",value:function(){if(this.color)return n(this.color)}},{key:"_find",value:function(e){return s["default"].resolve({id:e})}},{key:"triggerLabelUpdate",value:function(){this.name&&E["default"].Label.trigger("label_updated_"+this.id)}}]),t}(b["default"]);S.Collection="Label",S.Proxy="label",t["default"]=(0,y.defineModel)(S)},'"degdhgidga"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgafgbafci"'),b=n(y),T=i('"bgaddigcjb"'),E=a(T),M=i('"biafgdghfb"'),C=a(M),S=i('"ihfjiigda"'),j=n(S),k=i('"bdcdfifjcj"'),A=n(k),P=i('"dgfhfgbdeb"'),w=n(P),O=i('"ebhdebaagj"'),I=n(O),L=i('"cehbbagije"'),N=n(L),R=i('"hcddbeaic"'),D=n(R),G=i('"jfefjijii"'),F=n(G),U=i('"jjjaidhci"'),x=n(U),Y=i('"bgfahifgbh"'),B=a(Y),V=i('"dafgbfehgf"'),q=n(V),H=i('"fhabbhhjc"'),W=n(H),K=i('"ciehgcaebf"'),z=i('"eaafgdhhia"'),Q=i('"ddheehgejd"'),J=i('"dacbaddbce"'),X=n(J),Z=function(e){function t(){(0,l["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this));return e.checksum=void 0,e.listenTo(e,"remove",e.handleRemove),e}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"addNewLabel",value:function(e,t){(0,Q.logLabelOperationEvent)(X["default"].LABEL_OPERATIONS.ADD,1,X["default"].LABEL_TARGETS.LABEL);var i=w["default"].createLabel(e,t),a=new K.ActionType(l10n.t("action_adding_new_label",{labelName:e})),n=(0,K.genId)(),r=i.then(function(t){var i=t.status;return 200===i?new K.ActionType(l10n.t("action_new_label_added",{labelName:e})):new K.ActionType(l10n.t("action_new_label_add_failed",{labelName:e}))})["catch"](function(t){return N["default"].error("addingNewLabel dropped")(t),new K.ActionType(l10n.t("action_new_label_add_failed",{labelName:e}))});return W["default"].openToast(E.createElement(K.ActionToast,{id:n,initialAction:a,pendingAction:r})),i}},{key:"addOrRemoveLabels",value:function(e,t){var i=w["default"].addOrRemoveLabels(e,t),a=new K.ActionType(l10n.t("action_add_remove_labels",{count:e.length,_plural:e.length})),n=(0,K.genId)(),r=i.then(function(t){var i=t.status;return 200===i?new K.ActionType(l10n.t("action_add_remove_labels_sucess",{count:e.length,_plural:e.length})):new K.ActionType(l10n.t("action_add_remove_labels_failed"))})["catch"](function(e){return N["default"].error("addingNewLabel dropped")(e),new K.ActionType(l10n.t("action_add_remove_labels_failed"))});return W["default"].openToast(E.createElement(K.ActionToast,{id:n,initialAction:a,pendingAction:r})),i}},{key:"deleteLabel",value:function(e){(0,Q.logLabelOperationEvent)(X["default"].LABEL_OPERATIONS.DELETE,1,X["default"].LABEL_TARGETS.LABEL);var t=w["default"].deleteLabel(e),i=this.assertGet(e),a=i.name,n=new K.ActionType(l10n.t("action_deleting_label",{labelName:a})),r=(0,K.genId)(),s=t.then(function(e){var t=e.status;return 200===t?new K.ActionType(l10n.t("action_delete_label_sucess",{labelName:a})):new K.ActionType(l10n.t("action_delete_label_failed",{labelName:a}))})["catch"](function(e){return N["default"].error("addingNewLabel dropped")(e),new K.ActionType(l10n.t("action_delete_label_failed",{labelName:a}))});return W["default"].openToast(E.createElement(K.ActionToast,{id:r,initialAction:n,pendingAction:s})),t}},{key:"updateLabel",value:function(e,t,i){(0,Q.logLabelOperationEvent)(X["default"].LABEL_OPERATIONS.EDIT,1,X["default"].LABEL_TARGETS.LABEL);var a=w["default"].editLabel(e,i,t),n=new K.ActionType(l10n.t("action_label_update_color")),r=(0,K.genId)(),s=a.then(function(e){var t=e.status;return 200===t?new K.ActionType(l10n.t("action_label_update_color_succeeded")):new K.ActionType(l10n.t("action_label_update_color_failed"))})["catch"](function(e){return N["default"].error("addingNewLabel dropped")(e),new K.ActionType(l10n.t("action_label_update_color_failed"))});return W["default"].openToast(E.createElement(K.ActionToast,{id:r,initialAction:n,pendingAction:s})),a}},{key:"getNewLabelColor",value:function(){return w["default"].queryNextLabelColor().then(function(e){return e.labelColors[0].color})["catch"](function(e){})}},{key:"getLabelColorPalette",value:function(){return this.labelColorPalette=this.labelColorPalette||D["default"].getSmbLabelPalette(),this.labelColorPalette&&this.labelColorPalette.waVersion===F["default"].phone.wa_version?s["default"].resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then(function(e){var t=e.labelColors.map(function(e){var t=e.color;return t});return D["default"].setSmbLabelPalette({colors:t,waVersion:F["default"].phone.wa_version}),t})["catch"](function(){})}},{key:"_getColorPaletteLoop",value:function(){return s["default"].loop(function(e,t,i){var a=s["default"].delay(x["default"].expBackoff(i,12e4,1e3,.1)),n="CONNECTED"===q["default"].stream?s["default"].resolve():B.waitForBBEvent(q["default"],"change:stream",function(){return"CONNECTED"===q["default"].stream});return n.then(function(){return w["default"].queryLabelPalette().then(function(t){e(t)})})["catch"](function(e){return!(e instanceof s["default"].CancellationError)},function(e){return i>3||404===e?(N["default"].error("labels:loadLabelPalette:error "+String(e))(),404===e?s["default"].reject(new C.E404):s["default"].reject(new C.GaveUpRetry("Gave up loading label palette "+i+" tries"))):a})},0)}},{key:"handleRemove",value:function(e){var t=e.labeltemColleciton;t.toArray().forEach(function(e){var t=e.parentId,i=e.parentType,a=e.labelId,n=I["default"][i].get(t);n&&(n.labels=b["default"].remove(n.labels,function(e){return e!==a}))})}},{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.hasObservers()}).forEach(function(t){e.find(t.id)["catch"](C.WapDrop,function(){})})}},{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"sync",value:function(e){if(!e||this.checksum!==e)return this.findQuery({})}},{key:"handle",value:function(e){if(e.checksum&&this.updateChecksum(e.checksum),e.labels&&e.labels[0]&&e.labels[0].labelUpdates){var t=void 0,i=e.labels[0].labelUpdates;return i.forEach(function(e){e.collection.forEach(function(i){"Msg"!==i&&"Chat"!==i||(t=!0);var a=e.id,n=I["default"][i].get(e.id);n&&(n.labels&&n.labels.forEach(function(t){b["default"].includes(e.labels,t)||(0,z.removeLabelFromCollection)(a,t)}),n.labels=e.labels)})}),void(t&&this.trigger("bulk_msg_chat_label_change"))}var a=[],n=[];e.labels.forEach(function(e){"delete"===e.type?a.push(e.label):n.push(e.label)}),this.remove(a.map(function(e){var t=e.id;return t})),this.add(n,{merge:!0})}},{key:"_findQuery",value:function(){var e=this;return w["default"].queryLabels().then(function(t){return t.checksum&&e.updateChecksum(t.checksum),t.labels})}},{key:"_find",value:function(e){return this._findQuery()}},{key:"updateChecksum",value:function(e){this.checksum=e}}]),t}(A["default"]);Z.model=j["default"],Z.staleCollection=!0,Z.resumeOnAvailable=!0,t["default"]=new Z},'"ebbcabddbg"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.parentType=(0,f.prop)(),a.parentId=(0,f.prop)(),a.labelId=(0,f.prop)(),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);p.Collection="LanelItemCollection",p.Proxy="labelItem",t["default"]=(0,f.defineModel)(p)},'"cjdifhgiac"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"ebbcabddbg"'),h=a(f),p=i('"bdcdfifjcj"'),g=a(p),v=function(e){function t(){return(0,o["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,c["default"])(t,e),t}(g["default"]);v.model=h["default"],t["default"]=v},'"bdcdfifjcj"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY=void 0;var r=i('"cjcbjjhead"'),s=n(r),o=i('"cdehffajbd"'),d=n(o),u=i('"ddcedhgjff"'),l=n(u),c=i('"ebfebbhae"'),f=n(c),h=i('"cfcbddfj"'),p=n(h),g=i('"dfhdhdbidh"'),v=n(g),_=i('"cdfdhedgig"'),m=n(_),y=i('"bejijbfaij"'),b=n(y),T=i('"bgafgbafci"'),E=n(T),M=i('"gidjgebhh"'),C=a(M),S=i('"jfefjijii"'),j=n(S),k=i('"biafgdghfb"'),A=a(k),P=i('"cehbbagije"'),w=n(P),O=i('"dafgbfehgf"'),I=n(O),L=i('"djddhaidag"'),N=n(L),R=i('"bjgjbbhfcf"'),D=n(R),G=i('"hcddbeaic"'),F=n(G),U=i('"fccadfdfc"'),x=i('"ebhdebaagj"'),Y=n(x),B=i('"bgcgedafjc"'),V={QUERY:"QUERY",FIND:"FIND",UPDATE:"UPDATE"};t.CACHE_POLICY=B.CACHE_POLICY_TYPE;var q=(new Object).toString(),H={id:"none",policy:B.CACHE_POLICY_TYPE.NONE},W=function(e){function t(){(0,f["default"])(this,t);var e=(0,v["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return e._inflight={},e._cachePolicy=(0,B.createCachePolicy)(e,e.constructor.cachePolicy||H),e._staleCollection=e.constructor.staleCollection||!1,e._resumeOnAvailable=e.constructor.resumeOnAvailable||!1,(e._staleCollection===!0||E["default"].isFunction(e.onResume))&&(e.listenTo(I["default"],"change:stream",e._handleStreamChange),e.listenTo(I["default"],"didResume",e._onResume),e._resumeOnAvailable&&e.listenTo(N["default"],"change:available",function(){N["default"].available&&e._needsUpdate&&e._onResume()})),e._cachePolicy.enableCaching(),e._cachePolicy.constructor.policy===B.CACHE_POLICY_TYPE.LOAD&&e.listenTo(j["default"],"change:me",e._updateFromCache),e}return(0,b["default"])(t,e),(0,p["default"])(t,[{key:"initializeFromCache",value:function(e){this.add(e)}},{key:"saveToCache",value:function(){if(j["default"].me){var e=this._cachePolicy.id;w["default"].log("baseCollection:saveToCache save: "+String(e))(),F["default"].setCollection(e,this.toJSON(),this._cachePolicy.constructor.policy===B.CACHE_POLICY_TYPE.IMMEDIATE)}}},{key:"add",value:function(e,i){var a=this;if(e){if(j["default"].blockStoreAdds)throw new A.LogoutDrop("adding to store when blocking store adds");var n=Array.isArray(e)?e:[e];if(E["default"].every(n,function(e){return e&&e.isState})){var r=E["default"].reject(n,function(e){return a.get(e.id)});return r.length&&(0,m["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"add",this).call(this,r,i),n}}return(0,m["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"add",this).call(this,e,i)}},{key:"findQuery",value:function(e,t){return this._query(V.QUERY,e,t)}},{key:"find",value:function(e,t){return e?this._query(V.FIND,e,t):(C.upload(w["default"].trace("Called find without an id")),d["default"].reject("called find without an id"))}},{key:"update",value:function(e,t){return e?this._query(V.UPDATE,e,t):(C.upload(w["default"].trace("Called update without an id")),d["default"].reject("called update without an id"))}},{key:"handle",value:function(e){var t=this._handle(e.shift());if(this._staleCollection){var i=Array.isArray(t)?t:[t];E["default"].each(E["default"].compact(i),function(e){e.stale=!1})}this.add(t,{merge:!0})}},{key:"gadd",value:function(e,t){if(this._model.prototype.isIdType(e)){var i=this.get(e);if(i)return i;var a={id:e};return this.add(a,t)[0]}if(e&&e.id){var n=t?t:{};return n.merge=!0,this.add(e,n)[0]}var r=E["default"].findKey(Y["default"],this)||"unknown";throw new Error(r+".gadd called without an id attr (id)")}},{key:"gaddUp",value:function(e){var t=void 0,i=this._staleCollection;if(this._model.prototype.isIdType(e)){var a={stale:i,id:e};t=this.get(e)||this.add(a,{merge:!0})[0]}else e&&e.id&&(this.get(e.id)&&(i=!1),e=(0,s["default"])({stale:i},e),t=this.add(e,{merge:!0})[0]);if(t)return t.stale&&this.find(t.id)["catch"](A.WapDrop,function(){}),t;var n=E["default"].findKey(Y["default"],this)||"unknown";throw new Error(n+".gadd called without an id attr (id)")}},{key:"delete",value:function(){this._inflight={},this.reset()}},{key:"isStateStale",value:function(e){var t=this.get(e);return!!t&&t.stale}},{key:"_handleResume",value:function(){switch(I["default"].stream){case O.STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach(function(e){e&&(e.stale=!0)});break;case O.STREAM.RESUMING:case O.STREAM.SYNCING:case O.STREAM.CONNECTED:}}},{key:"_onResume",value:function(){E["default"].isFunction(this.onResume)&&(this._resumeOnAvailable&&!N["default"].available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}},{key:"_query",value:function(e,t,i){var a=this,n=(0,U.isString)(t)?t:t.toString();n===q&&(n=E["default"].uniqueId("collection_query_"));var r=e===V.QUERY?void 0:this.get(t),s="force-"+n;if((this._inflight[s]&&e===V.FIND||e===V.UPDATE)&&(n=s),this._inflight[n])return e===V.FIND&&r&&!r.stale?d["default"].resolve(r):this._inflight[n];if(!r||r&&r.stale||e===V.UPDATE){var o=this._inflight[n]=this._serverQuery(e,t,i)["finally"](function(){delete a._inflight[n]});return o["catch"](A.WapDrop,function(e){w["default"].warn(e.toString())()})["catch"](function(){}),o["catch"](U.isString,function(e){w["default"].log("baseCollection:query query promise rejected: "+String(e))()})}return d["default"].resolve(r)}},{key:"_serverQuery",value:function(e,t,i){var a=this,n=void 0;if(e===V.UPDATE)n=this._update(t);else if(e===V.FIND)n=this._find(t);else{var r=i&&i.logOnSend;n=this._findQuery(t,r)}return n.then(function(e){if(a._staleCollection){var t=Array.isArray(e)?e:[e];E["default"].each(E["default"].compact(t),function(e){"undefined"==typeof e.stale&&(e.stale=!1)})}var n=void 0;if(n=i&&i.set?a.set(e):a.add(e,{merge:!0}),Array.isArray(e))return n;if(n[0])return n[0];throw new A.ModelCreateError(a._model.prototype.Collection,e)})}},{key:"_update",value:function(e){return this._find(e)}},{key:"_handleStreamChange",value:function(){this._handleResume(),this._cachePolicy.constructor.policy===B.CACHE_POLICY_TYPE.LOAD&&this._updateFromCache()}},{key:"_updateFromCache",value:function(){var e=this._cachePolicy.id;this._cachePolicy.disableCaching(),j["default"].me&&(w["default"].log("baseCollection:initFromCache load: "+String(e))(),this.initializeFromCache(F["default"].getCollection(e)),this._cachePolicy.enableCaching())}}]),t}(D["default"]);t["default"]=W},'"cbgdbjighe"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t={},i=0,a=function(e){t["change:"+e]=i++};return e.props&&(0,g["default"])(e.props).forEach(a),e.session&&(0,g["default"])(e.session).forEach(a),e.derived&&(0,g["default"])(e.derived).forEach(a),t}function r(e,t){for(var i=[0,0,0],a=0;a<t.length;a++){var n=e["change:"+t[a]],r=Math.floor(n/y),s=n%y;i[r]|=1<<s}return i}function s(e,t){var i=b[e];i||(i=b[e]={_TotalEvents_:0}),t!==m&&(i._TotalEvents_+=1),i[t]=(0|i[t])+1}function o(e,t){e[t]=e[e.length-1],e.pop()}Object.defineProperty(t,"__esModule",{value:!0});var d=i('"djecddgbji"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"cfcbddfj"'),h=a(f),p=i('"dghibdgiba"'),g=a(p);t.genMirrorMask=n,t.genBitMask=r;var v=i('"cehbbagije"'),_=a(v),m="change",y=32,b={};_["default"].exportToWindow("GEC",b);var T=function(){function e(t){(0,c["default"])(this,e),this.state=t}return(0,h["default"])(e,[{key:"destructor",value:function(){this.state.off("all",this.onGatherEvent,this)}},{key:"initListener",value:function(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[0,0,0]}},{key:"onGatherEvent",value:function(e){if(e===m){var t=this.changeEvents;if(!t[0]&&!t[1]&&!t[2])return;this.onChange(),s(this.state.Collection,e),t[0]=0,t[1]=0,t[2]=0}else{var i=this.state.mirrorMask[e];if(void 0===i)return;var a=i/y|0,n=i%y|0;this.changeEvents[a]|=1<<n,s(this.state.Collection,e)}}},{key:"onChange",value:function(){for(var e=this.state,t=(0,u["default"])(this.changeEvents,3),i=t[0],a=t[1],n=t[2],r=this.masks,s=this.listeners,o=0;o<r.length;o++){var d=(0,u["default"])(r[o],3),l=d[0],c=d[1],f=d[2];if(i&l|a&c|n&f){var h=(0,u["default"])(s[o],2),p=h[0],g=h[1];p(g,e)}}}},{key:"addListener",value:function(e,t,i){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,i])}},{key:"removeListener",value:function(e){for(var t=this.listeners,i=0;i<t.length;i++)t[i][0]===e&&(o(this.masks,i),o(t,i))}}]),e}();t["default"]=T},'"bebcachjfd"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=(0,m.convert)(e),i=(0,m.stateExtend)(G,t);if(e.Proxy){var a=(0,M.genMirrorMask)(t);i.prototype.mirrorMask=a,(0,R["default"])(e.Proxy,t,a)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.collection=t.derived=t.session=t.prop=void 0;var s=i('"deehjbcdej"'),o=n(s),d=i('"ddcedhgjff"'),u=n(d),l=i('"ebfebbhae"'),c=n(l),f=i('"cfcbddfj"'),h=n(f),p=i('"dfhdhdbidh"'),g=n(p),v=i('"bejijbfaij"'),_=n(v),m=i('"gffbjhcc"');Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return m.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return m.session}}),Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return m.derived}}),Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return m.collection}}),t.defineModel=r;var y=i('"bgafgbafci"'),b=n(y),T=i('"biafgdghfb"'),E=a(T),M=i('"cbgdbjighe"'),C=n(M),S=i('"fhabbhhjc"'),j=n(S),k=i('"ceehhahihe"'),A=n(k),P=i('"cehbbagije"'),w=n(P),O=i('"ebhdebaagj"'),I=n(O),L=i('"fccadfdfc"'),N=i('"deifbceede"'),R=n(N),D=/^change:/,G=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,c["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this));if(a.stale=(0,m.session)(),a.__fired=null,a.__changes=null,i._internalInitializationDoNotUse)return(0,g["default"])(a);a.stale=e&&e.stale||a.getDefault("stale"),a.parent=i.parent,a.collection=i.collection,a._initDeriveds(),a._initCollections();var n=a.__defaults,r=n?b["default"].assign({},n,e):e;return r&&!b["default"].isEmpty(r)&&a.set(r,b["default"].assign({silent:!0},i)),a.initialize(),a}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"initialize",value:function(){if(this.collection&&this.id&&!this.collection._model.prototype.isIdType(this.id))throw new Error("Model id:"+String(this.id)+" is wrong type");this._uiObservers=0,this.mirrorMask&&(this.mirror=new C["default"](this))}},{key:"update",value:function(){return this.getCollection().update(this.id)}},{key:"find",value:function(){return this.getCollection().find(this.id)}},{key:"getCollection",value:function(){return this.Collection||w["default"].assert(!1,"no-collection","baseState:getCollection Attempting to get a non existing collection")(),I["default"][this.Collection]}},{key:"_refreshStaleModel",value:function(){!this._uiObservers&&this.stale||this.getCollection().find(this.id)["catch"](E.WapDrop,function(){})}},{key:"incObservers",value:function(e){if(this._uiObservers++,!e){var t=i('"cjdjifdcai"')["default"];t.online&&this.stale&&(j["default"].uiBusy?this.listenToOnce(j["default"],"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}}},{key:"decObservers",value:function(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(j["default"],"ui_idle",this._refreshStaleModel)}},{key:"hasObservers",value:function(){return this._uiObservers>0}},{key:"addChild",value:function(e,t){var i={};i[e]=t,this.set(i,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}},{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t,i){return"string"==typeof e?this._set(e,t,i):(i=t,i&&i.merge?this._set(b["default"].omitBy(e,b["default"].isUndefined),i):this._set(e,i))}},{key:"_set",value:function(e,t,i){var a=this,n=!!this.__changes,r=void 0;(0,L.isString)(e)?r=this._setKV(e,t,i):(i=t,r=b["default"].reduce(e,function(e,t,n){var r=a._setKV(n,t,i);return r&&e.push(r),e},[]));for(var s=0,d=function(){if(s++>5)throw new Error("Circular derived properties / event listeners");var e=b["default"].flatten(r),t=a._topo;if(!t)throw new Error("_topo unexpectedly undefined");var i=b["default"].intersection(t,e);r=i.reduce(function(e,t,n){var r=a._setD(t,i.slice(n+1));return r&&e.push.apply(e,(0,o["default"])(r)),e},[])};r&&r.length>0;)d();var u=i&&i.silent;if(!u&&this.hasUnfiredChanges()){for(var l=this.__fired={},c=this._getChanges(),f=c.length;c.length;){var h=c.shift();if(!l[h]){l[h]=!0;var p=this._definition[h].evt;(this.isListening(p)||this.isListening("all"))&&this.trigger(p,this,this[h])}}(f&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return n||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}},{key:"_setKV",value:function(e,t,i){if(this._collections[e])return void this[e].set(t,i);var a=this._definition[e];if(!a)return void(this[e]=t);if(a.attr===m.Attr.DERIVED)throw new Error("Attempting to directly set derived property: "+e);var n=a.sk;if(this[n]!==t){this[n]=t,this._getChanges().push(e),this.__fired&&(this.__fired[e]=!1);var r=this._deps;return r&&r[e]?r[e]:void 0}}},{key:"_setD",value:function(e,t){var i=this._definition[e],a=i.sk,n=i.fn.call(this);if(this[a]!==n&&(this[a]=n,this._getChanges().push(e),this.__fired&&(this.__fired[e]=!1),this._deps&&this._deps[e])){var r=b["default"].difference(this._deps[e],t);if(r.length)return r}}},{key:"hasUnfiredChanges",value:function(){var e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(var i=0;i<t.length;i++)if(!e[t[i]])return!0;return!1}},{key:"_getChanges",value:function(){return this.__changes||(this.__changes=[])}},{key:"_initDeriveds",value:function(){var e=this;b["default"].forEach(this.__derived,function(t){e[e._definition[t].sk]=m.INIT})}},{key:"_initCollections",value:function(){var e=this;b["default"].forOwn(this._collections,function(t,i){e[i]=new t(null,{parent:e})})}},{key:"unset",value:function(e,t){e=Array.isArray(e)?e:[e],this.set(b["default"].zipObject(e),t)}},{key:"clear",value:function(){this.unset([].concat((0,o["default"])(this.__props),(0,o["default"])(this.__session)))}},{key:"delete",value:function(){this.stopListening()}},{key:"reset",value:function(){this.set(this.__defaults)}},{key:"toJSON",value:function(){return this.serialize()}},{key:"serialize",value:function(){for(var e=this,t={},i=0;i<this.__props.length;i++)t[this.__props[i]]=this[this.__props[i]];return b["default"].forOwn(this._collections,function(i,a){t[a]=e[a].serialize()}),t}},{key:"getDefault",value:function(e){var t=this._definition[e];if(t){var i=t["default"];return(0,L.isFunction)(i)?i():i}}},{key:"_getCachedEventBubblingHandler",value:function(e){return function(t,i,a){D.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],i,a):"change"===t&&this.trigger("change",this)}.bind(this)}}],[{key:"isIdType",value:function(e){return!!(this.idWhitelist&&this.idWhitelist.indexOf(e)>-1)||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}]),t}(A["default"]);t["default"]=G},'"bifijjbghd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"ceehhahihe"'),g=a(p),v=t.CACHE_POLICY_TYPE={LOAD:"LOAD",IMMEDIATE:"IMMEDIATE",NONE:"NONE"},_=function(e){function t(e,i){(0,o["default"])(this,t);var a=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return a._collection=e,a._id=i,a}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"enableCaching",value:function(){}},{key:"disableCaching",value:function(){}},{key:"collection",get:function(){return this._collection}},{key:"id",get:function(){return this._id}}]),t}(g["default"]);_.policy=v.NONE,t["default"]=_},'"cgeaahbffb"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bgafgbafci"'),g=i('"bifijjbghd"'),v=a(g),_=i('"bjhdjifgah"'),m=a(_),y=i('"dafgbfehgf"'),b=a(y),T=function(e){function t(e,i){(0,o["default"])(this,t);var a=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e,i.id));return a._trigger=i.trigger||"all",a._saveToCache=(0,p.debounce)(a.saveToCache,0),a}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"saveToCache",value:function(){b["default"].hasSynced&&m["default"].webRestoreFromCache&&this.collection.saveToCache()}},{key:"enableCaching",value:function(){this.listenTo(this.collection,this._trigger,this._saveToCache)}},{key:"disableCaching",value:function(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}]),t}(v["default"]);T.policy=g.CACHE_POLICY_TYPE.IMMEDIATE,t["default"]=T},'"dhcbbcecif"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgafgbafci"'),b=n(y),T=i('"bieaecaddi"'),E=n(T),M=i('"bdcdfifjcj"'),C=n(M),S=i('"deijabejja"'),j=n(S),k=i('"biafgdghfb"'),A=a(k),P=i('"dafchjdebe"'),w=n(P),O=i('"dhgbdedjba"'),I=n(O),L=i('"bjhdjifgah"'),N=n(L),R=i('"dcadagfece"'),D=n(R),G=i('"ecjafdibeh"'),F=G.FILETYPE.IMAGE,U=G.FILETYPE.VIDEO,x=G.FILETYPE.DOCUMENT,Y=G.FILETYPE.AUDIO,B=T.ATTACH_MEDIA_STATE.READY,V=T.ATTACH_MEDIA_STATE.ERROR,q=T.ATTACH_MEDIA_STATE.PROCESSING,H=1,W=function(e){function t(){(0,l["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this));return e.errorMsgs=null,e.ignored=0,e.mediaPickerStatsLogger=new I["default"],e.selection=new D["default"]([],function(e){return e.id},"prev"),e.listenTo(e.selection,"all",e._handleSelectionEvents.bind(e)),e}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"_handleSelectionEvents",value:function(e,t){"focus"!==t&&t!==!1||this.trigger("active-change")}},{key:"removeSingleton",value:function(e,t){
e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url))}},{key:"remove",value:function(e,i){var a=this,n=(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"remove",this).call(this,e,i);return n.forEach(function(e){return a.removeSingleton(e,i)}),this.selection.init(this.getPreviewableMedias(),!0),n}},{key:"delete",value:function(){var e=this;(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.forEach(function(t){return e.removeSingleton(t)}),this.selection.init(this.getPreviewableMedias(),!0)}},{key:"replace",value:function(e,t){var i=this.get(e);if(i){var a=this.indexOf(i),n=i.caption;this.remove(i,{silent:!0}),i["delete"]();var r=new E["default"]({id:e,caption:n,file:this._normalizeFile(t),chat:i.chat,uiProcessed:!1});return this.add(r,a?{at:a}:{}),r.processPromise}}},{key:"getValidMedias",value:function(){return this.filter(function(e){return e.state===B})}},{key:"getPreviewableMedias",value:function(){return this.filter(function(e){return e.previewable})}},{key:"getActive",value:function(){return this.selection.getVal()}},{key:"setActive",value:function(e){this.selection.setVal(e)}},{key:"unsetActive",value:function(){this.selection.unset()}},{key:"setNextAsActive",value:function(){var e=this.selection.list.length-1;return this.selection.index===-1||this.selection.index===e?this.selection.getVal():(this.selection.setNext(),this.selection.getVal())}},{key:"setPrevAsActive",value:function(){return this.selection.index===-1||0===this.selection.index?this.selection.getVal():(this.selection.setPrev(),this.selection.getVal())}},{key:"processFiles",value:function(e,t,i){var a=this,n=this.getPreviewableMedias().length,r=e.length+n>j["default"].MAX_FILES?Math.max(j["default"].MAX_FILES-n,0):e.length,o=e.length-r;0===r?o&&this.trigger("max_upload_limit",o):this.ignore(o);var d=e.slice(0,r).map(function(e){return new E["default"]({id:H++,file:a._normalizeFile(e),chat:t,uiProcessed:!1})});this.add(d);var u=this.getActive();return this.unsetActive(),s["default"].all(e).then(function(){return a._attemptToSetNextActiveFromAdded(d,u)}),s["default"].map(d,function(e){return e.processPromise}).then(function(){return a._attemptToSetNextActiveFromAdded(d,u)})}},{key:"_attemptToSetNextActiveFromAdded",value:function(e,t){if(!this.getActive()&&!b["default"].some(this.getModelsArray(),{state:q,previewable:!1})){var i=b["default"].find(e,function(e){return e.previewable});i||(i=t),this.selection.init(this.getPreviewableMedias()),i&&this.setActive(i)}}},{key:"_logMediaAdd",value:function(e){this.mediaPickerStatsLogger.chatRecipients||(this.mediaPickerStatsLogger.chatRecipients=e.chat.groupMetadata&&e.chat.groupMetadata.participants.length||1);var t=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,t,e.fileOrigin)}},{key:"_normalizeFile",value:function(e){return s["default"].resolve(e).then(function(e){var t=void 0;return t=e instanceof File?{file:e,filename:e.name,mimetype:e.type,type:(0,G.typeFromMimetype)(e.type)}:e instanceof Blob?{file:e,mimetype:e.type,type:(0,G.typeFromMimetype)(e.type)}:e,!t.type&&t.mimetype&&(t.type=(0,G.typeFromMimetype)(t.mimetype)),t})}},{key:"ignore",value:function(e){e>0&&(this.ignored+=e)}},{key:"uiProcessMsgs",value:function(){var e=this,t=[],i=void 0,a=0,n=0,r=0,s=0,o=0,d=0,u=0,l=0,c=0,f=!1,h=l10n.filesize(N["default"].media),p=l10n.filesize(N["default"].maxFileSize);if(this.forEach(function(t){if(!t.uiProcessed&&(!i&&t.previewable&&(i=t,e._logMediaAdd(t)),t.state!==q&&(t.uiProcessed=!0,t.state===V)))if(t.exception instanceof w["default"])switch(t.getFileType()){case F:a+=1;break;case U:n+=1;break;case Y:r+=1;break;case x:s+=1}else if(t.exception instanceof A.MediaFileEmpty)switch(t.getFileType()){case F:o+=1;break;case U:d+=1;break;case Y:u+=1;break;case x:l+=1}else t.exception instanceof A.MediaFileFailedLoad?f=!0:c+=1}),a>0&&t.push(l10n.t("image_too_big",{number:a,_plural:a,maxSize:h})),n>0&&t.push(l10n.t("video_too_big",{number:n,_plural:n,maxSize:h})),r>0&&t.push(l10n.t("audio_too_big",{number:r,_plural:r,maxSize:h})),s>0&&t.push(l10n.t("document_too_big",{number:s,_plural:s,maxSize:p})),o>0&&t.push(l10n.t("image_empty",{number:o,_plural:o})),d>0&&t.push(l10n.t("video_empty",{number:d,_plural:d})),u>0&&t.push(l10n.t("audio_empty",{number:u,_plural:u})),l>0&&t.push(l10n.t("document_empty",{number:l,_plural:l})),c>0&&t.push(l10n.t("files_not_supported",{number:c,_plural:c})),f&&(t=[],t.push(l10n.t("media_failed_load"))),t.length>1){t=[];var g=a+n+r+s,v=o+d+u+l,_=g+v+c;0===c?(0!==g&&t.push(l10n.t("files_too_big",{number:g,_plural:g,maxSize:p})),0!==v&&t.push(l10n.t("files_empty",{number:v,_plural:v}))):t.push(l10n.t("files_not_added",{number:_,_plural:_}))}this.errorMsgs=t.join(" "),this.ignore(this.getPreviewableMedias().length-j["default"].MAX_FILES);var m=this.ignored;return this.ignored=0,m&&this.trigger("max_upload_limit",m),{errorMsgs:this.errorMsgs}}},{key:"canSend",value:function(){return!b["default"].some(this.getModelsArray(),{state:q,previewable:!1})}}]),t}(C["default"]);W.model=E["default"],t["default"]=W},'"decfihbfhb"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bifijjbghd"'),g=a(p),v=i('"bgafgbafci"'),_=function(e){function t(e,i){(0,o["default"])(this,t);var a=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e,i.id));return a._trigger=i.trigger||"all",a._delay=i.delay,a._saveToCache=(0,v.debounce)(a.saveToCache,a._delay),a}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"saveToCache",value:function(){this.collection.saveToCache()}},{key:"enableCaching",value:function(){this.listenTo(this.collection,this._trigger,this._saveToCache)}},{key:"disableCaching",value:function(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}]),t}(g["default"]);_.policy=p.CACHE_POLICY_TYPE.LOAD,t["default"]=_},'"cgijadajjc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bifijjbghd"'),h=a(f),p=function(e){function t(e,i){return(0,o["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e,i.id))}return(0,c["default"])(t,e),t}(h["default"]);p.policy=f.CACHE_POLICY_TYPE.NONE,t["default"]=p},'"bjgjbbhfcf"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"cjcbjjhead"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"ceehhahihe"'),_=a(v),m=i('"cehbbagije"'),y=a(m),b=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,u["default"])(this,t);var a=(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));i.parent&&(a.parent=i.parent);var n=a.constructor,r=n.model,s=n.comparator;if(!r)throw new Error("Collection initialized without model!");return a._model=r,s&&(a._comparator=s),a._reset(),a}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"add",value:function(e,t){var i=void 0;return i=Array.isArray(e)?e.slice():e?[e]:[],this.set(i,(0,r["default"])({merge:!1,add:!0,remove:!1},t))}},{key:"set",value:function(e,t){if(!e)return y["default"].error("collection:set called with no models")(),[];for(var i=(0,r["default"])({add:!0,remove:!0,merge:!0},t),a=void 0,n=void 0,s=void 0,o=void 0,d=this._comparator&&i.sort!==!1,u=[],l=[],c={},f=i.add,h=i.at,p=i.merge,g=i.remove,v=!(d||!f||!g)&&[],_=0,m=e.length;_<m;_++)if(o=e[_],this.isModel(o)&&(n=o),a=o.id){if(s=this.get(a))g&&(c[s.id.toString()]=!0),p&&(o=n&&o===n?n.attributes:o,s.set(o,i)),e[_]=s;else if(f){if(n=e[_]=this._prepareModel(o,i),!n)continue;u.push(n),this._addReference(n)}n=s||n,n&&(!v||n.id&&c[n.id.toString()]||v.push(n),c[n.id.toString()]=!0)}else y["default"].error("collection:set model has no id")();if(g){for(var b=0,T=this.length;b<T;b++)n=this._models[b],c[n.id.toString()]||l.push(n);l.length&&this.remove(l,i)}var E=void 0;if(u.length||v&&v.length)if(d&&(E=!0),"number"==typeof h){var M;(M=this._models).splice.apply(M,[h,0].concat(u))}else for(var C=v||u,S=0,j=C.length;S<j;S++)this._models.push(C[S]);if(E&&this.sort({silent:!0}),!i.silent){for(var k=0,A=u.length;k<A;k++)n=u[k],n.trigger?n.trigger("add",n,this,i):this.trigger("add",n,this,i);(E||v&&v.length)&&this.trigger("sort",this,i)}return e}},{key:"remove",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=void 0,a=void 0,n=void 0,r=void 0,s=Array.isArray(e)?e.slice():[e],o=[],d=0,u=s.length;d<u;d++)r=s[d],r&&(n=r instanceof this._model?r.id:r,i=o[d]=this.get(n),i&&(this._deIndex(i),a=this._models.indexOf(i),this._models.splice(a,1),t.silent||(t.index=a,i.trigger?i.trigger("remove",i,this,t):this.trigger("remove",i,this,t)),this._removeReference(i)));return o}},{key:"reset",value:function(){for(var e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}},{key:"sort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}},{key:"replaceId",value:function(e,t){var i=this.get(e);i&&(this._removeFromIndex(e),i.set({id:t}),this._addIndex(i))}},{key:"get",value:function(e){return this._index[e]}},{key:"assertGet",value:function(e){var t=this._index[e];if(!t){var i=this._model.prototype.Collection||"Unknown";y["default"].assert(!1,i+"Collection:assertGet")}return t}},{key:"at",value:function(e){return this._models[e]}},{key:"serialize",value:function(){return this.map(function(e){return e.toJSON()})}},{key:"toJSON",value:function(){return this.serialize()}},{key:"isModel",value:function(e){return e instanceof this._model}},{key:"indexOf",value:function(e,t){return this._models.indexOf(e,t)}},{key:"lastIndexOf",value:function(e,t){return this._models.lastIndexOf(e,t)}},{key:"every",value:function(e){return this._models.every(e)}},{key:"some",value:function(e){return this._models.some(e)}},{key:"forEach",value:function(e){this._models.forEach(e)}},{key:"map",value:function(e){return this._models.map(e)}},{key:"filter",value:function(e){return this._models.filter(e)}},{key:"reduce",value:function(e,t){return this._models.reduce(e,t)}},{key:"slice",value:function(e,t){return this._models.slice(e,t)}},{key:"where",value:function(e){return this.filter(function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})}},{key:"head",value:function(){return this._models[0]}},{key:"last",value:function(){return this._models[this._models.length-1]}},{key:"toArray",value:function(){return this._models.slice()}},{key:"getModelsArray",value:function(){return this._models}},{key:"_reset",value:function(){this._models=[],this._index={}}},{key:"_prepareModel",value:function(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;var i=(0,r["default"])({},t,{collection:this});try{return new this._model(e,i)}catch(a){return void y["default"].error("collection:_prepareModel exception: ",a.stack)()}}},{key:"_addReference",value:function(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._onModelEvent,this)}},{key:"_removeReference",value:function(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._onModelEvent,this)}},{key:"_addIndex",value:function(e){this._index[e.id]=e}},{key:"_deIndex",value:function(e){delete this._index[e.id]}},{key:"_removeFromIndex",value:function(e){this.get(e)&&delete this._index[e]}},{key:"_onModelEvent",value:function(e,t,i,a){var n=e.split(":")[0];("add"!==n&&"remove"!==n||i===this)&&("destroy"===n&&this.remove(t,a),this.trigger.apply(this,arguments))}},{key:"length",get:function(){return this._models.length}},{key:"isCollection",get:function(){return!0}},{key:"models",get:function(){return this._models}}]),t}(_["default"]);t["default"]=b},'"gffbjhcc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t={"default":e,type:z.PROPS};return t}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t={"default":e,type:z.SESSION};return t}function s(e,t){var i={fn:e,deps:t,type:z.DERIVED};return i}function o(e){var t={val:e,type:z.COLLECTION};return t}function d(e){var t=e["default"];return t===K?{}:{"default":t}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__x_";return t+e}function l(e,t,i,a){if(!B["default"].isObject(i))throw new Error("Invalid Prop/Session definition.");var n={sk:u(t),evt:"change:"+t,attr:a};void 0!==i["default"]&&(n["default"]=i["default"]),e._definition[t]=n;var r=B["default"].isFunction(n["default"]);if(n["default"]&&!r){if(Array.isArray(n["default"]))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if(B["default"].isObject(n["default"]))throw new Error("Do not return mutable types as default values as they are shared. Type: Object provided.")}var s=n.sk;(0,F["default"])(e,t,{set:function(e){this.set(t,e)},get:function(){var e=this[s];return e!==H?e:r?this[s]=n["default"]():n["default"]}})}function c(e,t,i){var a=u(t),n=i.fn;e._definition[t]=e._derived[t]={sk:a,evt:"change:"+t,attr:W.DERIVED,fn:n,deps:i.deps},(0,F["default"])(e,t,{get:function(){var e=this[a];if(e!==H)return e;var t=n.call(this);return e!==t&&(this[a]=t),t},set:function(){throw new TypeError("'"+t+"' is a derived property, it can't be set directly.")}})}function f(e){var t=[];for(var i in e)t.push([i,e[i]]);return t}function h(e){for(var t={},i=(0,D["default"])({}),a=e;(a=(0,D["default"])(a))&&a!==i;)(0,N["default"])(a).forEach(function(e){e in t||(t[e]=a[e])});return t}function p(e){var t=new e({},{_internalInitializationDoNotUse:!0}),i={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(i.Collection=e.Collection),e.idClass&&(i.idClass=e.idClass),e.idWhitelist&&(i.idWhitelist=e.idWhitelist);var a=new I["default"](["constructor"]),n=new I["default"](["collection","parent","__changes","__fired"]);f(t).forEach(function(t){var r=(0,w["default"])(t,2),s=r[0],o=r[1];if(!n.has(s))switch(o.type){case z.PROPS:i.props[s]=d(o);break;case z.SESSION:i.session[s]=d(o);break;case z.DERIVED:i.derived[s]=B["default"].omit(o,"type"),a.add(o.fn.name);break;case z.COLLECTION:i.collections[s]=o.val;break;default:throw new Error("Invalid defineModel Class type for "+e.name+":"+s+".")}});var r=h(t);return a.forEach(function(e){delete r[e]}),(0,A["default"])(i,r),i}function g(e,t){var i=(0,b["default"])({},t,function(e){function t(){return(0,E["default"])(this,t),(0,C["default"])(this,(t.__proto__||(0,D["default"])(t)).apply(this,arguments))}return(0,j["default"])(t,e),t}(e))[t];return i}function v(e,t){var i=t.name;delete t.name;var a=g(e,i),n=a.prototype,r=n.__props=[],s=n.__session=[],o=n.__derived=[],d=n._collections={},u=n._definition={},f=n._derived={},h=["props","session","derived","collections"];B["default"].forOwn(t.props,function(e,t){r.push(t),l(n,t,e,W.PROP)}),B["default"].forOwn(t.session,function(e,t){s.push(t),l(n,t,e,W.SESSION)}),B["default"].forOwn(t.derived,function(e,t){o.push(t),c(n,t,e)}),B["default"].forOwn(t.collections,function(e,t){d[t]=e}),B["default"].assign(n,B["default"].omit(t,h));var p=r.concat(s),v=p.length;(0,m["default"])(n,{attributes:{get:function(){for(var e={},t=0;t<v;++t)e[p[t]]=this[p[t]];return e}},isState:{get:function(){return!0},set:function(){throw new Error("attempt to set isState")}}});for(var _={},y=0;y<v;y++){var b=p[y];"default"in u[b]&&(_[b]=H)}if(B["default"].isEmpty(_)||(n.__defaults=_),o.length){var T=[],E={},M={};B["default"].forEach(f,function(e,t){M[t]=!0,B["default"].forEach(e.deps,function(e){M[e]=!0,(E[e]||(E[e]=[])).push(t),T.push([t,e])})}),T.length&&(n._deps=E,n._topo=q["default"].array(B["default"].keys(M),T).reverse())}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.Attr=t.INIT=void 0;var _=i('"ddhaaeaeia"'),m=a(_),y=i('"cfdcajecde"'),b=a(y),T=i('"ebfebbhae"'),E=a(T),M=i('"dfhdhdbidh"'),C=a(M),S=i('"bejijbfaij"'),j=a(S),k=i('"cefdejjagc"'),A=a(k),P=i('"djecddgbji"'),w=a(P),O=i('"cjgbdchaeh"'),I=a(O),L=i('"bddfdhigfg"'),N=a(L),R=i('"ddcedhgjff"'),D=a(R),G=i('"defiffbjeh"'),F=a(G),U=i('"dagajafbcc"'),x=a(U);t.prop=n,t.session=r,t.derived=s,t.collection=o,t.convert=p,t.stateExtend=v;var Y=i('"bgafgbafci"'),B=a(Y),V=i('"djjffgbajb"'),q=a(V),H=t.INIT={sentinel:"INIT DERIVED PROP"},W=t.Attr={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"},K=t.NO_DEFAULT_VALUE=(0,x["default"])("NO_DEFAULT_VALUE"),z={PROPS:"Props",SESSION:"Session",DERIVED:"Derived",COLLECTION:"Collection"}},'"deifbceede"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=void 0;var n=i('"eadgjbdhcj"'),r=a(n),s=i('"deehjbcdej"'),o=a(s),d=i('"dghibdgiba"'),u=a(d),l=i('"dgecafbeif"'),c=a(l),f=i('"cehbbagije"'),h=a(f),p=t.ProxyStates={};t["default"]=function(e,t,i){function a(e){this._ProxyState$state=e}var n=t.props,s=t.session,d=t.collections,l=t.derived,f=(0,c["default"])(t,["props","session","collections","derived"]),g={};[n,s,d,l].forEach(function(e){e&&(0,u["default"])(e).forEach(function(e){g[e]={get:function(){return h["default"].assert(!1,"Invalid ProxyState Access",'Cannot read proxy property "'+e+'" created in <'+this._ProxyState$ComponentName+"/>. Make sure it is whitelisted in your list of concerns.")(),this._ProxyState$state[e]},set:function(t){h["default"].assert(!1,"Invalid ProxyState Write",'Cannot write proxy property "'+e+'" created in <'+this._ProxyState$ComponentName+"/>. Make sure it is whitelisted in your list of concerns.")(),this._ProxyState$state[e]=t}}})}),g.mirrorMask={value:i},g.isProxyOf={value:function(e){return this._ProxyState$state===e}},["set","get"].concat((0,o["default"])((0,u["default"])(f))).forEach(function(e){g[e]={value:function(){var t=this._ProxyState$state;return t[e].apply(t,arguments)}}}),a.prototype=(0,r["default"])(null,g),a.prototype.constructor=a,p[e]=a}},'"daefjfgdad"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"ddcedhgjff"'),s=n(r),o=i('"ebfebbhae"'),d=n(o),u=i('"cfcbddfj"'),l=n(u),c=i('"dfhdhdbidh"'),f=n(c),h=i('"cdfdhedgig"'),p=n(h),g=i('"bejijbfaij"'),v=n(g),_=i('"bgafgbafci"'),m=n(_),y=i('"biafgdghfb"'),b=a(y),T=i('"deijabejja"'),E=n(T),M=i('"cehbbagije"'),C=n(M),S=i('"bdcdfifjcj"'),j=n(S),k=i('"fccadfdfc"'),A=100,P=function(e){function t(){(0,d["default"])(this,t);var e=(0,f["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this));return e.dirty=!1,e._throttledSync=m["default"].throttle(function(e){e.sync()},E["default"].RECENT_SYNC_DELAY,{leading:!1}),e.listenTo(e,"change:weight change:length",m["default"].debounce(e._sortTrimScale,A)),e}return(0,v["default"])(t,e),(0,l["default"])(t,[{key:"_sortTrimScale",value:function(){var e=this.length;if(e){this.sort(),e>E["default"].RECENT_LIMIT&&this.remove(this.models.slice(E["default"].RECENT_LIMIT));var t=this.head(),i=this.last();t&&i&&t.weight<10&&i.weight>.01||this.forEach(function(t,i){t.weight=1+3*((e-i)/e)})}}},{key:"delete",value:function(){(0,p["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"delete",this).call(this),this.dirty=!1,this._throttledSync.cancel()}},{key:"sync",value:function(){var e=this;return this.findQuery({},{set:!0})["finally"](function(){e.dirty=!1})["catch"](b.WapDrop,k.isString,function(){})}},{key:"throttledSync",value:function(){C["default"].log("models:"+this.constructor.modelName+":throttledSync dirty: "+String(this.dirty))(),this._throttledSync(this)}},{key:"_updateWeights",value:function(e){this.forEach(function(t){t.id===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.dirty=!0,this.throttledSync()}}]),t}(j["default"]);P.modelName="NotSpecified",P.comparator=function(e,t){return e.weight>t.weight?-1:1},t["default"]=P},'"cbagcefdge"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(){(0,s["default"])(d["default"],l["default"])}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cefdejjagc"'),s=a(r);t.loadCollections=n;var o=i('"ebhdebaagj"'),d=a(o),u=i('"bcihgfbdeb"'),l=a(u)},'"bgjdhcbchg"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgaddigcjb"'),b=n(y),T=i('"bebcachjfd"'),E=n(T),M=i('"bfhecaifff"'),C=n(M),S=i('"fhabbhhjc"'),j=n(S),k=i('"jfefjijii"'),A=n(k),P=i('"biafgdghfb"'),w=a(P),O=i('"gdcgjbcgb"'),I=n(O),L=i('"cehbbagije"'),N=n(L),R=i('"dgfhfgbdeb"'),D=n(R),G=i('"bafjcjabca"'),F=n(G),U=i('"ciehgcaebf"'),x=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,T.prop)(),a.duration=(0,T.prop)(),a.participants=(0,T.collection)(I["default"]),a.active=(0,T.session)(!1),a.keepAliveTimer=(0,T.session)(),a.stopPromise=(0,T.session)(),n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"initialize",value:function(){var e=this;(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"initialize",this).call(this),this.listenTo(this.participants,"remove reset",function(){e.hasParticipants()||e["delete"]()});var i=C["default"].get(this.id);i&&!i.liveLocation&&(i.liveLocation=this)}},{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.stopViewingMap(),this.participants["delete"](),this.getCollection().remove(this.id);var e=C["default"].get(this.id);e&&(e.liveLocation=void 0)}},{key:"hasParticipants",value:function(){return this.participants.length>0}},{key:"startViewingMap",value:function(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}},{key:"stopViewingMap",value:function(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}},{key:"userHasLiveLocation",value:function(e){return!!this.participants.get(e)}},{key:"iHaveLiveLocation",value:function(){return this.userHasLiveLocation(A["default"].me)}},{key:"stopMyLiveLocation",value:function(e){var t=this;if(!this.iHaveLiveLocation())return s["default"].reject(new w.ActionError);if(this.stopPromise)return this.stopPromise;var i=this.stopPromise=D["default"].disableLiveLocation(this.id),a=new U.ActionType(l10n.t("action_live_location_stopping"));e=e||(0,U.genId)();var n=i.then(function(e){return 200===e.status?new U.ActionType(l10n.t("action_live_location_stopped")):e.status>=400?new U.ActionType(l10n.t("action_live_location_stop_failed")):void 0})["catch"](function(i){return N["default"].error("models:liveLocation:disableLiveLocation dropped")(i),new U.ActionType(l10n.t("action_live_location_stop_failed"),l10n.t("action_try_again"),t.stopMyLiveLocation.bind(t,e))});return j["default"].openToast(b["default"].createElement(U.ActionToast,{id:e,initialAction:a,pendingAction:n})),i.then(function(e){if(200===e.status&&!e._duplicate){var i=t.participants.get(A["default"].me);i&&i.disable()}})["finally"](function(){t.stopPromise=null})}},{key:"_updateLiveLocations",value:function(){this.update()["catch"](function(){})}},{key:"_pauseLiveLocations",value:function(){D["default"].unsubscribeLiveLocation(this.id)["catch"](w.WapDrop,function(){})}},{key:"_sendKeepAlive",value:function(){D["default"].subscribeLiveLocation(this.id,!1)["catch"](w.WapDrop,function(){})}},{key:"_startKeepAlive",value:function(){if(!this.keepAliveTimer){var e=this.duration;e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}}},{key:"_stopKeepAlive",value:function(){this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}}]),t}(E["default"]);x.Collection="LiveLocation",x.Proxy="liveLocation",x.idClass=F["default"],t["default"]=(0,T.defineModel)(x)},'"eicecffhe"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){return(0,w.isNumber)(e)&&e>=-90&&e<=90}function r(e){return(0,w.isNumber)(e)&&e>=-180&&e<=180}Object.defineProperty(t,"__esModule",{value:!0});var s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"cdfdhedgig"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"bebcachjfd"'),y=a(m),b=i('"cbgefcdega"'),T=a(b),E=i('"jidadafab"'),M=a(E),C=i('"jfefjijii"'),S=a(C),j=i('"cjgfdijdhj"'),k=a(j),A=i('"bafjcjabca"'),P=a(A),w=i('"fccadfdfc"'),O=function(e){function t(){var e,i,a,n;(0,u["default"])(this,t);for(var r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,m.prop)(),a.msg=(0,m.prop)(),a.lat=(0,m.prop)(),a.lng=(0,m.prop)(),a.accuracy=(0,m.prop)(),a.speed=(0,m.prop)(),a.degrees=(0,m.prop)(),a.sequence=(0,m.prop)(),a.comment=(0,m.prop)(),a.expiration=(0,m.prop)(),a.lastUpdated=(0,m.prop)(),a.contact=(0,m.session)(),a.expireTimerId=(0,m.session)(),a.disabled=(0,m.session)(!1),a.isMe=(0,m.derived)(a._isMe,["id"]),a.valid=(0,m.derived)(a._valid,["lat","lng"]),n=i,(0,h["default"])(a,n)}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"_isMe",value:function(){return this.id.equals(S["default"].me)}},{key:"_valid",value:function(){return n(this.lat)&&r(this.lng)}},{key:"initialize",value:function(){(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"initialize",this).call(this),this.addChild("contact",k["default"].gadd(this.id)),this.contact.addLiveLocation(this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}},{key:"delete",value:function(){(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"delete",this).call(this),this._disableMsg(),this.contact.removeLiveLocation(this),this._clearExpireTimer()}},{key:"remainingTime",value:function(){return this.expiration-M["default"].globalUnixTime()}},{key:"elapsedTime",value:function(){return M["default"].globalUnixTime()-this.lastUpdated}},{key:"disable",value:function(){this.disabled=!0}},{key:"_disableMsg",value:function(){var e=this.msg;e&&(e.shareDuration=M["default"].globalUnixTime()-e.t-1)}},{key:"_setExpireTimer",value:function(){if(this.expiration)return this.remainingTime()<=0?void this._expire():void(this.expireTimerId=T["default"].setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}},{key:"_clearExpireTimer",value:function(){T["default"].clearTimeout(this.expireTimerId),this.expireTimerId=null}},{key:"_expire",value:function(){this.disable()}}]),t}(y["default"]);O.Proxy="liveLocationParticipant",O.idClass=P["default"],t["default"]=(0,m.defineModel)(O)},'"gdcgjbcgb"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"jfefjijii"'),g=a(p),v=i('"eicecffhe"'),_=a(v),m=i('"bdcdfifjcj"'),y=a(m),b=i('"ddahgaaff"'),T=function(e){function t(){(0,o["default"])(this,t);var e=(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return e.listenTo(e,"change:disabled",function(t){t.disabled&&e.removeParticipant(t)}),e}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"delete",value:function(){var e=this;this.forEach(function(t){return e.removeParticipant(t)})}},{key:"validLocations",value:function(){return this.filter(function(e){return e.valid})}},{key:"removeParticipant",value:function(e){this.remove(e),e["delete"]()}}]),t}(y["default"]);T.model=_["default"],T.comparator=function(e,t){return e.contact.id.equals(g["default"].me)?-1:t.contact.id.equals(g["default"].me)?1:(0,b.ContactComparator)(e.contact,t.contact)},t["default"]=T},'"cgbccbigbh"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cjcbjjhead"'),s=n(r),o=i('"cdehffajbd"'),d=n(o),u=i('"ddcedhgjff"'),l=n(u),c=i('"ebfebbhae"'),f=n(c),h=i('"cfcbddfj"'),p=n(h),g=i('"dfhdhdbidh"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"deijabejja"'),b=n(y),T=i('"jidadafab"'),E=n(T),M=i('"cjgfdijdhj"'),C=n(M),S=i('"biafgdghfb"'),j=a(S),k=i('"bgjdhcbchg"'),A=n(k),P=i('"cehbbagije"'),w=n(P),O=i('"bdcdfifjcj"'),I=n(O),L=i('"bafjcjabca"'),N=n(L),R=i('"dgfhfgbdeb"'),D=n(R),G=i('"fccadfdfc"'),F=-1,U=function(e){function t(){return(0,f["default"])(this,t),(0,v["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,p["default"])(t,[{key:"_find",value:function(e){var t=this;return N["default"].isUser(e)||N["default"].isGroup(e)?D["default"].subscribeLiveLocation(e,!0).then(function(i){if(i.status&&i.status>=400)return 499===i.status?w["default"].log("liveLocation:subscribe query not implemented on the phone")():w["default"].error("model:LiveLocation:_find error "+i.status)(),d["default"].reject(i.status);var a=(0,G.isNumber)(i.duration)?i.duration:void 0,n=i.participants?i.participants.map(function(e){return(0,s["default"])({},t._extractLocationFields(e),{id:e.id,expiration:0===e.expiration?1/0:e.expiration})}):[];return{id:e,duration:a,participants:n}}):d["default"].reject(new Error("invalid wid for live location: "+e))}},{key:"getActive",value:function(e){var t=this;return N["default"].isUser(e)||N["default"].isGroup(e)?D["default"].queryActiveLiveLocation(e).then(function(i){if(i.status&&i.status>=400)return 499===i.status?w["default"].log("liveLocation:participant query not implemented on the phone")():w["default"].error("model:LiveLocation:getActive error "+i.status)(),d["default"].reject(i.status);if(i.participants&&i.participants.length){var a=i.participants.map(function(e){return{id:e.id,expiration:0===e.expiration?1/0:e.expiration}});t.add({id:e,participants:a},{merge:!0})}})["catch"](j.WapDrop,function(){}):d["default"].reject(new Error("invalid wid for live location: "+e))}},{key:"onResume",value:function(){this.filter(function(e){return e.active&&e.hasParticipants()}).forEach(function(e){e.update()})}},{key:"handle",value:function(e){var t=this;Array.isArray(e)?e.forEach(function(e){switch(e.type){case"update":var i=t._extractLocationFields(e),a=C["default"].get(e.jid);a&&a.liveLocations&&a.liveLocations.forEach(function(e){return e.set(i)});break;case"disable":var n=t.get(e.chat);if(n){var r=n.participants,s=r.get(e.jid);s&&(e.seq>s.sequence||e.seq===F)&&s.disable()}break;
default:w["default"].error("models:liveLocation:handle unknown type: "+e.type)(e)}}):w["default"].error("models:liveLocation:handle unrecognized payload")(e)}},{key:"processMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w["default"].assert(e.type===b["default"].MSG_TYPE.LOCATION&&e.isLive,"collection:liveLocation trying to process non live-location msg")();var i=e.id.remote,a=e.lat,n=e.lng,r=e.accuracy,s=e.speed,o=e.degrees,d=e.sequence,u=e.comment,l=e.shareDuration,c=e.t;if(c&&l){var f=c+l;if(!(f<=E["default"].globalUnixTime())){var h={id:e.sender,lat:a,lng:n,accuracy:r,speed:s,degrees:o,sequence:d,comment:u,expiration:f,lastUpdated:c,msg:e};d===F&&delete h.sequence;var p=this.get(i);if(p){var g=p.participants.get(h.id);if(t)return void(g&&g.lastUpdated<=h.lastUpdated&&g.set(h));if(g&&p.participants.removeParticipant(g),p.hasParticipants())return void p.participants.add(h)}this.add({id:i,participants:[h]})}}}},{key:"removeMsg",value:function(e){w["default"].assert(e.type===b["default"].MSG_TYPE.LOCATION&&e.isLive,"collection:liveLocation trying to remove non live-location msg")();var t=e.id.remote,i=e.sender,a=this.get(t);a&&a.participants.remove(i)}},{key:"_extractLocationFields",value:function(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:E["default"].globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}]),t}(I["default"]);U.model=A["default"],U.staleCollection=!0,U.resumeOnAvailable=!0,t["default"]=new U},'"bjjbbjfiee"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){return new Me(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE=void 0;var s=i('"ecejadjgjf"'),o=n(s),d=i('"djecddgbji"'),u=n(d),l=i('"cdehffajbd"'),c=n(l),f=i('"ddcedhgjff"'),h=n(f),p=i('"ebfebbhae"'),g=n(p),v=i('"cfcbddfj"'),_=n(v),m=i('"dfhdhdbidh"'),y=n(m),b=i('"cdfdhedgig"'),T=n(b),E=i('"bejijbfaij"'),M=n(E),C=i('"deijabejja"');Object.defineProperty(t,"TYPE",{enumerable:!0,get:function(){return C.MSG_TYPE}});var S=i('"bgafgbafci"'),j=n(S),k=i('"biafgdghfb"'),A=a(k),P=i('"djeidhfjae"'),w=a(P),O=i('"bebcachjfd"'),I=n(O),L=i('"bieahhccba"'),N=n(L),R=n(C),D=i('"fhabbhhjc"'),G=n(D),F=i('"jfefjijii"'),U=n(F),x=i('"cjjgiaccfb"'),Y=n(x),B=i('"djdcdaecea"'),V=n(B),q=i('"eajcgheajf"'),H=a(q),W=i('"cehbbagije"'),K=n(W),z=i('"bidbcdddff"'),Q=n(z),J=i('"dacbaddbce"'),X=n(J),Z=i('"bjhdjifgah"'),$=n(Z),ee=i('"ebhdebaagj"'),te=n(ee),ie=i('"dhjiafjcai"'),ae=n(ie),ne=i('"jgccihjdj"'),re=a(ne),se=i('"bgfahifgbh"'),oe=a(se),de=i('"bafjcjabca"'),ue=n(de),le=i('"dgfhfgbdeb"'),ce=n(le),fe=i('"dfahgfjgfj"'),he=n(fe),pe=i('"chddjeicgh"'),ge=n(pe),ve=i('"dfjcdaddbe"'),_e=n(ve),me=i('"eaafgdhhia"'),ye=n(me),be=i('"jfggdfjji"'),Te=i('"fccadfdfc"'),Ee=function(e){function t(){var e,i,a,n;(0,g["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,y["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,O.prop)(),a.body=(0,O.prop)(),a.type=(0,O.prop)(),a.subtype=(0,O.prop)(),a.t=(0,O.prop)(),a.notifyName=(0,O.prop)(),a.from=(0,O.prop)(),a.to=(0,O.prop)(),a.author=(0,O.prop)(),a.self=(0,O.prop)("in"),a.ack=(0,O.prop)(),a.invis=(0,O.prop)(),a.isNewMsg=(0,O.prop)(),a.star=(0,O.prop)(!1),a.recvFresh=(0,O.prop)(),a.caption=(0,O.prop)(),a.clientUrl=(0,O.prop)(),a.loc=(0,O.prop)(),a.lat=(0,O.prop)(),a.lng=(0,O.prop)(),a.isLive=(0,O.prop)(),a.accuracy=(0,O.prop)(),a.speed=(0,O.prop)(),a.degrees=(0,O.prop)(),a.comment=(0,O.prop)(),a.sequence=(0,O.prop)(),a.shareDuration=(0,O.prop)(),a.finalLat=(0,O.prop)(),a.finalLng=(0,O.prop)(),a.finalAccuracy=(0,O.prop)(),a.finalThumbnail=(0,O.prop)(),a.finalSpeed=(0,O.prop)(),a.finalDegrees=(0,O.prop)(),a.finalTimeOffset=(0,O.prop)(),a.directPath=(0,O.prop)(),a.mimetype=(0,O.prop)(),a.duration=(0,O.prop)(),a.filehash=(0,O.prop)(),a.uploadhash=(0,O.prop)(),a.size=(0,O.prop)(),a.filename=(0,O.prop)(),a.streamingSidecar=(0,O.prop)(),a.mediaKey=(0,O.prop)(),a.pageCount=(0,O.prop)(),a.isGif=(0,O.prop)(),a.gifAttribution=(0,O.prop)(),a.streamable=(0,O.prop)(),a.width=(0,O.prop)(),a.height=(0,O.prop)(),a.canonicalUrl=(0,O.prop)(),a.matchedText=(0,O.prop)(),a.thumbnail=(0,O.prop)(),a.richPreviewType=(0,O.prop)(),a.title=(0,O.prop)(),a.description=(0,O.prop)(),a.businessOwnerJid=(0,O.prop)(),a.productId=(0,O.prop)(),a.recipients=(0,O.prop)(),a.broadcast=(0,O.prop)(),a.quotedMsg=(0,O.prop)(),a.quotedStanzaID=(0,O.prop)(),a.quotedRemoteJid=(0,O.prop)(),a.quotedParticipant=(0,O.prop)(),a.mentionedJidList=(0,O.prop)(),a.multicast=(0,O.prop)(),a.urlText=(0,O.prop)(),a.urlNumber=(0,O.prop)(),a.clearMedia=(0,O.prop)(),a.vcardList=(0,O.prop)(),a.protocolMessageKey=(0,O.prop)(),a.templateParams=(0,O.prop)(),a.textColor=(0,O.prop)(),a.backgroundColor=(0,O.prop)(),a.font=(0,O.prop)(),a.isForwarded=(0,O.prop)(!1),a.forwardingScore=(0,O.prop)(),a.labels=(0,O.prop)(),a.currency=(0,O.prop)(),a.amount1000=(0,O.prop)(),a.receiverJid=(0,O.prop)(),a.paymentStatus=(0,O.prop)(),a.paymentNoteMsg=(0,O.prop)(),a.paymentTransactionTimestamp=(0,O.prop)(),a.paymentRequestMessageKey=(0,O.prop)(),a._currencyCodeIso4217=(0,O.prop)(),a._paymentRequestFrom=(0,O.prop)(),a._paymentExpiryTimestamp=(0,O.prop)(),a.promises=(0,O.session)(function(){return{}}),a.local=(0,O.session)(),a.search=(0,O.session)(),a.msgChunk=(0,O.session)(),a.phoneUploading=(0,O.session)(),a.startOfDay=(0,O.session)(),a.startOfDaySkew=(0,O.session)(),a._quotedMsgObj=(0,O.session)(),a.isQuotedMsgAvailable=(0,O.session)(!0),a.senderObj=(0,O.session)(),a.mediaData=(0,O.session)(),a._links=(0,O.session)(function(){return[]}),a.linksIndexParsed=(0,O.session)(0),a.chat=(0,O.derived)(a._chat),a.isFutureproof=(0,O.derived)(a._isFutureproof,["type","subtype"]),a.isGroupMsg=(0,O.derived)(a._isGroupMsg),a.isStatusV3=(0,O.derived)(a._isStatusV3),a.isPSA=(0,O.derived)(a._isPSA),a.statusV3TextBg=(0,O.derived)(a._statusV3TextBg),a.isSentByMe=(0,O.derived)(a._isSentByMe),a.isSentByMeFromWeb=(0,O.derived)(a._isSentByMeFromWeb,["isUserCreatedType"]),a.isNotification=(0,O.derived)(a._isNotification,["type"]),a.isGroupNotification=(0,O.derived)(a._isGroupNotification,["type"]),a.isBroadcastNotification=(0,O.derived)(a._isBroadcastNotification,["type"]),a.isBizNotification=(0,O.derived)(a._isBizNotification,["type","subtype"]),a.isMedia=(0,O.derived)(a._isMedia,["type"]),a.isDoc=(0,O.derived)(a._isDoc,["type"]),a.isMMS=(0,O.derived)(a._isMMS,["type"]),a.isRevoked=(0,O.derived)(a._isRevoked,["type"]),a.numTimesForwarded=(0,O.derived)(a._numTimesForwarded,["isForwarded","forwardingScore"]),a.isFrequentlyForwarded=(0,O.derived)(a._isFrequentlyForwarded,["numTimesForwarded"]),a.eventType=(0,O.derived)(a._eventType,["type","invis","isNewMsg"]),a.sender=(0,O.derived)(a._sender),a.text=(0,O.derived)(a._text,["type","body","caption","comment","isLive","paymentNoteMsg"]),a.containsEmoji=(0,O.derived)(a._containsEmoji,["text"]),a.isFailed=(0,O.derived)(a._isFailed,["isSentByMe","ack"]),a.vcard=(0,O.derived)(a._vcard,["type","body"]),a.isUnsentMedia=(0,O.derived)(a._isUnsentMedia,["ack","isMMS","isSentByMe"]),a.dir=(0,O.derived)(a._dir,["type","text","subtype"]),a.rtl=(0,O.derived)(a._rtl,["type","text","subtype"]),a.linkPreview=(0,O.derived)(a._linkPreview,["matchedText","body","title","description"]),a.isPersistent=(0,O.derived)(a._isPersistent),a.isUnreadType=(0,O.derived)(a._isUnreadType,["type"]),a.isUserCreatedType=(0,O.derived)(a._isUserCreatedType,["type"]),n=i,(0,y["default"])(a,n)}return(0,M["default"])(t,e),(0,_["default"])(t,[{key:"_chat",value:function(){return te["default"].Chat.get(this.id.remote)}},{key:"_isFutureproof",value:function(){return this.type===C.MSG_TYPE.UNKNOWN||this.type===C.MSG_TYPE.PAYMENT&&"futureproof"===this.subtype||this.type===C.MSG_TYPE.PRODUCT}},{key:"_isGroupMsg",value:function(){return ue["default"].isGroup(this.from)||ue["default"].isGroup(this.to)}},{key:"_isStatusV3",value:function(){return ue["default"].isStatusV3(this.id.remote)}},{key:"_isPSA",value:function(){return ue["default"].isPSA(this.id.remote)}},{key:"_statusV3TextBg",value:function(){if(!this.isStatusV3)return null;var e=this.backgroundColor;if(!e)return null;var t=e>>24&255,i=e>>16&255,a=e>>8&255,n=255&e;return"rgba("+i+", "+a+", "+n+", "+t+")"}},{key:"_isSentByMe",value:function(){var e=this.id;return"in"!==e.self&&!this.isNotification&&ue["default"].equals(this.from,U["default"].me)}},{key:"_isSentByMeFromWeb",value:function(){return this.id.fromMe&&this.local&&this.isUserCreatedType}},{key:"_isNotification",value:function(){switch(this.type){case C.MSG_TYPE.GROUP_NOTIFICATION:case C.MSG_TYPE.GP2:case C.MSG_TYPE.BROADCAST_NOTIFICATION:case C.MSG_TYPE.NOTIFICATION:case C.MSG_TYPE.NOTIFICATION_TEMPLATE:case C.MSG_TYPE.E2E_NOTIFICATION:case C.MSG_TYPE.CALL_LOG:return!0;default:return!1}}},{key:"_isGroupNotification",value:function(){switch(this.type){case C.MSG_TYPE.GROUP_NOTIFICATION:case C.MSG_TYPE.GP2:return!0;default:return!1}}},{key:"_isBroadcastNotification",value:function(){return this.type===C.MSG_TYPE.BROADCAST_NOTIFICATION}},{key:"_isBizNotification",value:function(){if(this.type===C.MSG_TYPE.NOTIFICATION_TEMPLATE)switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}return!1}},{key:"_isMedia",value:function(){return["image","video","audio"].indexOf(this.type)>-1}},{key:"_isDoc",value:function(){return"document"===this.type}},{key:"_isMMS",value:function(){return re.typeIsMMS(this.type)}},{key:"_isRevoked",value:function(){return this.type===C.MSG_TYPE.REVOKED}},{key:"_numTimesForwarded",value:function(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}},{key:"_isFrequentlyForwarded",value:function(){return this.numTimesForwarded>=R["default"].FREQUENTLY_FORWARDED_SENTINEL}},{key:"_eventType",value:function(){if(!this.isNewMsg)return"i";var e=this.eventTypeFromMsgType();return this.invis?"i"===e?"i":"n":e}},{key:"_sender",value:function(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from}},{key:"_text",value:function(){switch(this.type){case C.MSG_TYPE.CHAT:return this.body;case C.MSG_TYPE.IMAGE:case C.MSG_TYPE.VIDEO:return this.caption;case C.MSG_TYPE.LOCATION:return this.isLive?this.comment:void 0;case C.MSG_TYPE.PAYMENT:var e=this.paymentNoteMsg;return e?e.body:void 0;default:return}}},{key:"_containsEmoji",value:function(){var e=this.text;return!!e&&Y["default"].containsEmoji(e)}},{key:"_isFailed",value:function(){return this.isSentByMe&&this.ack<0}},{key:"_vcard",value:function(){if(this.type===C.MSG_TYPE.VCARD)try{return ge["default"].parse(this.body)}catch(e){return}}},{key:"_isUnsentMedia",value:function(){return this.ack<1&&this.isMMS&&this.isSentByMe}},{key:"_dir",value:function(){return this.type===C.MSG_TYPE.VCARD?this.subtype?N["default"].dir(this.subtype):void 0:this.text?N["default"].dir(this.text):void 0}},{key:"_rtl",value:function(){return this.type===C.MSG_TYPE.VCARD?!!this.subtype&&"rtl"===N["default"].dir(this.subtype):!!this.text&&"rtl"===N["default"].dir(this.text)}},{key:"_linkPreview",value:function(){return(0,Te.isString)(this.matchedText)&&(!j["default"].isEmpty(this.title)||!j["default"].isEmpty(this.description))&&this.body.indexOf(this.matchedText)>-1}},{key:"_isPersistent",value:function(){return this.type===C.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===this.subtype}},{key:"_isUnreadType",value:function(){return[C.MSG_TYPE.CHAT,C.MSG_TYPE.IMAGE,C.MSG_TYPE.VIDEO,C.MSG_TYPE.AUDIO,C.MSG_TYPE.PTT,C.MSG_TYPE.DOCUMENT,C.MSG_TYPE.VCARD,C.MSG_TYPE.LOCATION,C.MSG_TYPE.CIPHERTEXT,C.MSG_TYPE.OVERSIZED,C.MSG_TYPE.MULTI_VCARD,C.MSG_TYPE.REVOKED,C.MSG_TYPE.UNKNOWN,C.MSG_TYPE.STICKER].indexOf(this.type)>=0}},{key:"_isUserCreatedType",value:function(){return[C.MSG_TYPE.PROTOCOL,C.MSG_TYPE.CHAT,C.MSG_TYPE.LOCATION,C.MSG_TYPE.VCARD,C.MSG_TYPE.MULTI_VCARD,C.MSG_TYPE.IMAGE,C.MSG_TYPE.VIDEO,C.MSG_TYPE.AUDIO,C.MSG_TYPE.PTT,C.MSG_TYPE.DOCUMENT,C.MSG_TYPE.STICKER].indexOf(this.type)>=0}},{key:"initialize",value:function(){var e=this;if((0,T["default"])(t.prototype.__proto__||(0,h["default"])(t.prototype),"initialize",this).call(this),this.sender)this.addChild("senderObj",te["default"].Contact.gadd(this.sender));else switch(this.type){case C.MSG_TYPE.NOTIFICATION:case C.MSG_TYPE.NOTIFICATION_TEMPLATE:case C.MSG_TYPE.GROUP_NOTIFICATION:case C.MSG_TYPE.GP2:case C.MSG_TYPE.BROADCAST_NOTIFICATION:case C.MSG_TYPE.E2E_NOTIFICATION:case C.MSG_TYPE.CALL_LOG:case C.MSG_TYPE.PROTOCOL:break;default:K["default"].log("msg:msg with no sender id:"+this.id.toString()+", from:"+this.from.toString()+", author:"+(this.author&&this.author.toString())+", type:"+this.type)()}j["default"].forEach(this.mentionedJidList,function(e){return te["default"].Contact.gadd(e)});var i=void 0,a=this.getCollection();(i=a.preAck[this.id])&&(K["default"].log("Msg:initialize updating msg with out of order ack",i)(),this.updateAck(i.ack),delete a.preAck[this.id]),this.type===C.MSG_TYPE.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this._mediaObject=void 0,re.typeIsMMS(this.type)&&(this._createMediaDataChild(),w.registerMsg(this)),this.isSentByMeFromWeb&&(this.promises.sendPromise=c["default"].sit("settled")["finally"](function(){e.promises.sendPromise=null}).endWithControls("settled")),this.isLive&&te["default"].LiveLocation.processMsg(this,!1),U["default"].isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection)),$["default"].webRestoreFromCache&&this.listenTo(this,"change:ack",this.onAckChange)}},{key:"getLinks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R["default"].MSG_TRUNC_LENGTH+1,t=this.text;if(!t)return this._links;if(this.linksIndexParsed>=e)return this._links;var i=(0,be.firstNCodepoints)(t,e),a=!1,n=H.findLinks(i,a,this.sender);if(t.length>e&&n.length>0){var r=n[n.length-1],s=r.index+(0,be.numCodepoints)(r.url);s===e&&(n=H.findLinks(t,a,this.sender))}return this.linksIndexParsed=e,this._links=n}},{key:"getGalleryLinks",value:function(){return j["default"].uniqBy(this.getLinks(),"href").filter(function(e){return e.isHttp})}},{key:"getSuspiciousLinks",value:function(){return this.getLinks().filter(function(e){return e.suspiciousCharacters&&e.suspiciousCharacters.size})}},{key:"addLabelsToCollection",value:function(){(0,ye["default"])(this.id.toString(),this.labels,"Msg")}},{key:"_createMediaDataChild",value:function(){this.addChild("mediaData",new Q["default"])}},{key:"hasSymbol",value:function(){return["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","groups_v4_invite","product"].indexOf(this.type)>-1}},{key:"mayFail",value:function(){return this.isSentByMe&&this.ack<1}},{key:"isUnsentPhoneMsg",value:function(){return!this.local&&this.isSentByMe&&this.ack<1}},{key:"canReply",value:function(){return this.chat.canSend&&!this.mayFail()&&!this.isNotification&&this.type!==C.MSG_TYPE.UNKNOWN&&this.type!==C.MSG_TYPE.CIPHERTEXT&&this.type!==C.MSG_TYPE.OVERSIZED&&this.type!==C.MSG_TYPE.REVOKED&&V["default"].supportsFeature(V["default"].F.REPLIES_OUT)}},{key:"canPrivateReply",value:function(){return!this.mayFail()&&!this.isNotification&&this.type!==C.MSG_TYPE.UNKNOWN&&this.type!==C.MSG_TYPE.CIPHERTEXT&&this.type!==C.MSG_TYPE.OVERSIZED&&this.type!==C.MSG_TYPE.REVOKED&&V["default"].supportsFeature(V["default"].F.REPLIES_OUT)&&!this.isSentByMe&&this.isGroupMsg&&V["default"].supportsFeature(V["default"].F.PRIVATE_REPLY)}},{key:"canPrivateReplyInRestrictedGrp",value:function(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&V["default"].supportsFeature(V["default"].F.PRIVATE_REPLY)&&V["default"].supportsFeature(V["default"].F.REPLIES_OUT)&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==C.MSG_TYPE.UNKNOWN&&this.type!==C.MSG_TYPE.CIPHERTEXT&&this.type!==C.MSG_TYPE.OVERSIZED&&this.type!==C.MSG_TYPE.REVOKED}},{key:"canForward",value:function(){if(this.type===C.MSG_TYPE.CIPHERTEXT)return!1;if(this.type===C.MSG_TYPE.OVERSIZED)return!1;if(this.type===C.MSG_TYPE.REVOKED)return!1;if(this.type===C.MSG_TYPE.UNKNOWN)return!1;if(this.type===C.MSG_TYPE.PAYMENT)return!1;if(this.type===C.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(this.type===C.MSG_TYPE.LOCATION&&this.isLive)return!1;if(this.ack<1&&this.isSentByMe)return!1;if(this.isMMS){var e=this.mediaData;if(!w.canSendType(e.type))return!1;if(e.mediaStage===Q["default"].STAGE.ERROR_MISSING)return!1;if(e.mediaStage===Q["default"].STAGE.ERROR_UNSUPPORTED)return!1;if(this.isUnsentMedia)return!1}return!0}},{key:"canQuickForward",value:function(){return this.canForward()&&!this.isFrequentlyForwarded&&0===this.getSuspiciousLinks().length&&this.type!==R["default"].MSG_TYPE.PTT&&this.type!==R["default"].MSG_TYPE.STICKER&&(this.isMMS||this.linkPreview||this.type===R["default"].MSG_TYPE.LOCATION)}},{key:"canStar",value:function(){return!(this.isNotification||this.isFutureproof||this.type===C.MSG_TYPE.REVOKED||this.ack<1&&this.isSentByMe)}},{key:"isGroupLeave",value:function(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&ue["default"].equals(j["default"].head(this.recipients),U["default"].me)}},{key:"isTrusted",value:function(){return!!ue["default"].equals(this.sender,U["default"].me)||(!(!this.senderObj||!this.senderObj.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():this.chat.notSpam))}},{key:"getWAids",value:function(){return this.type!==C.MSG_TYPE.VCARD?null:ge["default"].vcardWAids(this.vcard)}},{key:"getVCardThumbnailWAid",value:function(){return this.type!==C.MSG_TYPE.VCARD?null:ge["default"].thumbnailWAid(this.getWAids())}},{key:"getLocObject",value:function(){var e=this.loc;if(e){var t=e.split("\n"),i=(0,u["default"])(t,2),a=i[0],n=i[1],r=void 0===n?null:n;return{name:a,addr:r}}return null}},{key:"resumeRemoteUpload",value:function(){var e=this;if(this.isUnsentPhoneMsg()&&!this.phoneUploading){var t=this.getCollection();t.send(this).then(function(t){"success"!==t&&(e.phoneUploading=!1)}),this.phoneUploading=!0}return this.downloadMedia(!0)}},{key:"forceDownloadMedia",value:function(){return this.downloadMedia(!0)}},{key:"forceRMR",value:function(){return c["default"].reject(new Error("unimplemented forceRMR"))}},{key:"isForcingRMR",value:function(){return!1}},{key:"cancelDownload",value:function(){w.cancelDownloadMsg(this)}},{key:"resumeUpload",value:function(){K["default"].assert(this.mediaData.mediaStage===Q["default"].STAGE.NEED_UPLOAD,"resume-non-need-upload","resumeUpload called while state was "+this.mediaData.mediaStage)(),w.resumeUploadMsg(this)}},{key:"cancelUpload",value:function(){w.cancelUploadMsg(this)}},{key:"downloadMedia",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isRevoked)return c["default"].resolve();if(K["default"].assert(this.isMMS,"media-fault","downloadMedia called on non-mms msg")(),this.isUnsentPhoneMsg()){var i=this.promises.waitForPhoneUpload;return i||(i=this.promises.waitForPhoneUpload=oe.waitForBBEvent(this.mediaData,"change:mediaStage change:filehash",function(){return!!e.mediaData.filehash&&!e.isUnsentPhoneMsg()}).then(function(){e.promises.waitForPhoneUpload=null})),i.then(function(){return e.downloadMedia(t)})}return w.downloadMsg(this,t)}},{key:"applyUpdate",value:function(e){var t=this;if(e.type&&this.type!==e.type&&re.typeIsMMS(e.type))return this.type!==C.MSG_TYPE.CIPHERTEXT&&K["default"].assert(!1,"invalid-type-update","updated "+this.id.toString()+" from "+this.type+" to "+e.type)(),this._createMediaDataChild(),w.registerMsgEarly(this,e),w.prepareMsg(this).then(function(){t.set(e)})["catch"](function(e){K["default"].assert(!1,"preregister-error","error = "+String(e))(e)});if(this.set(e),this.isLive&&te["default"].LiveLocation.processMsg(this,!0),this.paymentTransactionTimestamp){var i=this.getCollection();i.updateLastTransactionTime(this.id.remote,this.paymentTransactionTimestamp)}return c["default"].resolve()}},{key:"waitForPrep",value:function(){return re.typeIsMMS(this.type)?w.prepareMsg(this):c["default"].resolve()}},{key:"delete",value:function(){(0,T["default"])(t.prototype.__proto__||(0,h["default"])(t.prototype),"delete",this).call(this),te["default"].AllStarredMsgs.remove(this),this.isLive&&te["default"].LiveLocation.removeMsg(this);var e=this.getCollection();e.remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id),re.typeIsMMS(this.type)&&w.deregisterMsg(this);var i=te["default"].Chat.get(this.id.remote);if(i&&(i.unreadMsgAnchor===this&&(i.unreadMsgAnchor=void 0),i.lastReceivedKey===this.id)){i.lastReceivedKey=void 0;var a=i.getLastReceivedMsg();a&&(i.lastReceivedKey=a.id)}}},{key:"quotedMsgObj",value:function(){if(!this.quotedMsg)return null;if(this._quotedMsgObj){var e=this.getCollection();return re.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}var t=!this.quotedParticipant||ue["default"].equals(this.quotedParticipant,U["default"].me),i=t?"out":"in",a=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,n={id:this.quotedStanzaID,from:t?U["default"].me:a,to:t?a:U["default"].me,self:i,author:this.quotedParticipant,remote:a},r=ue["default"].isGroup(n.from)||ue["default"].isGroup(n.to);if(!r&&!ue["default"].isStatusV3(a)||ue["default"].equals(U["default"].me,this.quotedParticipant)||(n.participant=this.quotedParticipant),j["default"].assign(n,this.quotedMsg),!n)return n;this._quotedMsgObj=re.createQuotedMsg(n);var s=this.getCollection();return re.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,s)}},{key:"getQuotedMsgAdminGroupJid",value:function(){return!this.quotedMsg&&this.quotedRemoteJid}},{key:"contextInfo",value:function(e){var t=j["default"].omit(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast"]),i=void 0;return e&&!this.id.remote.equals(e)&&(i=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:i}}},{key:"displayName",value:function(e,t){if(!this.sender)return"";if(this.sender.equals(U["default"].me))return l10n.t("web_you");var i=this.senderObj,a=e?i.shortName:void 0;if(a)return a;if(i.name)return i.name;var n=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR((0,_e["default"])(this.sender))+n:(0,_e["default"])(this.sender)+n}},{key:"isQuoted",value:function(e){var t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}},{key:"isMentioned",value:function(e){return j["default"].findIndex(this.mentionedJidList,function(t){return t.equals(e)})>-1}},{key:"mentionMap",value:function(){if(!V["default"].supportsFeature(V["default"].F.MENTIONS_IN))return null;if(!j["default"].size(this.mentionedJidList))return null;var e={};return j["default"].forEach(this.mentionedJidList,function(t){e["@"+(ue["default"].user(t)||"")]=te["default"].Contact.gadd(t)}),e}},{key:"updateAck",value:function(e){var t=this.ack;(0,Te.isNumber)(e)&&("undefined"==typeof t||e>t)?this.ack=e:e===-1&&0===this.ack&&(this.ack=-1,this.phoneUploading=!1)}},{key:"canSendPlayed",value:function(){return!this.isSentByMe&&(!(this.ack>=R["default"].ACK_PLAYED)&&("ptt"===this.type||"video"===this.type&&!this.isGif&&V["default"].supportsFeature(V["default"].F.VIDEO_PLAYED_STATUS)))}},{key:"sendPlayed",value:function(){var e=this;this.canSendPlayed()?ce["default"].sendMessagePlayed(this.id).then(function(t){e.ack=R["default"].ACK_PLAYED})["catch"](A.WapDrop,function(){}):K["default"].log("Msg:msg should not call sendPlayed")()}},{key:"avParams",value:function(){return w.mediaMetadata(this)}},{key:"resend",value:function(){if(this.isFailed){this.ack=0;var e=this.getCollection();return this.isMMS?this.resumeRemoteUpload():e.send(this)}return c["default"].resolve()}},{key:"onCiphertextDecrypted",value:function(){if(!this.isStatusV3){var e=this.chat,t=e.msgs.length,i=e.msgs.indexOf(this);i!==-1&&t-i<=10&&G["default"].alertNewMsg(this)}}},{key:"onAckChange",value:function(){this.chat&&$["default"].webRestoreFromCache&&this.chat.trigger("change:msg:ack")}},{key:"eventTypeFromMsgType",value:function(){var e=this.type,t=this.subtype,i=void 0,a=void 0;return e===C.MSG_TYPE.GP2||e===C.MSG_TYPE.GROUP_NOTIFICATION?"subject"===t?i="n":"add"===t||"invite"===t?(a=j["default"].head(this.recipients),i=ue["default"].equals(a,U["default"].me)?"s":"i"):"remove"===t?(a=j["default"].head(this.recipients),i=ue["default"].equals(a,U["default"].me)?"n":"i"):i="create"===t?"n":"i":i=e===C.MSG_TYPE.BROADCAST_NOTIFICATION||e===C.MSG_TYPE.NOTIFICATION||e===C.MSG_TYPE.E2E_NOTIFICATION?"create"===t?"n":"i":e===C.MSG_TYPE.CALL_LOG?"n":this.broadcast||e===C.MSG_TYPE.REVOKED?"i":this.isPSA?2===this.ack?"d":"a":e===C.MSG_TYPE.CIPHERTEXT||e===C.MSG_TYPE.OVERSIZED?"a":e===C.MSG_TYPE.NOTIFICATION_TEMPLATE?"i":"d",i}},{key:"canRevoke",value:function(){return V["default"].supportsFeature(V["default"].F.REVOKE)&&this.id.fromMe&&this.isUserCreatedType&&(!ue["default"].isBroadcast(this.id.remote)||"iphone"===U["default"].platform)&&!this.broadcast&&(0,o["default"])(+new Date/1e3)-this.t<=R["default"].REVOKE_WINDOW&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia}},{key:"revoke",value:function(e){re.typeIsMMS(this.type)&&w.deregisterMsg(this),this.chat&&this.chat.removeFromCollection(this);var t=this.getCollection(),i=this.id;if(this.msgChunk.replaceId(i,e),t.replaceId(i,e),this.set({id:e,type:C.MSG_TYPE.REVOKED,body:void 0,caption:void 0,clientUrl:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1}),this.trigger("change:msgKey",{newKey:e,oldKey:i}),this.chat&&this.chat.updateMediasCountOnMsg(this,!0),this.chat&&i.equals(this.chat.lastReceivedKey)&&(this.chat.lastReceivedKey=e),this.isLive&&te["default"].LiveLocation.removeMsg(this),ue["default"].isBroadcast(i.remote)){var a=re.getBroadcastFanoutKeys(i),n=re.getBroadcastFanoutKeys(e);if(!a||!n||a.length!==n.length)return void K["default"].log("cannot fanout revoke: "+String(a)+" "+String(n))(a,n);j["default"].zip(a,n).forEach(function(e){var i=t.get(e[0]);i&&i.revoke(e[1])})}}},{key:"getWamMessageType",value:function(){return this.isStatusV3?X["default"].MESSAGE_TYPE.STATUS:this.isGroupMsg?X["default"].MESSAGE_TYPE.GROUP:ue["default"].isBroadcast(this.id.remote)?X["default"].MESSAGE_TYPE.BROADCAST:X["default"].MESSAGE_TYPE.INDIVIDUAL}},{key:"getWamMediaType",value:function(){switch(this.type){case C.MSG_TYPE.IMAGE:return X["default"].MEDIA_TYPE.PHOTO;case C.MSG_TYPE.VIDEO:return this.mediaData.isGif?X["default"].MEDIA_TYPE.GIF:X["default"].MEDIA_TYPE.VIDEO;case C.MSG_TYPE.AUDIO:return X["default"].MEDIA_TYPE.AUDIO;case C.MSG_TYPE.PTT:return X["default"].MEDIA_TYPE.PTT;case C.MSG_TYPE.DOCUMENT:return X["default"].MEDIA_TYPE.DOCUMENT;case C.MSG_TYPE.UNKNOWN:return X["default"].MEDIA_TYPE.FUTURE;case C.MSG_TYPE.LOCATION:return this.isLive?X["default"].MEDIA_TYPE.LIVE_LOCATION:X["default"].MEDIA_TYPE.LOCATION;case C.MSG_TYPE.VCARD:return X["default"].MEDIA_TYPE.CONTACT;case C.MSG_TYPE.MULTI_VCARD:return X["default"].MEDIA_TYPE.CONTACT_ARRAY;case C.MSG_TYPE.CHAT:return this.linkPreview?X["default"].MEDIA_TYPE.URL:X["default"].MEDIA_TYPE.NONE;default:return X["default"].MEDIA_TYPE.NONE}}},{key:"sendRevoke",value:function(e){var t=this;if(!V["default"].supportsFeature(V["default"].F.REVOKE))return c["default"].reject("revoke feature unsupported");if(!this.id.fromMe)return c["default"].reject("revoking received message");var i=new ae["default"]({id:(0,he["default"])(),remote:this.id.remote,fromMe:!0}),a={id:i,to:this.id.remote,t:this.t,type:C.MSG_TYPE.PROTOCOL,subtype:"revoke",protocolMessageKey:this.id,clearMedia:!!e,local:!0},n=this.getCollection();return n.send(r(a)).then(function(e){if("success"===e){var a=(0,o["default"])(Date.now()/1e3-t.t);return new X["default"].SendRevokeMessage({messageType:t.getWamMessageType(),messageMediaType:t.getWamMediaType(),revokeSendDelay:a}).commit(),t.revoke(i),c["default"].resolve("success")}return c["default"].reject("dropped")})}},{key:"showForwarded",value:function(){var e=$["default"].fwdUiStartTs;return this.numTimesForwarded>0&&e>0&&e<this.t&&!this.isRevoked}},{key:"getForwardingScoreWhenForwarded",value:function(){if(!$["default"].frequentlyForwardedMessages)return this.numTimesForwarded;var e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=$["default"].frequentlyForwardedThreshold?R["default"].FREQUENTLY_FORWARDED_SENTINEL:e}}]),t}(I["default"]);Ee.Collection="Msg",Ee.Proxy="msg",Ee.idClass=ae["default"];var Me=(0,O.defineModel)(Ee);t["default"]=Me},'"bidieaecca"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"bgjiajcadc"'),s=n(r),o=i('"djecddgbji"'),d=n(o),u=i('"cdehffajbd"'),l=n(u),c=i('"ddcedhgjff"'),f=n(c),h=i('"ebfebbhae"'),p=n(h),g=i('"cfcbddfj"'),v=n(g),_=i('"dfhdhdbidh"'),m=n(_),y=i('"cdfdhedgig"'),b=n(y),T=i('"bejijbfaij"'),E=n(T),M=i('"bgafgbafci"'),C=n(M),S=i('"jfefjijii"'),j=i('"bgabbbeeca"'),k=n(j),A=i('"bhchacaadd"'),P=n(A),w=i('"jfefjijii"'),O=n(w),I=i('"deijabejja"'),L=n(I),N=i('"biafgdghfb"'),R=a(N),D=i('"djgdgcgjh"'),G=n(D),F=i('"cfafceedhd"'),U=n(F),x=i('"djdcdaecea"'),Y=n(x),B=i('"cehbbagije"'),V=n(B),q=i('"bjjbbjfiee"'),H=n(q),W=i('"dhjiafjcai"'),K=n(W),z=i('"jgccihjdj"'),Q=a(z),J=i('"bgfahifgbh"'),X=a(J),Z=i('"dafgbfehgf"'),$=n(Z),ee=i('"ebhdebaagj"'),te=n(ee),ie=i('"bdcdfifjcj"'),ae=n(ie),ne=i('"bhcejhfhjg"'),re=n(ne),se=i('"dgfhfgbdeb"'),oe=n(se),de=i('"bafjcjabca"'),ue=n(de),le=i('"gggdaifb"'),ce=i('"jfijghaad"'),fe=n(ce),he=i('"fccadfdfc"'),pe=function(e){function t(){(0,p["default"])(this,t);var e=(0,m["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this));return e.lastReceivedReceipt={},e.lastReceivedPaymentTransaction={},e.preAck={},e.pendingAdd={},e.ftsCache={},e.keysForResyncReceipts=void 0,e.listenTo($["default"],"change:stream",function(){$["default"].stream===Z.STREAM.DISCONNECTED&&(this.preAck={})}),e.listenTo(e,"remove",e.removeFromCollection),e}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"removeFromCollection",value:function(e){e.chat&&e.chat.removeFromCollection(e)}},{key:"_findQuery",value:function(e,t){var i=this,a=void 0;switch(e.direction){case"before":case"after":a=e.direction;break;default:a="before"}return oe["default"].msgFindQuery(a,e,t).then(function(t){if(t.status>=400)return V["default"].error("model:Msg:findQuery error "+t.status)(),l["default"].reject(t.status);
var n=function(){var t=i.get(e),a=te["default"].Chat.get(e.remote);return t?t.msgChunk:a?a.msgs:void 0};return t.forEach(function(e){e.invis=!0}),V["default"].log("model:Msg:findQuery:got:"+t.length+":"+e.direction)(),i.processMultipleMessages(e.remote,t,{add:a,isHistory:!0},n)})}},{key:"getStarred",value:function(e,t,i,a){var n=this,r={count:"number"!=typeof t||isNaN(t)?L["default"].PAGE_SIZE:t,chat:e?e:void 0,remote:i&&i.remote,id:i&&i.id,fromMe:i&&i.fromMe,participant:i&&i.participant,media:a?"gif":void 0};return oe["default"].msgFindQuery("star",r).then(function(e){var t=e.status;return e.status>=400?(499===t?V["default"].log("model:Msg:getStarred error 499 (unimplemented)")():V["default"].error("model:Msg:getStarred error "+t)(),l["default"].reject(t)):n.processMultipleMessages(void 0,e,{add:"search"})})}},{key:"queryVCard",value:function(e){var t=this;return oe["default"].queryVCard(e).then(function(e){return 499===e.status?(V["default"].log("model:Msg:queryVCard error 499 (unimplemented)")(),l["default"].reject(new R.E499)):t.processMultipleMessages(void 0,e,{add:"search"})})}},{key:"incrementalStarredUpdate",value:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})}},{key:"search",value:function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments[2],n=this,r=arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=e+"__"+(s.label||s.kind||"");if(1!==t||r)return this._search(e,t,a,r,s.label,s.kind);var d=this.ftsCache[o];if(d)return d;var i=this._search(e,t,a,r,s.label,s.kind);this.ftsCache[o]=i;var u=function(){n.ftsCache[o]=null};return C["default"].delay(u,L["default"].FTS_TTL),i["catch"](u),i}},{key:"_search",value:function(e,t,i,a,n,r){var s=this,o={searchTerm:e,page:t&&(0,he.isNumber)(t)?t:1,count:i&&(0,he.isNumber)(i)?i:L["default"].PAGE_SIZE,remote:a,label:n,kind:r};return oe["default"].msgFindQuery("search",o).then(function(e){if(404===e.status)return l["default"].reject(new R.E404);if(e.status>=400)return V["default"].error("model:Msg:search error "+e.status)(),l["default"].reject(e.status);var t=Array.isArray(e)?e:e.messages,i=!!Array.isArray(e)||e.eof;return l["default"].props({messages:s.processMultipleMessages(void 0,t,{add:"search"}),eof:i})})}},{key:"queryMedia",value:function(e,t,i,a,n){var r=this,s={remote:e,count:t&&(0,he.isNumber)(t)?t:L["default"].PAGE_SIZE,id:a&&a.id,fromMe:a&&a.fromMe,participant:a&&a.participant,direction:i||"before",media:n};return oe["default"].msgFindQuery("media",s).then(function(e){return e.status>=400?(V["default"].error("model:Msg:media error "+e.status)(),l["default"].reject(e.status)):n?r.processMultipleMessages(void 0,e,{add:"search"}):l["default"].props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:r.processMultipleMessages(void 0,e.messages,{add:"search"})})})}},{key:"getContext",value:function(e,t,i){var a=this,n=this.get(e);return n?l["default"].all([oe["default"].msgFindQuery("before",e,i),oe["default"].msgFindQuery("after",e,i)]).spread(function(i,r){return Array.isArray(i)&&Array.isArray(r)?(n.search=!1,l["default"].all([a.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),a.processMultipleMessages(e.remote,r,{add:"after",isHistory:!0},t)])):(V["default"].error("model:msg:getContext fetch error",i,r)(),l["default"].reject(i.status||r.status))}):oe["default"].msgFindQuery("after",e,i).then(function(i){return Array.isArray(i)?ue["default"].isStatusV3(i[0].id.remote)?l["default"].reject("statusV3, stop querying before the msg"):a.processMultipleMessages(e.remote,i,{add:"after",isHistory:!0},t):(V["default"].error("model:msg:getContext:after fetch error",i)(),l["default"].reject(i.status))}).then(function(t){var n=(0,fe["default"])(t[0]),r=n.id.clone();return r.count=e.count+1,l["default"].all([oe["default"].msgFindQuery("before",r,i).then(function(t){if(!Array.isArray(t))return V["default"].error("model:msg:getContext:before fetch error",t)(),l["default"].reject(t.status);var i=t[t.length-1],r=i.id;if(!r.equals(e))return V["default"].error("model:msg:getContext:before ctx message mismatch",t)(),l["default"].reject(405);var s=function(){return n.msgChunk};return a.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},s)}),l["default"].resolve(t)])})}},{key:"handle",value:function(e){function t(e,t){var i=void 0;i=ue["default"].isStatusV3(a.broadcast)?new K["default"]({from:a.from,to:a.broadcast,id:t,selfDir:a.self||"out"}):new K["default"]({from:a.from,to:e,id:t,participant:a.participant,selfDir:a.self||"out"});var n=u.get(i);if(n){n.updateAck(a.ack),u.updateLastReceipt(i.remote,a.t);var r=i.remote;ue["default"].isUser(r)?(te["default"].MsgInfo.updateInfo(t,a.from,e,a.ack,r,a.t),ue["default"].isBroadcast(a.broadcast)&&te["default"].MsgInfo.updateInfo(t,a.from,a.broadcast,a.ack,r,a.t)):ue["default"].isStatusV3(r)&&te["default"].MsgInfo.updateInfo(t,a.from,r,a.ack,e,a.t)}else V["default"].log("Msg:out of order ack",a)(),u.preAck[i]=a}var i=(0,d["default"])(e,1),a=i[0],n=void 0,r=void 0,s=void 0,o=void 0,u=this;if("ack"===a.cmd){var l=[a.to];if(ue["default"].isBroadcast(a.to)&&1===a.ack){var c=te["default"].GroupMetadata.get(a.to);c&&Array.prototype.push.apply(l,C["default"].map(c.participants.toArray(),"id"))}l.forEach(function(e){t(e,a.id)})}else if("acks"===a.cmd)a.id.forEach(function(e){t(a.to,e)});else if(a.msg){if(!(a.chat instanceof ue["default"]))return;var f="update"===a.meta.add;ue["default"].isStatusV3(a.chat)&&!te["default"].StatusV3.handleUpdate(a.msg,a.meta.checksum,f)||(a.msg.recvFresh=!0,a.msg.isNewMsg=!0,this.processMultipleMessages(a.chat,[a.msg],{add:"after",update:f,isHistory:!1})["catch"](R.LogoutDrop,function(){}))}else if(a.msgs){var h=a.msgs.length;if(!h)return;if(!(a.chat instanceof ue["default"]))return;r=a.meta,r.isHistory=!0,"unread"===r.add&&(r.firstUnreadKey=new K["default"]({fromMe:r.unreadFromMe,remote:a.chat,id:r.unreadId,participant:r.unreadParticipant}),s=new P["default"]);for(var p=0;p<h;p++)n=a.msgs[p],n.invis=!0;O["default"].platform===S.PLATFORMS.IPHONE&&this.trigger(L["default"].COLLECTION_HAS_SYNCED),this.trigger("handle:msg_history",{count:a.msgs.length,binarySize:a.binarySize}),this.processMultipleMessages(a.chat,a.msgs,r,s)["catch"](R.LogoutDrop,function(){})}else if(a.recent){r=a.meta,o=a.binarySize,delete a.recent,delete a.meta,delete a.binarySize,this.trigger(L["default"].COLLECTION_HAS_SYNCED,{count:C["default"].keys(a).length,binarySize:o}),r.isHistory=!0;for(var g in a){var v=void 0;try{v=(0,le.createWid)(g)}catch(_){continue}"last"===r.add&&r.resume&&(s=new P["default"]),n=a[g],n.invis=!0,this.processMultipleMessages(v,[n],r,s)["catch"](R.LogoutDrop,function(){})}}else V["default"].log("************** Msg else clause. something strange is going on")()}},{key:"_hasSynced",value:function(){return X.waitForBBEvent(this,L["default"].COLLECTION_HAS_SYNCED)}},{key:"delete",value:function(){(0,b["default"])(t.prototype.__proto__||(0,f["default"])(t.prototype),"delete",this).call(this),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}},{key:"send",value:function(e){var t=this;return l["default"].callSynchronously(function(){var i=e.id,a=e.toJSON(),n=void 0;te["default"].Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](function(){})}),e.isNewMsg=!0;var r=e.type===L["default"].MSG_TYPE.PROTOCOL&&"revoke"===e.subtype;if(!e.isGroupMsg&&!r&&k["default"].get(e.to))return l["default"].reject(new G["default"]("Contact is blocked",te["default"].Contact.assertGet(e.to)));ue["default"].isBroadcast(a.to)&&(n=Q.broadcastFanout(e)),delete a.status,delete a.mimetype,delete a.height,delete a.width,delete a.recipients,delete a.chat,delete a.broadcast,delete a.ack,delete a.invis,delete a.filehash,delete a.recvFresh,delete a.mediaData,re["default"].isHttp(e.clientUrl)||delete a.clientUrl;for(var o in a)null==a[o]&&delete a[o];e.isMMS&&(a.avparams=e.isUnsentPhoneMsg()?{type:e.type}:e.avParams()),"chat"!==a.type||"url"!==a.subtype||Y["default"].supportsFeature(Y["default"].F.URL)||delete a.subtype,a.quotedMsg&&!Y["default"].supportsFeature(Y["default"].F.REPLIES_OUT)&&(delete a.quotedMsg,delete a.quotedStanzaID,delete a.quotedRemoteJid,delete a.quotedParticipant),a.mentionedJidList&&!Y["default"].supportsFeature(Y["default"].F.MENTIONS_OUT)&&delete a.mentionedJidList;var d=U["default"].get(e.id.remote);return d&&(a.conversionTuple=d.toJSON()),te["default"].Chat.find(e.id.remote).then(function(i){return i.sendSeen(),t.trigger(L["default"].NEW_MSG_SENT),l["default"].props({reply:oe["default"].msgCreateRecord(a,e.local),chat:i})}).then(function(r){var o=r.reply,d=r.chat;if(200===o.status){var u=i.remote,l=i.fromMe&&ue["default"].equals(i.remote,O["default"].me)?3:o.data?o.data.ack:1;return e.updateAck(l),e.type!==L["default"].MSG_TYPE.PROTOCOL&&(d.lastReceivedKey=i),t.updateLastReceipt(u,o.t),ue["default"].isBroadcast(u)&&(n?n.forEach(function(e){var a=new K["default"]({from:O["default"].me,to:e,id:i.id}),n=t.get(a);n&&(n.ack=1,t.updateLastReceipt(e,n.t),te["default"].Chat.find(e).then(function(e){e.lastReceivedKey=a}))}):V["default"].log("model:msg:createRecord bclist server ack, no recipients")()),"success"}if(408!==o.status){var c=a;V["default"].log("json.body: "+(0,s["default"])(c.body))(),c.body=void 0,V["default"].logVerbose("Json: "+(0,s["default"])(c))(),V["default"].assert(!1,"send-not-200","Phone responded "+o.status)()}return"dropped"})["catch"](function(e){return V["default"].error("model:msg:createRecord dropped msg: "+a.id)(a.type),V["default"].assert(!1,"send-msg-error","Got error "+String(e))(e),"dropped"})})["finally"](function(){e.promises.sendPromise&&e.promises.sendPromise.control.settled()})}},{key:"getKeysForResyncReceipts",value:function(){var e=[],t=C["default"].assign({},this.lastReceivedReceipt,this.lastReceivedPaymentTransaction);for(var i in t){var a=(0,le.createWid)(i),n=te["default"].Chat.get(a),r=void 0;if(n&&(r=n.getFirstMsgWithStatus()),r){var s=r.id;s.t=this.lastReceivedReceipt[a]||r.t||0,s.payT=this.lastReceivedPaymentTransaction[a],e.push(s)}else V["default"].error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+a.toString())()}return e}},{key:"setKeysForResyncReceipts",value:function(e){this.keysForResyncReceipts=e}},{key:"resetKeysForResyncReceipts",value:function(){this.keysForResyncReceipts=void 0}},{key:"resyncReceipts",value:function(){var e=this;V["default"].log("Msg:resyncReceipts")();var t=this.keysForResyncReceipts||this.getKeysForResyncReceipts();return 0===t.length?l["default"].resolve():oe["default"].resyncReceipts(t).then(function(t){if(Array.isArray(t)){V["default"].log("Msg:resyncReceipts success")();var i=te["default"].Chat.promises.initializeRestFromTabletCache?te["default"].Chat.promises.initializeRestFromTabletCache:l["default"].resolve();i.then(function(){t.forEach(function(t){e.updateLastReceipt(t.id,t.t),e.updateLastTransactionTime(t.id,t.payT),t.acks.forEach(function(i){if(4===i.length){var a=new K["default"]({fromMe:i[1],remote:t.id,id:i[0],participant:i[2]}),n=e.get(a);n&&n.updateAck(i[3])}else V["default"].error("Msg:resyncReceipts invalid response: "+(0,s["default"])(i))()}),t.msgs.length>0&&e.processMultipleMessages(t.id,t.msgs,{update:!0,isHistory:!1})["catch"](R.LogoutDrop,function(){})})})}else V["default"].error("Msg:resyncReceipts error",t)()})["catch"](R.LogoutDrop,R.EphemeralDrop,R.BrowserReplacedDrop,function(){})["catch"](function(e){throw V["default"].error("Msg:resyncReceipts dropped "+String(e)+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})["finally"](function(){e.resetKeysForResyncReceipts()})}},{key:"updateLastReceipt",value:function(e,t){var i=this.lastReceivedReceipt[e];t&&(!i||t>i)&&(this.lastReceivedReceipt[e]=t)}},{key:"updateLastTransactionTime",value:function(e,t){var i=this.lastReceivedPaymentTransaction[e];t&&(!i||t>i)&&(this.lastReceivedPaymentTransaction[e]=t)}},{key:"processMultipleMessages",value:function(e,t,i,a){var n=this,r=function(){return Q._processMultipleMessages.call(n,e,t,i,a)};if(e){var s=void 0,o=this.pendingAdd[e];return s=o?o.then(r):r(),s["finally"](function(){e&&n.pendingAdd[e]===s&&(n.pendingAdd[e]=null)})["catch"](function(){}),this.pendingAdd[e]=s}return r()}}]),t}(ae["default"]);pe.model=H["default"],t["default"]=new pe},'"ebejiegeih"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"cdfdhedgig"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"bebcachjfd"'),_=a(v),m=i('"cjgfdijdhj"'),y=a(m),b=i('"ddahgaaff"'),T=i('"bjgjbbhfcf"'),E=a(T),M=i('"dhjiafjcai"'),C=a(M),S=i('"bafjcjabca"'),j=a(S),k=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,v.prop)(),a.t=(0,v.prop)(),a.contact=(0,v.session)(),n=i,(0,c["default"])(a,n)}return(0,g["default"])(t,e),(0,u["default"])(t,[{key:"initialize",value:function(){(0,h["default"])(t.prototype.__proto__||(0,r["default"])(t.prototype),"initialize",this).call(this),this.addChild("contact",y["default"].gadd(this.id))}}]),t}(_["default"]);k.Collection="MsgInfoParticipant",k.Proxy="msgInfoParticipant",k.idClass=j["default"];var A=t.MsgInfoParticipant=(0,v.defineModel)(k),P=t.ParticipantCollection=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),t}(E["default"]);P.model=A,P.comparator=function(e,t){return(0,b.ContactComparator)(e.contact,t.contact)};var w=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,v.prop)(),a.isPTT=(0,v.prop)(),a.playedRemaining=(0,v.prop)(0),a.readRemaining=(0,v.prop)(0),a.deliveryRemaining=(0,v.prop)(0),a.played=(0,v.collection)(P),a.read=(0,v.collection)(P),a.delivery=(0,v.collection)(P),a.settled=(0,v.derived)(a._settled,["isPTT","playedRemaining","readRemaining"]),n=i,(0,c["default"])(a,n)}return(0,g["default"])(t,e),(0,u["default"])(t,[{key:"_settled",value:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}]),t}(_["default"]);w.Collection="MsgInfo",w.Proxy="msgInfo",w.idClass=C["default"],t["default"]=(0,v.defineModel)(w)},'"eagaccadah"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"deijabejja"'),_=a(v),m=i('"cehbbagije"'),y=a(m),b=i('"ebejiegeih"'),T=a(b),E=i('"dhjiafjcai"'),M=a(E),C=i('"dafgbfehgf"'),S=a(C),j=i('"ebhdebaagj"'),k=a(j),A=i('"bdcdfifjcj"'),P=a(A),w=i('"dgfhfgbdeb"'),O=a(w),I=i('"bafjcjabca"'),L=a(I),N=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"_initializeStaleCollection",value:function(){var e=this;this.listenTo(S["default"],"change:stream",function(){S["default"].stream===C.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})}},{key:"_find",value:function(e){var t=k["default"].Msg.get(e);return t?t.isSentByMe?O["default"].queryMsgInfo(t.id).then(function(e){return e.status>=400?(y["default"].log("model:MsgInfo:findQuery error "+e.status)(),r["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===_["default"].MSG_TYPE.PTT,r["default"].resolve(e))}):r["default"].reject("message not sent by me"):r["default"].reject("No message found for id: "+e)}},{key:"updateInfo",value:function(e,t,i,a,n,r){var s=new M["default"]({from:t,to:i,id:e,participant:n}),o=new M["default"]({from:t,to:i,id:e}),d=this.get(s)||this.get(o);if(d){var u=L["default"].isUser(o.remote);if(!u){if(2!==a){var l=d.delivery.get(n);l&&d.delivery.remove(l)}if(3!==a){var c=d.read.get(n);c&&d.read.remove(c)}if(4!==a){var f=d.played.get(n);f&&d.played.remove(f)}}4===a?(d.played.get(n)||(d.playedRemaining-=1),d.played.add({id:n,t:r})):3===a?(d.delivery.get(n)||(d.readRemaining-=1),d.read.add({id:n,t:r})):2===a&&(d.delivery.get(n)||(d.deliveryRemaining-=1),d.delivery.add({id:n,t:r}))}}},{key:"handle",value:function(e){var t=this,i=e.shift();switch(i.cmd){case"ack":this.updateInfo(i.id,i.from,i.to,i.ack,i.participant,i.t);break;case"acks":i.id.forEach(function(e){t.updateInfo(e,i.from,i.to,i.ack,i.participant,i.t)})}}}]),t}(P["default"]);N.model=T["default"],N.staleCollection=!0,t["default"]=new N},'"jgccihjdj"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){return z[e]||!1}function s(e){if(!e)return null;var t=new D["default"]({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});return e.id=t,new B["default"].Msg.constructor.model(e)}function o(e,t){if(!e)return e;var i=t.get(e.id);return i&&!i.isRevoked?i:e}function d(e,t,i,a){var n=[],s=[],o=[];t.forEach(function(t,d){t.id instanceof D["default"]||(N["default"].error("Store.Msg:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),C.upload("forgot-to-create-msgkey"),t.id=new D["default"]({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,K.isString)(e)&&W["default"].isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var u=B["default"].Msg.get(t.id);if(t.type===A["default"].MSG_TYPE.PROTOCOL)switch(t.subtype){case"revoke":if(u=B["default"].Msg.get(t.protocolMessageKey)){var c=new B["default"].Msg.constructor.model(t);W["default"].equals(u.sender,c.sender)?(W["default"].isStatusV3(e)&&u.msgChunk.remove(u),u.revoke(c.id),W["default"].isStatusV3(e)&&B["default"].StatusV3.find(u.sender).then(function(e){w["default"].supportsFeature(w["default"].F.QUERY_STATUS_V_3_THUMBNAIL)&&u&&u.msgChunk.length!==e.totalCount&&q["default"].statusQueryThumbnail(e.id)})):N["default"].warn("model:Msg:processMM revoke sender mismatch "+c.id.toString()+", "+u.id.toString())()}break;default:N["default"].info("unknown protocolMessage "+t.id.toString())(t)}else if(u&&!u.isRevoked){t.ack<u.ack&&delete t.ack;for(var h in t)t.hasOwnProperty(h)&&"undefined"==typeof t[h]&&delete t[h];t.id.fromMe&&!u.clientUrl&&t.clientUrl&&(t.phoneUploading=!1),i.isHistory&&(t.isNewMsg=!1);var p=["t","id","from","to"],g=u.t?E["default"].omit(t,p):t,v=u.applyUpdate(g)["return"](u);if(o.push(v),W["default"].isBroadcast(u.id.remote)){var _=l(u);_&&_.forEach(function(e){var t=B["default"].Msg.get(e);t&&o.push(t.applyUpdate(g)["return"](u))})}i.isHistory&&(u.recvFresh||a)&&!u.search?(N["default"].warn("model:Msg:handle:processMM:"+(u.recvFresh?"dup:":"overlap:")+String(u.id))(),s.push(u)):i.isHistory&&u.search?(u.search=!1,N["default"].warn("model:Msg:handle:processMM load search as history "+String(u.id))(),n.push({id:u.id})):"search"===i.add&&n.push({id:u.id}),f(u)}else r(t.type)&&!t.clientUrl&&(t.phoneUploading=t.id.fromMe&&0===t.ack),"search"===i.add&&(t.search=!0),i.update||n.push(t)});var d=o.length?b["default"].all(o):b["default"].resolve();return d.then(function(){if(0===n.length&&0===s.length){if(e&&i.pendingMsgsDone){var r=B["default"].Chat.get(e);r&&(r.pendingMsgs=!1)}return t.map(function(e){return B["default"].Msg.get(e.id)}).filter(function(e){return e})}var o=B["default"].Msg.add(n,{merge:!0}),d=b["default"].map(o,function(e){return f(e),e.waitForPrep()["catch"](function(e){N["default"].assert(!1,"bad-msg-prep",""+String(e))(e)})});if(e){var u=void 0;if(W["default"].isStatusV3(e)){var l=t[0],h=l.id.fromMe?j["default"].me:l.author;u=B["default"].StatusV3.find(h)}else u=B["default"].Chat.find(e);return d["return"](u).then(function(n){var r=void 0,d=void 0,u="after"===i.add||"last"===i.add,l=!i.isHistory,f=!1;if("unread"===i.add?(r=a,n.msgChunks.push(r),d=i.firstUnreadKey):"last"===i.add&&i.resume?(r=a,f=!0):r="function"==typeof a?a():a,p(t,o,s,n,u,r||n.msgs,d,f),i.pendingMsgsDone&&(n.pendingMsgs=!1),l&&W["default"].isBroadcast(e)&&!W["default"].isStatusV3(e)&&o.forEach(function(e){e&&e.recvFresh&&!e.isNotification&&c(e)}),w["default"].supportsFeature(w["default"].F.RECENT_EMOJI_SYNC))for(var h=0;h<o.length;h++){var g=o[h];if(g&&g.isNewMsg&&g.isSentByMe&&g.containsEmoji){F["default"].throttledSync();break}}if(w["default"].supportsFeature(w["default"].F.RECENT_STICKERS)){var v=o.some(function(e){return e&&e.isNewMsg&&e.isNewMsg&&e.type===A["default"].MSG_TYPE.STICKER});v&&x["default"].throttledSync()}return t.map(function(e){return B["default"].Msg.get(e.id)}).filter(function(e){return e})})}return d["return"](t.map(function(e){return B["default"].Msg.get(e.id)}).filter(function(e){return e&&!!e.chat}))})}function u(e,t,i,a,n){var r={},s={},o=void 0,d=void 0,u=void 0,l=i.length,c=n;if(0===l)return{msgs:t,collection:c};for(o=0;o<l;o++)d=i[o],s[d.id]=d;for(l=t.length,o=0;o<l;o++)d=t[o],d&&(r[d.id]=d);var f=[];for(l=e.length,o=0;o<l;o++)if(d=e[o],d&&(u=r[d.id],u&&f.push(u),u=s[d.id]))if(u.recvFresh)f.push(u),a.removeMsg(u),u.unset("recvFresh");else{var h=a.getAllCMCs(),p=E["default"].find(h,function(e){return e.get(u.id)});n&&p===n||(p?(p.forEach(function(e){f.push(e),delete s[e.id.toString()]}),p===a.msgs?(a.replaceMsgsCollection(n),c=a.msgs):(a.notifyMsgCollectionMerge(n,p,n),a.removeMsgsCollection(p))):(N["default"].error("models:Msg:reorder trying to merge CMC of orphaned message "+d.id,d)(),f.push(s[d.id])))}return{msgs:f,collection:c}}function l(e){var t=void 0,i=void 0,a=void 0;if(e instanceof B["default"].Msg.constructor.model)i=e,a=e.id;else{if(!(e instanceof D["default"]))return void N["default"].error("model:msgs:broadcastFanout: unknown msgOrKey: "+String(e))(e);a=e}if(!W["default"].isStatusV3(a.remote)){if(i&&i.recipients&&0!==i.recipients.length)t=i.recipients;else{var n=B["default"].GroupMetadata.get(a.remote);n?t=E["default"].map(g(n.participants),"id"):N["default"].log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+a.remote.toString())()}return t?t.map(function(e){return new D["default"]({fromMe:a.fromMe,remote:e,id:a.id})}):void 0}}function c(e){var t=void 0;if(!e.invis){var i=l(e);i&&(t=i.map(function(e){return e.remote}),i.forEach(function(t){if(!B["default"].Msg.some(E["default"].matches({id:t}))){var i=g(e);i.to=t.remote,i.id=t,i.broadcast=!0;var a=B["default"].Msg.add(i,{merge:!0});B["default"].Chat.find(t.remote).then(function(e){h(a,e,!0)})}}))}return t}function f(e){if(!w["default"].supportsFeature(w["default"].F.CONTACT_HAS_PUSHNAME)&&e.notifyName){var t=B["default"].Contact.get(e.sender);t&&!t.isMe&&(!t._notifyName||t._notifyName.t<e.t)&&(t._notifyName={name:e.notifyName,t:e.t},t.trigger("change:_notifyName",e.notifyName))}}function h(e,t,a,n,r,s){var o=n||t.msgs;if(0!==e.length){var d=o===t.msgs;if(s)if(d){N["default"].info("models:msg:store:resetMostRecentMsgs .msgs === cmc !")();var u=E["default"].findLast(e,function(e){return!!e});u&&(t.lastReceivedKey=u.id,o.add(e))}else{d=!0;var l=E["default"].findLast(e,function(e){return!!e});l&&(t.lastReceivedKey=l.id,o.add(e));var c=i('"bhchacaadd"')["default"],f=new c;f.replace(t.msgs),t.msgChunks.push(f),t.replaceMsgsCollection(o),t.msgs.trigger("change:last",t.msgs.last())}else if(a){if(d){var h=E["default"].findLast(e,function(e){return!!e});h&&(t.lastReceivedKey=h.id)}o.add(e)}else o.add(e,{at:0,silent:E["default"].every(e,v)});if(a&&d||!B["default"].Msg.lastReceivedReceipt[t.id])for(var p=e.length,g=p-1;g>=0;g--){var _=e[g],m=_.id;if(m.fromMe&&!_.isNotification){B["default"].Msg.updateLastReceipt(m.remote,_.t);break}}if(a&&d||!B["default"].Msg.lastReceivedPaymentTransaction[t.id])for(var y=e.length,b=y-1;b>=0;b--){var T=e[b],M=T.id;T.paymentTransactionTimestamp&&B["default"].Msg.updateLastTransactionTime(M.remote,T.paymentTransactionTimestamp)}var C=r;C&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=E["default"].find(e,function(e){return e.id.toString()===C.toString()}))}}function p(e,t,i,a,n,r,s,o){var d=u(e,t,i,a,r);h(d.msgs,a,n,d.collection,s,o)}function g(e){return null!=e&&"object"==typeof e?JSON.parse((0,m["default"])(e),I["default"]):e}function v(e){return"i"===e.eventType}Object.defineProperty(t,"__esModule",{value:!0});var _=i('"bgjiajcadc"'),m=n(_),y=i('"cdehffajbd"'),b=n(y);t.typeIsMMS=r,t.createQuotedMsg=s,t.getOriginalQuotedMsgIfPossible=o,t._processMultipleMessages=d,t.getBroadcastFanoutKeys=l,t.broadcastFanout=c;var T=i('"bgafgbafci"'),E=n(T),M=i('"gidjgebhh"'),C=a(M),S=i('"jfefjijii"'),j=n(S),k=i('"deijabejja"'),A=n(k),P=i('"djdcdaecea"'),w=n(P),O=i('"bceagiahaa"'),I=n(O),L=i('"cehbbagije"'),N=n(L),R=i('"dhjiafjcai"'),D=n(R),G=i('"dajfehefaj"'),F=n(G),U=i('"debfbgiegd"'),x=n(U),Y=i('"ebhdebaagj"'),B=n(Y),V=i('"dgfhfgbdeb"'),q=n(V),H=i('"bafjcjabca"'),W=n(H),K=i('"fccadfdfc"'),z={image:!0,video:!0,audio:!0,ptt:!0,sticker:!0,document:!0,product:!0}},'"cbdgihidid"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GLOBAL_MUTE=void 0;var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgaddigcjb"'),b=n(y),T=i('"cehbbagije"'),E=n(T),M=i('"bafjcjabca"'),C=n(M),S=i('"bebcachjfd"'),j=n(S),k=i('"dgfhfgbdeb"'),A=n(k),P=i('"fhabbhhjc"'),w=n(P),O=i('"biafgdghfb"'),I=a(O),L=i('"cbgefcdega"'),N=n(L),R=i('"ciehgcaebf"'),D=i('"chaadbdedf"'),G=n(D),F=i('"fccadfdfc"'),U=-1,x="global_mute",Y=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,S.prop)(),a.expiration=(0,S.prop)(0),a._unmuteTimer=(0,S.session)(),a.promises=(0,S.session)(function(){return{}}),a.isMuted=(0,S.derived)(a._isMuted,["expiration"]),n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"_isMuted",value:function(){return!!this.expiration}},{key:"initialize",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"initialize",this).call(this),this.expiration&&this.mute(this.expiration)}},{key:"setMute",value:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}},{key:"mute",value:function i(e,t,a){var n=this;if(!(0,F.isNumber)(e))return E["default"].log("models:Mute:mute called with invalid expiration "+e)(),s["default"].reject(new I.ActionError);e=Math.round(e),e>2e9&&E["default"].log("models:Mute:mute called with wrong units?"+this.id.toString()+" exp:"+e)();var i=function(){if(this.isMuted&&this._clearUnmuteTimer(),e===U)E["default"].log("models:Mute:mute "+this.id.toString()+" muted, no expiration")();else{var t=e-(0,G["default"])().unix();E["default"].log("models:Mute:mute "+this.id.toString()+" duration:"+t)(),this._unmuteTimer=N["default"].setGlobalTimeout(this.unmute.bind(this),1e3*e)}this.set({expiration:e})}.bind(this),r=C["default"].isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;var o=this.promises.mute=A["default"].sendConversationMute(this.id,e,this.expiration),d=r?new R.ActionType(l10n.t("action_group_muting")):new R.ActionType(l10n.t("action_chat_muting"));a=a||(0,R.genId)();var u=this.promises.mute["catch"](function(i){E["default"].error("models:Mute:mute dropped")(i);var s=r?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new R.ActionType(s,l10n.t("action_try_again"),n.mute.bind(n,e,t,a))}).then(function(e){if(200===e.status){var i=r?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new R.ActionType(i,l10n.t("action_undo"),n.unmute.bind(n,t,a))}if(e.status>=400)throw r?new R.ActionType(l10n.t("action_group_mute_failed")):new R.ActionType(l10n.t("action_chat_mute_failed"))});return w["default"].openToast(b["default"].createElement(R.ActionToast,{id:a,initialAction:d,pendingAction:u})),o.then(function(e){200!==e.status||e._duplicate||i()})["finally"](function(){n.promises.mute=null})}return i(),s["default"].resolve()}},{key:"canMute",value:function(){return C["default"].isGroup(this.id)||C["default"].isUser(this.id)}},{key:"_clearUnmuteTimer",value:function(){N["default"].clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}},{key:"unmute",value:function a(e,t){var i=this,a=function(){E["default"].log("models:Mute:unmute "+this.id.toString())(),this._clearUnmuteTimer()}.bind(this),n=C["default"].isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;var r=this.promises.unmute=A["default"].sendConversationMute(this.id,!1,this.expiration),o=n?new R.ActionType(l10n.t("action_group_unmuting")):new R.ActionType(l10n.t("action_chat_unmuting"));t=t||(0,R.genId)();var d=this.promises.unmute["catch"](function(a){E["default"].error("models:Mute:unmute dropped")(a);var r=n?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return s["default"].reject(new R.ActionType(r,l10n.t("action_try_again"),i.unmute.bind(i,e,t)))}).then(function(e){if(200===e.status)return n?new R.ActionType(l10n.t("action_group_unmuted")):new R.ActionType(l10n.t("action_chat_unmuted"));if(e.status>=400)throw n?new R.ActionType(l10n.t("action_group_unmute_failed")):new R.ActionType(l10n.t("action_chat_unmute_failed"))});return w["default"].openToast(b["default"].createElement(R.ActionToast,{id:t,initialAction:o,pendingAction:d})),r.then(function(e){200!==e.status||e._duplicate||a()})["finally"](function(){i.promises.unmute=null})}return a(),s["default"].resolve()}},{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this._clearUnmuteTimer()}}]),t}(j["default"]);Y.Collection="Mute",Y.Proxy="mute",Y.idClass=C["default"],Y.idWhitelist=[x],t.GLOBAL_MUTE=x,t["default"]=(0,S.defineModel)(Y)},'"ecdjibbjgf"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bdcdfifjcj"'),g=a(p),v=i('"jfefjijii"'),_=a(v),m=i('"cehbbagije"'),y=a(m),b=i('"ebhdebaagj"'),T=a(b),E=i('"cbdgihidid"'),M=a(E),C=i('"hcddbeaic"'),S=a(C),j=!0,k=!0,A=!0,P=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"initializeFromCache",value:function(e){this.add(e),this.setGlobalNotifications(S["default"].getGlobalNotifications()),this.setGlobalSounds(S["default"].getGlobalSounds()),this.setGlobalPreviews(S["default"].getGlobalPreviews())}},{key:"saveToCache",value:function(){if(_["default"].me){var e=this.constructor.cachePolicy.id;y["default"].log("models:mute:cache-save: "+String(e))(),S["default"].setCollection(e,[this.globalMute().toJSON()])}}},{key:"globalMute",value:function(){var e=this.get(E.GLOBAL_MUTE);return e?e:this.add({id:E.GLOBAL_MUTE})[0]}},{key:"getGlobalSounds",value:function(){return j;
}},{key:"setGlobalSounds",value:function(e){j=e,S["default"].setGlobalSounds(e)}},{key:"getGlobalNotifications",value:function(){return k}},{key:"setGlobalNotifications",value:function(e){k=e,S["default"].setGlobalNotifications(e)}},{key:"getGlobalPreviews",value:function(){return A}},{key:"setGlobalPreviews",value:function(e){A=e,S["default"].setGlobalPreviews(e)}},{key:"handle",value:function(e){e.forEach(function(e){var t=T["default"].Chat.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)})}}]),t}(g["default"]);P.model=M["default"],P.cachePolicy={id:"mute",policy:p.CACHE_POLICY.LOAD,delay:1e3},t["default"]=new P},'"djeicifafd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Chatstate=void 0;var n=i('"cfcbddfj"'),r=a(n),s=i('"cdfdhedgig"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"jidadafab"'),_=a(v),m=i('"bgafgbafci"'),y=a(m),b=i('"bebcachjfd"'),T=a(b),E=i('"cjgfdijdhj"'),M=a(E),C=i('"bdcdfifjcj"'),S=a(C),j=i('"deijabejja"'),k=a(j),A=i('"bafjcjabca"'),P=a(A),w=1500,O=2e3,I=function(e){function t(){var e,i,a,n;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,b.prop)(),a.type=(0,b.prop)(),a.t=(0,b.prop)(),a.deny=(0,b.prop)(),a.updateTime=(0,b.session)(),a._expireTimerId=(0,b.session)(),n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),t}(T["default"]);I.Proxy="chatstate",I.idClass=P["default"];var L=(0,b.defineModel)(I),N=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,u["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),t}(S["default"]);N.model=L;var R=function(e){function t(){var e,i,a,n;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,b.prop)(),a.isOnline=(0,b.session)(!1),a.stale=(0,b.session)(!0),a.hasData=(0,b.session)(!1),a.isSubscribed=(0,b.session)(!1),a.withholdDisplay=(0,b.session)(!0),a.forceDisplay=(0,b.session)(!1),a.chatActive=(0,b.session)(!1),a.withholdDisplayTimer=(0,b.session)(),a.forceDisplayTimer=(0,b.session)(),a.chatstate=(0,b.session)(),a.chatstates=(0,b.collection)(N),a.isGroup=(0,b.derived)(a._isGroup),a.isUser=(0,b.derived)(a._isUser),n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),(0,r["default"])(t,[{key:"_isGroup",value:function(){return P["default"].isGroup(this.id)}},{key:"_isUser",value:function(){return P["default"].isUser(this.id)}},{key:"initialize",value:function(){var e=this;(0,o["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"initialize",this).call(this);var i=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new L(i)),this.isGroup?this.listenTo(this.chatstates,"add change",y["default"].debounce(function(){var t=void 0,i=!1;e.chatstates.forEach(function(e){"composing"!==e.type&&"recording"!==e.type||t&&!(t.updateTime<e.updateTime)||(t=e),i=i||"unavailable"!==e.type}),e.set({isOnline:i}),e.chatstate.set({id:t?t.id:"",type:t?t.type:"unavailable"})})):this.listenTo(this.chatstate,"change:type",function(){e.isOnline="unavailable"!==e.chatstate.type}),this.listenTo(this,"change:chatActive",this.onChatActiveChange)}},{key:"delete",value:function(){(0,o["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){return e["delete"]()})}},{key:"handle",value:function(e){var t=!1;"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(t=!0,e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var i=void 0;if(this.isGroup){if(!e.participant)return;e.id=e.participant,e.participant=void 0,i=this.chatstates.gadd(e.id)}else i=this.chatstate;t&&"composing"!==i.type&&"recording"!==i.type||i.set(e),i._expireTimerId&&clearTimeout(i._expireTimerId),"composing"===i.type||"recording"===i.type?i._expireTimerId=y["default"].delay(this._expireComposing,k["default"].PRESENCE_COMPOSING_TIMEOUT,i):i._expireTimerId=void 0;var a=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:a})}},{key:"_expireComposing",value:function(e){var t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}},{key:"reset",value:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}},{key:"isActive",value:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}},{key:"getFormattedString",value:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=M["default"].get(e);if(!t)return null;var i=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:i}):l10n.t("web_conversation_name_is_recording",{participant:i})}if(!this.isUser)return null;var a=this.chatstate;switch(a.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return a.deny||!a.t?null:_["default"].lastSeenStr(a.t)}}},{key:"onChatActiveChange",value:function(){var e=this,t=this.chatActive;t?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=y["default"].delay(function(){e.set({withholdDisplay:!1,withholdDisplayTimer:void 0})},w),this.forceDisplayTimer=y["default"].delay(function(){e.set({forceDisplay:!0,forceDisplayTimer:void 0})},O)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0))}},{key:"subscribe",value:function(){return this.find()}}]),t}(T["default"]);R.Collection="Presence",R.Proxy="presence",R.idClass=P["default"],t["default"]=(0,b.defineModel)(R),t.Chatstate=L},'"bfhdcihhcd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"djecddgbji"'),r=a(n),s=i('"cdehffajbd"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"cfcbddfj"'),h=a(f),p=i('"dfhdhdbidh"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"jfefjijii"'),y=a(m),b=i('"djeicifafd"'),T=a(b),E=i('"bdcdfifjcj"'),M=a(E),C=i('"bafjcjabca"'),S=a(C),j=i('"dgfhfgbdeb"'),k=a(j),A=function(e){function t(){return(0,c["default"])(this,t),(0,g["default"])(this,(t.__proto__||(0,u["default"])(t)).apply(this,arguments))}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"_find",value:function(e){var t=this.gadd(e);return!t.isUser||S["default"].isServer(e)||S["default"].isPSA(e)?o["default"].resolve({id:e}):k["default"].subscribePresence(e).then(function(){return{id:e}})}},{key:"handle",value:function(e){var t=(0,r["default"])(e,1),i=t[0];if(!y["default"].me.equals(i.id)){var a=this.get(i.id);a&&("unsubscribe"===i.type?a.set({isSubscribed:!1,stale:!0}):(a.handle(i),a.stale=!1))}}},{key:"clearAllPresence",value:function(){this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}},{key:"onResume",value:function(){this.filter(function(e){return e.hasObservers()}).map(function(e){return e.subscribe()})}}]),t}(M["default"]);A.model=T["default"],A.staleCollection=!0,t["default"]=new A},'"bficighfdd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.FALLBACK=void 0;var n=i('"cjcbjjhead"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"jfefjijii"'),_=a(v),m=i('"bebcachjfd"'),y=a(m),b=i('"bhcejhfhjg"'),T=a(b),E=i('"bafjcjabca"'),M=a(E),C=i('"deijabejja"'),S=a(C),j=i('"bhbgbeibga"'),k=a(j),A=t.FALLBACK={SINGLE:"SINGLE",GROUP:"GROUP"},P=function(e){function t(){var e,i,a,n;(0,u["default"])(this,t);for(var r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,m.prop)(),a.tag=(0,m.prop)(),a.raw=(0,m.prop)(),a.eurl=(0,m.prop)(),a.stale=(0,m.session)(!0),a.eurlStale=(0,m.session)(!1),a.pendingPic=(0,m.session)(),a.img=(0,m.derived)(a._img,["tag","raw","stale","eurl","eurlStale"]),a.imgFull=(0,m.derived)(a._imgFull,["tag","raw","stale","eurl","eurlStale"]),a.fallbackType=(0,m.derived)(a._fallbackType,["id"]),n=i,(0,h["default"])(a,n)}return(0,g["default"])(t,e),(0,c["default"])(t,[{key:"_img",value:function(){if(this.raw)return"data:image/jpeg;base64,"+this.raw;if(!this.tag&&this.stale)return null;if(this.tag)return this.generateUrl("s")}},{key:"_imgFull",value:function(){if((this.raw||!this.tag)&&this.stale)return null;if(!this.raw&&this.tag)return this.generateUrl("l")}},{key:"_fallbackType",value:function(){return M["default"].isUser(this.id)?A.SINGLE:M["default"].isGroup(this.id)?A.GROUP:A.GROUP}},{key:"markStale",value:function(e){this.stale=!0,e&&e.eurl&&(this.eurlStale=!0)}},{key:"validate",value:function(){(this.stale||this.eurlStale)&&this.update()}},{key:"generateUrl",value:function(e){var t={t:e,u:this.id.toString(),i:this.tag||""};return k["default"].alive&&this.eurl&&!this.eurlStale&&(t=(0,r["default"])({e:this.eurl},t)),T["default"].build(S["default"].PP_URL,t)}},{key:"canSet",value:function(){return!!M["default"].isGroup(this.id)||!!this.id.equals(_["default"].me)}},{key:"canDelete",value:function(){return!(!M["default"].isGroup(this.id)||!this.tag)||!(!this.id.equals(_["default"].me)||!this.tag)}}]),t}(y["default"]);P.Collection="ProfilePicThumb",P.Proxy="profilePicThumb",P.idClass=M["default"],t["default"]=(0,m.defineModel)(P)},'"dhcbeegjcf"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgafgbafci"'),b=n(y),T=i('"ebhdebaagj"'),E=n(T),M=i('"jfefjijii"'),C=n(M),S=i('"cehbbagije"'),j=n(S),k=i('"bficighfdd"'),A=n(k),P=i('"hcddbeaic"'),w=n(P),O=i('"dgfhfgbdeb"'),I=n(O),L=i('"biafgdghfb"'),N=a(L),R=i('"bafjcjabca"'),D=n(R),G=i('"gggdaifb"'),F=i('"cgdjeaccg"'),U=n(F),x=i('"bdcdfifjcj"'),Y=n(x),B=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"get",value:function(e){var i=(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"get",this).call(this,e);if(!this._model.prototype.isIdType(e))return i;var a=(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"get",this).call(this,(0,U["default"])(e.toString()));if(a){if(this.remove(a,{silent:!0}),i&&i.tag)return i;var n=a.toJSON();return n.id=e,this.add(n,{silent:!0,merge:!0})[0]}return i?i:void 0}},{key:"saveToCache",value:function(){if(C["default"].me){var e=t.cachePolicy.id,i=this.filter(function(e){return D["default"].isWid(e.id)&&!!e.eurl});i=i.map(function(e){return e=e.toJSON(),e.id=(0,U["default"])(e.id.toString()),e}),j["default"].log("models:profilePic:cache-save: "+String(e))(),w["default"].setCollection(e,i)}}},{key:"initializeFromCache",value:function(e){if(this.length&&e){var t=this.reduce(function(e,t){return e[(0,U["default"])(t.id.toString())]=t.id.toString(),e},new Object);if(!b["default"].isEmpty(t)){var i=e.reduce(function(e,i){return t[i.id]&&(i.id=(0,G.createWid)(t[i.id]),i.stale=!0,e.push(i)),e},[]);this.add(i,{merge:!0})}}}},{key:"onResume",value:function(){var e=this.filter(function(e){var t=E["default"].Chat.get(e.id);return e.hasObservers()&&e.stale&&(D["default"].isUser(e.id)||D["default"].isGroup(e.id))&&!(t&&t.isReadOnly)}).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)}},{key:"_find",value:function(e){var t=E["default"].Chat.get(e);return t&&t.isReadOnly?I["default"].profilePicFindThumbFromPhone(e,this.get(e)).then(function(e){return e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e})["catch"](N.ProtoVersionUndefined,function(){return{id:e,stale:!0}}):D["default"].isUser(e)||D["default"].isGroup(e)?I["default"].profilePicFind(e).then(function(t){var i={id:e};if(null!==t.status&&void 0!==t.status)switch(t.status){case 401:i.tag="",i.raw=void 0;break;case 423:i.stale=!0;break;case 429:i.stale=!0;break;default:i.tag=null,i.eurl=null,i.eurlStale=!1}else i.tag=t.tag,i.raw=null,i.eurl=t.eurl,i.eurlStale=!1;return i})["catch"](N.WapDrop,function(){return{id:e,stale:!0}}):s["default"].resolve({id:e,tag:null})}},{key:"imageChanged",value:function(e,t){var i=this.get(e);i&&("remove"===t?i.set({tag:void 0,eurl:void 0}):i.tag!==t&&i.update()["catch"](N.WapDrop,function(){}))}},{key:"resyncPictures",value:function(e){var t=this;return 0===e.length?s["default"].resolve():I["default"].resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(i){if(423===i.status||429===i.status)j["default"].warn("ProfilePicThumbStore:resyncPictures blocked "+i.status)();else{if("number"==typeof i.status&&i.status>=400)throw j["default"].error("ProfilePicThumbStore:resyncPictures error "+i.status)(i),new Error("ProfilePicThumbStore:resyncPictures error");if(!Array.isArray(i))throw j["default"].error("ProfilePicThumbStore:resyncPictures unknown reply",i)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");j["default"].log("ProfilePicThumbStore:resyncPictures success")(),i.forEach(function(e){var i=t.get(e.id);i&&i.set({tag:e.tag,raw:void 0,stale:!1,eurl:e.eurl,eurlStale:!1})}),e.forEach(function(e){e.eurlStale&&e.update()}),e.forEach(function(e){e.stale=!1})}})["catch"](N.WapDrop,function(){})["catch"](function(e){j["default"].error("ProfilePicThumbStore:resyncPictures dropped: "+String(e))()})}}]),t}(Y["default"]);B.model=A["default"],B.staleCollection=!0,B.resumeOnAvailable=!0,B.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:x.CACHE_POLICY.LOAD,delay:5e3},t["default"]=new B},'"dahhjdbhhb"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bebcachjfd"'),g=a(p),v=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,p.prop)(),a.shortcut=(0,p.prop)(),a.message=(0,p.prop)(),a.count=(0,p.prop)(),a.keywords=(0,p.prop)(),a.pendingCount=(0,p.session)(0),a.totalCount=(0,p.derived)(a._totalCount,["count","pendingCount"]),n=i,(0,c["default"])(a,n)}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"_totalCount",value:function(){return this.count+this.pendingCount}},{key:"useOnce",value:function(){this.pendingCount+=1,this.getCollection().periodicFlush()}}]),t}(g["default"]);v.Collection="QuickReply",v.Proxy="quickReply",t["default"]=(0,p.defineModel)(v)},'"cgedjbeaff"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"ddcedhgjff"'),s=n(r),o=i('"ebfebbhae"'),d=n(o),u=i('"cfcbddfj"'),l=n(u),c=i('"dfhdhdbidh"'),f=n(c),h=i('"cdfdhedgig"'),p=n(h),g=i('"bejijbfaij"'),v=n(g),_=i('"biafgdghfb"'),m=a(_),y=i('"djdcdaecea"'),b=n(y),T=i('"dahhjdbhhb"'),E=n(T),M=i('"cjgcdjhhia"'),C=n(M),S=i('"bdcdfifjcj"'),j=n(S),k=i('"dgfhfgbdeb"'),A=n(k),P=function(e){function t(){var e,i,a,n;(0,d["default"])(this,t);for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a=(0,f["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(o))),a.checksum=void 0,a.flushCountsTimer=new C["default"](function(){a.hasPendingCounts()&&a.flushCounts()}),a.sortQuickReply=function(e,t){return e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1},a.onCountsFlushed=function(e){var t=e.id,i=e.count,n=a.get(t);n&&(n.count=i,n.pendingCount=0)},n=i,(0,f["default"])(a,n)}return(0,v["default"])(t,e),(0,l["default"])(t,[{key:"delete",value:function(){(0,p["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"filterShortcuts",value:function(e){var t=this.filter(function(t){var i=t.shortcut;return i.toLowerCase().startsWith(e.toLowerCase())});return t.sort(this.sortQuickReply)}},{key:"sync",value:function(e){b["default"].supportsFeature(b["default"].F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}))}},{key:"periodicFlush",value:function(){b["default"].supportsFeature(b["default"].F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}},{key:"updateChecksum",value:function(e){this.checksum=e}},{key:"synced",value:function(){return void 0!==this.checksum}},{key:"hasPendingCounts",value:function(){return this.some(function(e){var t=e.pendingCount;return t>0})}},{key:"getAllPendingCounts",value:function(){var e={};return this.forEach(function(t){var i=t.id,a=t.pendingCount;a>0&&(e[i]=a)}),e}},{key:"flushCounts",value:function(){var e=this,t=this.getAllPendingCounts();A["default"].flushQuickReplyCounts(t).then(function(i){i.checksum&&e.updateChecksum(i.checksum),i.data.filter(function(e){var i=e.id;return void 0!==t[i]}).forEach(e.onCountsFlushed)})["catch"](m.WapDrop,function(){})}},{key:"_findQuery",value:function(){var e=this,t=this.getAllPendingCounts();return A["default"].queryQuickReplies(t).then(function(i){return i.checksum&&e.updateChecksum(i.checksum),i.data.filter(function(e){var i=e.id;return void 0!==t[i]}).forEach(e.onCountsFlushed),i.data})}},{key:"handle",value:function(e){e.checksum&&this.updateChecksum(e.checksum);var t=[],i=[];e.quickReplies.forEach(function(e){"delete"===e.type?t.push(e):i.push(e)}),this.remove(t.map(function(e){var t=e.id;return t})),this.add(i,{merge:!0})}}]),t}(j["default"]);P.model=E["default"],t["default"]=new P},'"cfcdejcgjd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.weight=(0,f.prop)(),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);p.Proxy="recentEmoji",t["default"]=(0,f.defineModel)(p)},'"dajfehefaj"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"cdfdhedgig"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"cjjgiaccfb"'),y=a(m),b=i('"djdcdaecea"'),T=a(b),E=i('"cehbbagije"'),M=a(E),C=i('"cfcdejcgjd"'),S=a(C),j=i('"bdcdfifjcj"'),k=i('"daefjfgdad"'),A=a(k),P=i('"dgfhfgbdeb"'),w=a(P),O=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"_findQuery",value:function(){return T["default"].supportsFeature(T["default"].F.RECENT_EMOJI_SYNC)?w["default"].recentEmojiQuery(this.dirty?this.toArray():void 0).then(function(e){return Array.isArray(e)?(e.forEach(function(e){e.id=y["default"].normalizeEmoji(e.id)}),r["default"].resolve(e)):(M["default"].error("models:recentEmoji:findQuery error",e)(),r["default"].reject("recent emoji fetch error"))}):r["default"].reject("gk recent emoji sync unsupported")}},{key:"throttledSync",value:function(){T["default"].supportsFeature(T["default"].F.RECENT_EMOJI_SYNC)&&(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"throttledSync",this).call(this)}},{key:"increment",value:function(e){var i=y["default"].skinToneEmojis[e]||e;this.get(i)||this.add({id:i,weight:0}),(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"_updateWeights",this).call(this,i)}}]),t}(A["default"]);O.model=S["default"],O.cachePolicy={id:"recent_emoji_collection",policy:j.CACHE_POLICY.LOAD,delay:2e3},O.modelName="RecentEmoji",t["default"]=new O},'"bjhdjifgah"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){if("number"==typeof e&&e>0)return e-1}function r(e){if("number"==typeof e&&e>0)return 1024*e*1024}function s(e){if("number"==typeof e&&e>0)return 1024*e}function o(e){if("number"==typeof e&&e>0)return e}function d(e){if("number"==typeof e)return!!e}Object.defineProperty(t,"__esModule",{value:!0});var u=i('"djecddgbji"'),l=a(u),c=i('"bdcjejedfg"'),f=a(c),h=i('"ddcedhgjff"'),p=a(h),g=i('"ebfebbhae"'),v=a(g),_=i('"cfcbddfj"'),m=a(_),y=i('"dfhdhdbidh"'),b=a(y),T=i('"cdfdhedgig"'),E=a(T),M=i('"bejijbfaij"'),C=a(M),S=i('"bgafgbafci"'),j=a(S),k=i('"bebcachjfd"'),A=a(k),P=i('"gffbjhcc"'),w=i('"ebidhbbbbg"'),O=i('"deijabejja"'),I=a(O),L=i('"dacbaddbce"'),N=a(L),R=i('"hcddbeaic"'),D=a(R),G=i('"dgfhfgbdeb"'),F=a(G),U=i('"djdcdaecea"'),x=a(U),Y={imageMaxKBytes:s,maxParticipants:n,media:r,maxFileSize:r,groupDescLength:o,restrictGroups:d,announceGroups:d,groupsV3:d,suspiciousLinks:d,googleMapsDoNotAuth:d,googleMapsKeyless:d,finalLiveLocation:d,statusRanking:d,stickers:d,frequentlyForwardedMessages:d,frequentlyForwardedGroupSetting:d},B=function(e){function t(){var e,i,a,n;(0,v["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,b["default"])(this,(e=t.__proto__||(0,p["default"])(t)).call.apply(e,[this].concat(s))),a.gifSearch=(0,k.prop)(I["default"].SHOW_GIF_SEARCH),a.imageMaxEdge=(0,k.prop)(I["default"].IMG_MAX_EDGE),a.imageMaxKBytes=(0,k.prop)(I["default"].IMG_MAX_BYTES),a.maxParticipants=(0,k.prop)(I["default"].MAX_GROUP_SIZE),a.maxSubject=(0,k.prop)(I["default"].MAX_SUBJECT_LENGTH),a.media=(0,k.prop)(I["default"].MAX_MEDIA_UPLOAD_SIZE),a.maxFileSize=(0,k.prop)(I["default"].MAX_FILE_SIZE),a.notificationQuery=(0,k.prop)(I["default"].USE_NOTIFICATION_QUERY),a.groupDescLength=(0,k.prop)(I["default"].GROUP_DESCRIPTION_LENGTH),a.restrictGroups=(0,k.prop)(I["default"].GROUPS_V3_RESTRICT_GROUPS),a.announceGroups=(0,k.prop)(I["default"].GROUPS_V3_ANNOUNCE_GROUPS),a.groupsV3=(0,k.prop)(I["default"].GROUPS_V3),a.fwdUiStartTs=(0,k.prop)(I["default"].FWD_UI_START_TS),a.googleMapsDoNotAuth=(0,k.prop)(I["default"].GOOGLE_MAPS_DO_NOT_AUTH),a.googleMapsKeyless=(0,k.prop)(I["default"].GOOGLE_MAPS_KEYLESS),a.suspiciousLinks=(0,k.prop)(I["default"].SUSPICIOUS_LINKS),a.finalLiveLocation=(0,k.prop)(I["default"].FINAL_LIVE_LOCATION),a.statusRanking=(0,k.prop)(I["default"].STATUS_RANKING),a.stickers=(0,k.prop)(I["default"].STICKERS),a.multicastLimitGlobal=(0,k.prop)(I["default"].MAX_FORWARD_COUNT_GLOBAL),a.frequentlyForwardedMessages=(0,k.prop)(I["default"].FREQUENTLY_FORWARDED_MESSAGES),a.frequentlyForwardedThreshold=(0,k.prop)(I["default"].FREQUENTLY_FORWARDED_THRESHOLD),a.frequentlyForwardedMax=(0,k.prop)(I["default"].FREQUENTLY_FORWARDED_MAX),a.frequentlyForwardedGroupSetting=(0,k.prop)(I["default"].FREQUENTLY_FORWARDED_GROUP_SETTING),a.wsOverride=(0,k.prop)(void 0),a.wsOverrideAttempts=(0,k.prop)(0),a.wsOverrideTimeout=(0,k.prop)(void 0),a.webRestoreFromCache=(0,k.prop)(I["default"].WEB_RESTORE_FROM_CACHE),n=i,(0,b["default"])(a,n)}return(0,C["default"])(t,e),(0,m["default"])(t,[{key:"delete",value:function(){(0,E["default"])(t.prototype.__proto__||(0,p["default"])(t.prototype),"delete",this).call(this),this.updateProps({})}},{key:"set",value:function(e,i,a){var n=this;if("string"==typeof e)"webRestoreFromCache"===e&&this.saveResumeProp(i),(0,w.setServerPropInElectron)(e,i);else{var r=e,s=i,o=s&&s.merge?j["default"].omitBy(r,j["default"].isUndefined):r;(0,f["default"])(o).forEach(function(e){var t=(0,l["default"])(e,2),i=t[0],a=t[1];return"webRestoreFromCache"===i&&n.saveResumeProp(a),(0,w.setServerPropInElectron)(i,a)})}return(0,E["default"])(t.prototype.__proto__||(0,p["default"])(t.prototype),"set",this).call(this,e,i,a)}},{key:"updateProps",value:function(e){var t=this;N["default"].Global.webcBucket=e.bucket||null,this.__props.forEach(function(i){var a=e[i];"undefined"==typeof a?a=t.getDefault(i):Y[i]&&(a=Y[i](a),"undefined"==typeof a&&(a=t.getDefault(i))),t.set(i,a)});for(var i in x["default"].F)"undefined"!=typeof e[i]&&x["default"].setFeature(i,e[i])}},{key:"handlePayload",value:function(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}},{key:"handle",value:function(e){var t=e.shift();this.handlePayload(t)}},{key:"fetch",value:function(){return F["default"].queryServerProps().then(this.handlePayload.bind(this))}},{key:"saveResumeProp",value:function(e){e!==P.INIT&&D["default"].setWebRestoreFromCache(e)}},{key:"loadResumeProp",value:function(){var e=D["default"].getWebRestoreFromCache();"boolean"==typeof e&&(this.webRestoreFromCache=e)}}]),t}(A["default"]);B.Proxy="serverProps";var V=(0,k.defineModel)(B);t["default"]=new V({id:"1"})},'"dfcdjadaii"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"cdfdhedgig"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"bgafgbafci"'),y=a(m),b=i('"bdcdfifjcj"'),T=a(b),E=i('"bjjbbjfiee"'),M=a(E),C=i('"bidieaecca"'),S=a(C),j=i('"dafgbfehgf"'),k=a(j),A=i('"djdcdaecea"'),P=a(A),w=i('"cehbbagije"'),O=a(w),I=function(e){function t(){(0,u["default"])(this,t);var e=(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return e.syncPromise=null,e.isSynced=!1,e.listenTo(k["default"],"change:stream",function(){k["default"].stream===j.STREAM.DISCONNECTED&&(e.isSynced=!1)}),e}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"onResume",value:function(){this.isSynced=!1,this.sync()}},{key:"maySync",value:function(){return P["default"].supportsFeature(P["default"].F.STARRED_GIFS)}},{key:"sync",value:function(){var e=this;return this.isSynced?r["default"].resolve():this.syncPromise?this.syncPromise:this.maySync()?(this.syncPromise=S["default"].getStarred(void 0,void 0,void 0,!0).then(function(t){var i=[];t&&t.length&&(i=y["default"].filter(t,function(e){return e&&e.isGif&&!e.isUnsentMedia})),e.set(i)})["catch"](function(e){499!==e&&O["default"].error("starred gif msgs sync error: ",e)()})["finally"](function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):r["default"].resolve()}},{key:"add",value:function(e,i){var a=this;if(!e||!this.maySync()||!this.isSynced)return[];var n=this.isModel(e)?[e]:e;return n=y["default"].filter(n,function(e){return e.isGif&&!a.get(e)}),(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"add",this).call(this,n,i)}},{key:"remove",value:function(e,i){var a=this;if(!e||!this.maySync()||!this.isSynced)return[];var n=this.isModel(e)?[e]:e;return n=y["default"].filter(n,function(e){return e.isGif&&a.get(e)}),(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"remove",this).call(n,i)}}]),t}(T["default"]);I.model=M["default"],I.comparator=function(e,t){return t.t-e.t},e.exports=new I},'"ifeajjdda"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){D.add(e),T["default"].forEach(e,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),L["default"].add(e)}function r(e){D.remove(e),e.forEach(function(e){e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}),L["default"].remove(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=void 0;var s=i('"cdehffajbd"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"cfcbddfj"'),h=a(f),p=i('"dfhdhdbidh"'),g=a(p),v=i('"cdfdhedgig"'),_=a(v),m=i('"bejijbfaij"'),y=a(m);t.addStarredMsgs=n,t.removeStarredMsgs=r;var b=i('"bgafgbafci"'),T=a(b),E=i('"bjjbbjfiee"'),M=a(E),C=i('"bidieaecca"'),S=a(C),j=i('"dafgbfehgf"'),k=a(j),A=i('"cehbbagije"'),P=a(A),w=i('"deijabejja"'),O=a(w),I=i('"dfcdjadaii"'),L=a(I),N=i('"bdcdfifjcj"'),R=a(N),D=void 0,G=t.StarredMsgCollection=function(e){function t(){(0,c["default"])(this,t);var e=(0,g["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this));return e.syncPromise=null,e.isSynced=!1,e.listenTo(k["default"],"change:stream",function(){k["default"].stream===j.STREAM.DISCONNECTED?e.isSynced=!1:k["default"].stream===j.STREAM.CONNECTED&&e["delete"]()}),e}return(0,y["default"])(t,e),(0,h["default"])(t,[{key:"process",value:function(e,t,i,a){a?this["delete"]():this.updateMsgs(e,t,i)}},{key:"sync",value:function(e){if(this.isSynced)return o["default"].resolve();if(this.syncPromise)return this.syncPromise;var t=this,i=void 0,a=this.last();return a&&(i=a.id),this.syncPromise=S["default"].getStarred(e,O["default"].PAGE_SIZE,i).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<O["default"].PAGE_SIZE&&(t.isSynced=!0)})["catch"](function(e){P["default"].error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null,t.trigger("sync")}),this.trigger("sync"),this.syncPromise}},{key:"updateMsgs",value:function(e,t,i){var a=this,n=this.syncPromise||o["default"].resolve();this.syncPromise=n.then(function(){if(e){var n=t.length>0?S["default"].incrementalStarredUpdate(t):o["default"].resolve([]);return n.then(function(e){var t=e.concat(i);a.isSynced&&(a.add(t,{silent:!0}),L["default"].add(e)),T["default"].forEach(t,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),a.trigger("sync")})["catch"](function(e){P["default"].error("models:starred:update:error: ",e)()})}var s=t.concat(i).filter(function(e){return!e.star});return r(s),o["default"].resolve()})["finally"](function(){a.syncPromise=null})}},{key:"delete",value:function(){this.isSynced=!1,(0,_["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"delete",this).call(this)}}]),t}(R["default"]);G.model=M["default"],G.comparator=function(e,t){return t.t-e.t},D=new G,t["default"]=D},'"cjabgbehf"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=a(f),p=i('"bafjcjabca"'),g=a(p),v=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,f.prop)(),a.status=(0,f.prop)(),a.stale=(0,f.session)(!0),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h["default"]);v.Collection="Status",v.Proxy="status",v.idClass=g["default"],t["default"]=(0,f.defineModel)(v);
},'"bbfdbjiiha"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"bejijbfaij"'),v=n(g),_=i('"ciehgcaebf"'),m=i('"fhabbhhjc"'),y=n(m),b=i('"jfefjijii"'),T=n(b),E=i('"biafgdghfb"'),M=a(E),C=i('"cehbbagije"'),S=n(C),j=i('"bgaddigcjb"'),k=n(j),A=i('"cjabgbehf"'),P=n(A),w=i('"fccadfdfc"'),O=i('"bdcdfifjcj"'),I=n(O),L=i('"dgfhfgbdeb"'),N=n(L),R=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).apply(this,arguments))}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.hasObservers()}).forEach(function(t){e.find(t.id)["catch"](M.WapDrop,function(){})})}},{key:"_find",value:function(e){var t=this,i=N["default"].statusFind(e).then(function(i){var a={id:e};if((0,w.isNumber)(i.status))switch(i.status){case 429:a.stale=!0;var n=t.get(e);n&&!(0,w.isString)(n.status)&&(a.status="");break;default:a.status=""}else a.status=i.status;return a})["catch"](M.WapDrop,function(){return{id:e,stale:!0,status:""}});return i}},{key:"_handle",value:function(e){return e}},{key:"setMyStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments[1];if(t=t.trim(),!t)return s["default"].reject(new M.ActionError);var a=N["default"].sendSetStatus(t),n=new _.ActionType(l10n.t("action_status_setting")),r=this.assertGet(T["default"].me).status;i=i||(0,_.genId)();var o=a.then(function(t){return 200===t.status?new _.ActionType(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,r,i)):t.status>=400?new _.ActionType(l10n.t("action_status_set_failed")):void 0})["catch"](function(a){throw S["default"].error("models:statusCollection:setMyStatus dropped")(a),new _.ActionType(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,i))});return y["default"].openToast(k["default"].createElement(_.ActionToast,{id:i,initialAction:n,pendingAction:o})),a.then(function(i){200!==i.status||i._duplicate||(e.assertGet(T["default"].me).status=t)})}}]),t}(I["default"]);R.model=P["default"],R.staleCollection=!0,R.resumeOnAvailable=!0,t["default"]=new R},'"dijbefcfhi"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=O["default"].findLast(e,function(e){return e.body&&e.mediaData&&(e.type===S["default"].MSG_TYPE.IMAGE||e.type===S["default"].MSG_TYPE.VIDEO)});return t&&t.mediaData.preview}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=a(r),o=i('"ddcedhgjff"'),d=a(o),u=i('"ebfebbhae"'),l=a(u),c=i('"cfcbddfj"'),f=a(c),h=i('"dfhdhdbidh"'),p=a(h),g=i('"cdfdhedgig"'),v=a(g),_=i('"bejijbfaij"'),m=a(_),y=i('"bebcachjfd"'),b=i('"cjgfdijdhj"'),T=a(b),E=i('"cggjbbfigd"'),M=a(E),C=i('"deijabejja"'),S=a(C),j=i('"cehbbagije"'),k=a(j),A=i('"dgfhfgbdeb"'),P=a(A),w=i('"bgafgbafci"'),O=a(w),I=i('"jidadafab"'),L=a(I),N=i('"cbgefcdega"'),R=a(N),D=i('"bafjcjabca"'),G=a(D),F=86400,U=1e3,x=function(e){function t(){var e,i,a,n;(0,l["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,p["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,y.prop)(),a.t=(0,y.prop)(),a.unreadCount=(0,y.prop)(0),a.totalCount=(0,y.prop)(0),a.score=(0,y.prop)(),a.pic=(0,y.prop)(),a._msgs=(0,y.prop)(function(){return[]}),a.readKeys=(0,y.session)(function(){return{}}),a.contact=(0,y.session)(),a.expireTimer=(0,y.session)(),a.expireTs=(0,y.session)(),a.hasUnread=(0,y.derived)(a._hasUnread,["unreadCount"]),a.readCount=(0,y.derived)(a._readCount,["unreadCount","totalCount"]),a.renderedThumbnail=(0,y.derived)(a._renderedThumbnail,["msgsChanged","pic","totalCount"]),a.lastStatus=(0,y.derived)(a._lastStatus,["msgsChanged","totalCount"]),n=i,(0,p["default"])(a,n)}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"_hasUnread",value:function(){return this.unreadCount>0}},{key:"_readCount",value:function(){var e=this.totalCount-this.unreadCount;return O["default"].isFinite(e)?e:(k["default"].error("Bad status v3 read count, "+this.totalCount+", "+this.unreadCount)(),0)}},{key:"_renderedThumbnail",value:function(){return this.msgs.length===this.totalCount?n(this.msgs.getModelsArray()):this.pic?this.pic:n(this.msgs.getModelsArray())}},{key:"_lastStatus",value:function(){return this.msgs.last()}},{key:"initialize",value:function(){var e=this;(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"initialize",this).call(this),this.addChild("contact",T["default"].gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",function(){window.setTimeout(function(){e.setupStatusExpiration()})}),this.listenTo(this,"change:lastStatus",function(){e.lastStatus&&(e.t=e.lastStatus.t)})}},{key:"setupStatusExpiration",value:function(){var e=this,t=this.msgs.at(0);if(t&&!("number"==typeof this.expireTs&&this.expireTs<=t.t)){var i=1,a=t.t+F+i;a<L["default"].globalUnixTime()?window.setTimeout(function(){e.expireMsg()}):(this.expireTimer=R["default"].setGlobalTimeout(this.expireMsg.bind(this),a*U,this.expireTimer),this.expireTs=t.t)}}},{key:"expireMsg",value:function(){for(var e=this.msgs;e.length>0;){var t=e.at(0);if(!t)break;if(t.t+F>L["default"].globalUnixTime())break;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,e.remove(t),t["delete"]()}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}},{key:"delete",value:function(){k["default"].log("Status v3 deleted with total count: "+this.totalCount)(),(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),this.expireTimer&&R["default"].clearTimeout(this.expireTimer),this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}},{key:"onEmptyMRM",value:function(){var e=this;return k["default"].log("Status V3 onEmptyMRM with total count: "+this.totalCount+", noEarlierMsgs: "+(this.msgs.msgLoadState.noEarlierMsgs?"true":"false"))(),this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?void this["delete"]():void(this.totalCount>0&&this.loadMore()["catch"](function(){})["finally"](function(){e.msgs.length||e["delete"]()}))}},{key:"loadMore",value:function(e){var t=this;if(this.msgs.msgLoadState.noEarlierMsgs)return s["default"].resolve();if(this.msgs.msgLoadState.isLoadingEarlierMsgs)return this.msgs.loadEarlierPromise;var i=e||S["default"].PAGE_SIZE,a=this.getCollection();return a.loadMore(this.id,i,this.msgs.last()).then(function(e){return Array.isArray(e)&&e.length<i&&(t.msgs.msgLoadState.noEarlierMsgs=!0),e})["catch"](function(e){return 404===e&&t["delete"](),s["default"].reject(e)})}},{key:"handleReadStatus",value:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}},{key:"sendReadStatus",value:function(e,t){var i=this;return P["default"].sendStatusSeen(e,t).then(function(t){200===t.status&&i.handleReadStatus(e)})}},{key:"sendMute",value:function(e){var t=this;return P["default"].sendStatusMute(this.id,e).then(function(i){200===i.status&&(t.contact.statusMute=e)})}}]),t}(M["default"]);x.Collection="StatusV3",x.Proxy="statusV3",x.idClass=G["default"],t["default"]=(0,y.defineModel)(x)},'"bhgjfefcea"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i('"cdehffajbd"'),s=n(r),o=i('"ddcedhgjff"'),d=n(o),u=i('"ebfebbhae"'),l=n(u),c=i('"cfcbddfj"'),f=n(c),h=i('"dfhdhdbidh"'),p=n(h),g=i('"cdfdhedgig"'),v=n(g),_=i('"bejijbfaij"'),m=n(_),y=i('"bgafgbafci"'),b=n(y),T=i('"bdcdfifjcj"'),E=n(T),M=i('"jfefjijii"'),C=n(M),S=i('"deijabejja"'),j=n(S),k=i('"biafgdghfb"'),A=a(k),P=i('"cehbbagije"'),w=n(P),O=i('"bidieaecca"'),I=n(O),L=i('"dijbefcfhi"'),N=n(L),R=i('"dgfhfgbdeb"'),D=n(R),G=i('"jidadafab"'),F=n(G),U=i('"cfddajhbjb"'),x=n(U),Y=i('"gggdaifb"'),B=i('"bjhdjifgah"'),V=n(B),q=i('"djdcdaecea"'),H=n(q),W=i('"dacbaddbce"'),K=n(W),z=86400,Q=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,d["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,f["default"])(t,[{key:"delete",value:function(){(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"_find",value:function(e){return s["default"].resolve({id:e})}},{key:"findQuery",value:function(e,i){var a=this;return(0,v["default"])(t.prototype.__proto__||(0,d["default"])(t.prototype),"findQuery",this).call(this,e,i).then(function(e){return s["default"].all(e.map(function(e){if(e){var t=0;return e.msgs.forEach(function(i){t<e._msgs.length&&e._msgs[t].id.toString()===i.id.toString()?++t:i["delete"]()}),e._msgs.length>0?a.addStatusMessages(e.id,e._msgs):s["default"].resolve()}})).then(function(){return e})})}},{key:"_findQuery",value:function(e){var t=this;return D["default"].statusQuery().then(function(e){return t.checksum=e.checksum,s["default"].map(e.statuses,function(e){e.totalCount!==e._msgs.length&&e.totalCount<=20&&w["default"].warn("Received "+e._msgs.length+" status V3 messages when total count is "+e.totalCount+" for "+e.id)();var t=e.pic;return t?x["default"].createFromData(t,"image/jpeg").then(function(t){return e.pic=t,e}):e})})}},{key:"loadMore",value:function(e,t,i){return D["default"].statusQuery(e,t,i&&i.id,"after").then(function(e){return e.status>=400?(w["default"].error("model:statusv3:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.forEach(function(e){e.invis=!0}),w["default"].log("model:statusv3:loadMore:"+e.length)(),I["default"].processMultipleMessages((0,Y.createWid)(j["default"].STATUS_WID),e,{add:"after",isHistory:!0}))})}},{key:"sync",value:function(e){var t=this,i=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()})["catch"](A.WapDrop,function(){})["finally"](function(){t.trigger("sync")}).tap(function(e){var a=window.performance.now(),n=Math.round(a-i);t.logMetrics({type:"sync",syncTime:n}),t.forEach(function(e){e.msgs.length>e.totalCount&&w["default"].log("Total count: "+e.totalCount+", msgs length: "+e.msgs.length)()})}):s["default"].resolve(void 0)}},{key:"logMetrics",value:function(e){var t=void 0;t="sync"===e.type?new K["default"].WebcStatusSync({webcStatusSyncT:e.syncTime}):new K["default"].WebcStatusSession({webcStatusSessionId:e.sessionId});var i=this.filter(function(e){return!e.contact.isMe}),a=i.filter(function(e){return!e.contact.statusMute}),n=a.filter(function(e){return e.hasUnread}),r=a.filter(function(e){return!e.hasUnread}),s=i.filter(function(e){return e.contact.statusMute}),o=b["default"].sum(a.map(function(e){return e.unreadCount})),d=b["default"].sum(a.map(function(e){return e.readCount})),u=b["default"].sum(s.map(function(e){return e.totalCount}));t.webcStatusRecentItemCount=o,t.webcStatusRecentRowCount=n.length,t.webcStatusViewedItemCount=d,t.webcStatusViewedRowCount=r.length,t.webcStatusMutedItemCount=u,t.webcStatusMutedRowCount=s.length,t.commit()}},{key:"hasSynced",value:function(){return!!this.checksum}},{key:"handleUpdate",value:function(e,t,i){var a=e.id.fromMe?C["default"].me:e.author;if(this.updateChecksum(t),this.hasSynced()){if(i)return!0;var n=this.get(a);if(n){var r=n.totalCount===n.msgs.length;if("revoke"===e.subtype){var s=b["default"].take(n.msgs.toArray(),n.totalCount-n.unreadCount),o=b["default"].map(s,function(e){return e.id.toString()}),d={totalCount:n.totalCount-1};b["default"].find(o,function(t){return t===e.protocolMessageKey.toString()})||n.readKeys[e.protocolMessageKey.toString()]||(d.unreadCount=n.unreadCount-1),n.set(d)}else{var u={totalCount:n.totalCount+1};e.invis||(u.unreadCount=n.unreadCount+1),u.t=e.t,n.set(u)}return!r&&e.body&&x["default"].createFromBase64Jpeg(e.body).then(function(e){n.pic=e}),r}return this.add({id:a,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}},{key:"handleScore",value:function(e,t){var i=this.get(e);i?i.score=t:w["default"].log("models:statusV3:score:no_status:"+[e,t].join())()}},{key:"updateChecksum",value:function(e){e?this.hasSynced()&&(this.checksum=e):w["default"].info("models:statusV3:no_checksum")()}},{key:"handle",value:function(e){var t=e.shift();if(Array.isArray(t))w["default"].warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var i=this.get(t.chat);i?i.handleReadStatus(t.key):w["default"].log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":break;case"score":for(var a=0;a<t.scores.length;a++){var n=t.scores[a],r=n.jid,s=n.score;this.handleScore(r,s)}this.sort();break;default:w["default"].warn("models:statusV3:unknown:"+t.type,t)()}}},{key:"addStatusMessages",value:function(e,t){return I["default"].processMultipleMessages((0,Y.createWid)(j["default"].STATUS_WID),t,{add:"after",isHistory:!0})}},{key:"getUnexpired",value:function(e){var t=this.filter(function(e){return e.totalCount>0&&F["default"].globalUnixTime()-e.t<=z&&e.contact.isMyContact&&!e.contact.isMe});if(e){var i=b["default"].filter(t,function(e){return e.unreadCount>0});return i}var a=b["default"].filter(t,function(e){return 0===e.unreadCount});return a}},{key:"getMyStatus",value:function(){var e=this.filter(function(e){return e.contact.isMe});return b["default"].isEmpty(e)?void 0:F["default"].globalUnixTime()-e[0].t>z?void 0:e[0]}}]),t}(E["default"]);Q.model=N["default"],Q.comparator=function(e,t){return V["default"].statusRanking&&H["default"].supportsFeature(H["default"].F.STATUS_RANKING)&&e.score!==t.score?t.score-e.score:t.t-e.t},t["default"]=new Q},'"bgbdjhhacc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"dfhdhdbidh"'),u=a(d),l=i('"bejijbfaij"'),c=a(l),f=i('"bebcachjfd"'),h=i('"dcdebajfjb"'),p=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),l=0;l<s;l++)d[l]=arguments[l];return i=a=(0,u["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.weight=(0,f.prop)(),n=i,(0,u["default"])(a,n)}return(0,c["default"])(t,e),t}(h.Sticker);p.Proxy="recentSticker",t["default"]=(0,f.defineModel)(p)},'"debfbgiegd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"cdehffajbd"'),r=a(n),s=i('"ddcedhgjff"'),o=a(s),d=i('"ebfebbhae"'),u=a(d),l=i('"cfcbddfj"'),c=a(l),f=i('"dfhdhdbidh"'),h=a(f),p=i('"cdfdhedgig"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"djdcdaecea"'),y=a(m),b=i('"bgbdjhhacc"'),T=a(b),E=i('"daefjfgdad"'),M=a(E),C=i('"dgfhfgbdeb"'),S=a(C),j=function(e){function t(){return(0,u["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"_findQuery",value:function(){return y["default"].supportsFeature(y["default"].F.RECENT_STICKERS)?S["default"].queryRecentStickers(this.dirty?this._getWeights():void 0):r["default"].reject("gk recent sticker sync unsupported")}},{key:"_getWeights",value:function(){return this.map(function(e){var t=e.filehash,i=e.weight;return{filehash:t,weight:i.toString()}})}},{key:"throttledSync",value:function(){y["default"].supportsFeature(y["default"].F.RECENT_STICKERS)&&(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"throttledSync",this).call(this)}},{key:"increment",value:function(e){y["default"].supportsFeature(y["default"].F.RECENT_STICKERS)&&(this.get(e.id)||this.add({weight:0,id:e.id,clientUrl:e.clientUrl,directPath:e.directPath,filehash:e.filehash,uploadhash:e.uploadhash,mediaKey:e.mediaKey,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:e.index}),(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"_updateWeights",this).call(this,e.id))}}]),t}(M["default"]);j.model=T["default"],j.modelName="RecentSticker",t["default"]=new j},'"dcdebajfjb"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){return new j({id:"placeholder-"+e,isPlaceholder:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.Sticker=void 0;var s=i('"ddcedhgjff"'),o=n(s),d=i('"ebfebbhae"'),u=n(d),l=i('"cfcbddfj"'),c=n(l),f=i('"dfhdhdbidh"'),h=n(f),p=i('"cdfdhedgig"'),g=n(p),v=i('"bejijbfaij"'),_=n(v),m=i('"bebcachjfd"'),y=n(m),b=i('"djeidhfjae"'),T=a(b),E=i('"bidbcdddff"'),M=n(E),C=i('"dedbghciih"'),S=t.Sticker=function(e){function t(){var e,i,a,n;(0,u["default"])(this,t);for(var r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];return i=a=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(s))),a.id=(0,m.prop)(),a.mediaData=(0,m.session)(),a._mediaObject=(0,m.prop)(),a.clientUrl=(0,m.prop)(),a.directPath=(0,m.prop)(),a.filehash=(0,m.prop)(),a.height=(0,m.prop)(),a.index=(0,m.prop)(),a.mediaKey=(0,m.prop)(),a.mimetype=(0,m.prop)(),a.size=(0,m.prop)(),a.type=(0,m.prop)(C.OUTWARD_TYPES.STICKER),a.uploadhash=(0,m.prop)(),a.width=(0,m.prop)(),a.isPlaceholder=(0,m.prop)(),n=i,(0,h["default"])(a,n)}return(0,_["default"])(t,e),(0,c["default"])(t,[{key:"initialize",value:function(){(0,g["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"initialize",this).call(this),this.addChild("mediaData",new M["default"]),this.isPlaceholder||T.registerSticker(this)}},{key:"downloadMedia",value:function(){return T.downloadStickerOrStickerPackIcon(this)}},{key:"sendToChat",value:function(e){i('"debfbgiegd"')["default"].increment(this),this.mediaData.mediaBlob.retain();var t={quotedMsg:e.composeQuotedMsg};return e.composeQuotedMsg=null,(0,b.prepSticker)(this).sendToChat(e,t)}}]),t}(y["default"]);S.Proxy="sticker",S.createPlaceholder=r;var j=(0,m.defineModel)(S);t["default"]=j,j.createPlaceholder=r},'"djbjahehie"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollection=t.FETCH_STATE=void 0;var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"bejijbfaij"'),h=a(f),p=i('"bdcdfifjcj"'),g=a(p),v=i('"dcdebajfjb"'),_=a(v),m=(t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"},t.StickerCollection=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,u["default"])(t,[{key:"fetch",value:function(e){throw new Error(this.constructor.name+".fetch is not implemented")}}]),t}(g["default"]));m.model=_["default"],t["default"]=new m},'"bbfjiigige"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=e.index,i=e.page;return new k({id:""+C+t,index:t,page:i})}Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPack=void 0;var r=i('"ddcedhgjff"'),s=a(r),o=i('"ebfebbhae"'),d=a(o),u=i('"cfcbddfj"'),l=a(u),c=i('"dfhdhdbidh"'),f=a(c),h=i('"cdfdhedgig"'),p=a(h),g=i('"bejijbfaij"'),v=a(g),_=i('"bebcachjfd"'),m=a(_),y=i('"bejfdcbhbc"'),b=a(y),T=i('"dedbghciih"'),E=i('"bidbcdddff"'),M=a(E),C="placeholder:",S="image/png",j=t.StickerPack=function(e){function t(){var e,i,a,n;(0,d["default"])(this,t);for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a=(0,f["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(o))),a.id=(0,_.prop)(),a.index=(0,_.prop)(),a.name=(0,_.prop)(),a.page=(0,_.prop)(),a.url=(0,_.prop)(),a.mimetype=(0,_.prop)(S),a.mediaData=(0,_.session)(),a._mediaObject=(0,_.prop)(),a.directPath=(0,_.prop)(),a.filehash=(0,_.prop)(),a.mediaKey=(0,_.prop)(),a.size=(0,_.prop)(),a.type=(0,_.prop)(T.OUTWARD_TYPES.STICKER_PACK),a.uploadhash=(0,_.prop)(),a.clientUrl=(0,_.derived)(a._clientUrl,["url","isFirstParty"]),a.stickers=(0,_.derived)(a._getStickersCollection,["id"]),a.isPlaceholder=(0,_.derived)(a._isPlaceholder,["id"]),a.isFirstParty=(0,_.derived)(a._isFirstParty,["url","mediaKey"]),n=i,(0,f["default"])(a,n)}return(0,v["default"])(t,e),(0,l["default"])(t,[{key:"_clientUrl",value:function(){return this.isFirstParty?"":this.url}},{key:"_isPlaceholder",value:function(){return t.isPlaceholderId(this.id)}},{key:"_isFirstParty",value:function(){return Boolean(this.url)&&!this.mediaKey}},{key:"_getStickersCollection",value:function(){return this._stickers=this._stickers||new b["default"](this.id.split("#")[0]),this._stickers}},{key:"initialize",value:function(){(0,p["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"initialize",this).call(this),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new M["default"]({renderableUrl:""})),i('"djeidhfjae"').registerStickerPackIcon(this))}},{key:"downloadMedia",value:function(){this.isPlaceholder||this.isFirstParty||i('"djeidhfjae"').downloadStickerOrStickerPackIcon(this)}}]),t}(m["default"]);j.Proxy="stickerPack",j.createPlaceholder=n,j.isPlaceholderId=function(e){return new RegExp("^"+C).test(e)};var k=(0,_.defineModel)(j);t["default"]=k,k.createPlaceholder=n,k.isPlaceholderId=j.isPlaceholderId},'"hjcebdiai"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_FETCH_STATE=t.PAGE_SIZE=void 0;var n=i('"cjcbjjhead"'),r=a(n),s=i('"cdehffajbd"'),o=a(s),d=i('"dghibdgiba"'),u=a(d),l=i('"ddcedhgjff"'),c=a(l),f=i('"ebfebbhae"'),h=a(f),p=i('"cfcbddfj"'),g=a(p),v=i('"dfhdhdbidh"'),_=a(v),m=i('"cdfdhedgig"'),y=a(m),b=i('"bejijbfaij"'),T=a(b),E=i('"bgafgbafci"'),M=i('"bdcdfifjcj"'),C=a(M),S=i('"cehbbagije"'),j=a(S),k=i('"bbfjiigige"'),A=a(k),P=i('"dgfhfgbdeb"'),w=a(P);i('"bebcachjfd"');var O=t.PAGE_SIZE=9,I=t.PAGE_FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"},L=function(e){function t(){(0,h["default"])(this,t);var e=(0,_["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this));return e.checksum=null,e._pageFetchPromises={},e.pageFetchStates={},e._handleChecksumChange=function(t){(0,u["default"])(e.pageFetchStates).forEach(function(t){return e._resetFetchPageStateAndPromise(parseInt(t,10))}),e._resetRangeWithPlaceholders(0,e.length),e.fetchAt(0,!1,!0)},e.listenTo(e,"change:checksum",e._handleChecksumChange),e}return(0,T["default"])(t,e),(0,g["default"])(t,[{key:"createPlaceholder",value:function(e){return t.createPlaceholder(e)}},{key:"fetchAt",value:function(e,t,i){this._fetchPageWithIndex(e,Boolean(t),Boolean(i))}},{key:"hasFetchedData",value:function(){var e=this;return(0,u["default"])(this.pageFetchStates).some(function(t){return e.pageFetchStates[parseInt(t,10)]===I.SUCCESS})}},{key:"isFetchingData",value:function(){var e=this;return(0,u["default"])(this.pageFetchStates).some(function(t){return e.pageFetchStates[parseInt(t,10)]===I.PENDING})}},{key:"pageWithIndex",value:function(e){return t.pageWithIndex(e)}},{key:"reset",value:function(){var e=this;return this.setChecksum(null,{silent:!0}),(0,u["default"])(this.pageFetchStates).forEach(function(t){return e._resetFetchPageStateAndPromise(parseInt(t,10))}),(0,y["default"])(t.prototype.__proto__||(0,c["default"])(t.prototype),"reset",this).call(this)}},{key:"sync",value:function(e){this.setChecksum(e)}},{key:"setChecksum",value:function(e,t){if(this.checksum!==e){this.checksum=e;var i=t&&t.silent;return i||this.trigger("change:checksum",e),!0}return!1}},{key:"_fetchPageWithIndex",value:function(e,t,i){var a=this.pageWithIndex(e);return this._fetchPage(a,t,i)}},{key:"_fetchPage",value:function(e,t,i){var a=this,n=this.pageFetchStates[e],r=void 0;if(t&&n!==I.PENDING&&(r=this._pageFetchPromises[e],r&&(r.cancel(),delete this._pageFetchPromises[e])),r=this._pageFetchPromises[e])return r;var s=this.length;return this._insertPagePlaceholders(e),this._setFetchPageState(e,I.PENDING),this._pageFetchPromises[e]=w["default"].queryStickerPacks(e,O).cancellable().then(function(t){var n=a._parseStickerPacksRes(e,t),r=i||a.setChecksum(t.checksum,{silent:!0}),o=(e-1)*O,d=(e+0)*O;a._resetRange(o,d,n),r&&(a._resetRangeWithPlaceholders(0,o),a._resetRangeWithPlaceholders(Math.min(o+n.length,d),t.count));var u=a.length;s!==u&&a.trigger("change:length",u),a._setFetchPageState(e,I.SUCCESS)})["catch"](function(t){return t instanceof o["default"].CancellationError?(j["default"].log("StickerPack page fetch promise cancelled: "+e)(),void a._unsetFetchPageStateAndPromise(e)):void a._setFetchPageState(e,I.ERROR)}),this._pageFetchPromises[e]}},{key:"_insertPagePlaceholders",value:function(e){var t=e-1;this._resetRangeWithPlaceholders(t*O,(t+1)*O)}},{key:"_parseStickerPacksRes",value:function(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(function(t,i){return(0,r["default"])({},(0,E.pick)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"]),{uploadhash:t.encFilehash,page:e,index:(e-1)*O+i})})}},{key:"_resetRangeWithPlaceholders",value:function(e,i){this._resetRange(e,i,(0,E.times)(i-e,function(i){return t.createPlaceholder(e+i)}))}},{key:"_resetRange",value:function(e,t,i){var a=this;this._forEachInRange(e,t,function(t,n){var r=i[n-e];if(t)if(r)t.id===r.id?(a.remove(t,{silent:!0}),a.add(r)):(a.remove(t),a.add(r));else for(var s=t;s;)a.remove(s),s=a.at(n);else r&&a.add(r)})}},{key:"_forEachInRange",value:function(e,t,i){for(var a=e;a<t;a++){var n=this.at(a);i(n,a)}}},{key:"_resetFetchPageStateAndPromise",value:function(e){if(e in this.pageFetchStates){var t=this.pageFetchStates[e];t===I.PENDING?this._pageFetchPromises[e].cancel():this._unsetFetchPageStateAndPromise(e)}}},{key:"_setFetchPageState",value:function(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}},{key:"_unsetFetchPageState",value:function(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}},{key:"_unsetFetchPageStateAndPromise",value:function(e){delete this._pageFetchPromises[e],this._unsetFetchPageState(e)}}]),t}(C["default"]);L.model=A["default"],L.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},L.createPlaceholder=function(e){return A["default"].createPlaceholder({index:e,page:this.pageWithIndex(e)})},L.pageWithIndex=function(e){return Math.floor(e/O)+1},t["default"]=new L},'"bejfdcbhbc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.FETCH_STATE=void 0;var n=i('"cdehffajbd"'),r=a(n),s=i('"cjcbjjhead"'),o=a(s),d=i('"ddcedhgjff"'),u=a(d),l=i('"ebfebbhae"'),c=a(l),f=i('"cfcbddfj"'),h=a(f),p=i('"dfhdhdbidh"'),g=a(p),v=i('"bejijbfaij"'),_=a(v),m=i('"djbjahehie"');Object.defineProperty(t,"FETCH_STATE",{enumerable:!0,get:function(){return m.FETCH_STATE}});var y=i('"dgfhfgbdeb"'),b=a(y),T=i('"bgafgbafci"'),E=function(e){function t(e){var i;(0,c["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this));a._parseStickersRes=function(e){if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(function(e,t){return(0,o["default"])({},(0,T.pick)(e,["directPath","mimetype","mediaKey","filehash","width","height"]),{index:t,id:e.filehash,clientUrl:e.url,uploadhash:e.encFilehash})})},a.stickerPackId=e;var n=t._cache[a.stickerPackId];if(n)return i=n,(0,g["default"])(a,i);var r=void 0,s=a;return Object.defineProperty(a,"fetchState",{get:function(){return r},set:function(e){r!==e&&(r=e,s.trigger("change:fetchState",e))}}),a}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"fetch",value:function(e){var t=this;if(e&&this.fetchState!==m.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise)return this._fetchPromise;this.fetchState=m.FETCH_STATE.PENDING;var a=i('"bbfjiigige"')["default"];return a.isPlaceholderId(this.stickerPackId)?(this._fetchPromise=new r["default"](function(){}),this._fetchPromise):(this._fetchPromise=b["default"].queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes).then(function(e){var i=Math.max(t.length||e.length);t._resetRange(0,i,e),t.fetchState=m.FETCH_STATE.SUCCESS})["catch"](function(e){t.fetchState=m.FETCH_STATE.ERROR}),this._fetchPromise)}},{key:"_resetRange",value:function(e,t,i){var a=this;this._forEachInRange(e,t,function(t,n){var r=i[n-e];t?r?t.id===r.id?t.set(r):(a.remove(t),a.add(r)):a.remove(t):r&&a.add(r)})}},{key:"_forEachInRange",value:function(e,t,i){for(var a=e;a<t;a++){var n=this.at(a);i(n,a)}}}]),t}(m.StickerCollection);E._cache={},E.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},t["default"]=E},'"ebhdebaagj"':function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};t["default"]=i},'"djddhaidag"':function(e,t,i){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function r(){switch(Y["default"].state){case x.STATE.TIMEOUT:return ne.TIMEOUT;case x.STATE.OPENING:return U["default"].online?ne.OPENING:ne.OFFLINE;case x.STATE.PAIRING:return Y["default"].hasSynced?ne.RESUMING:ne.PAIRING;case x.STATE.CONNECTED:return Y["default"].stream!==x.STREAM.CONNECTED?Y["default"].hasSynced?ne.NORMAL:ne.SYNCING:ne.NORMAL;case x.STATE.UNLAUNCHED:case x.STATE.PROXYBLOCK:default:return ne.NORMAL}}function s(){if(!X["default"].knowsPhone()&&Y["default"].state!==x.STATE.PROXYBLOCK)return re.QR;var e=Y["default"].hasSynced;switch(Y["default"].state){case x.STATE.PROXYBLOCK:return re.PROXYBLOCK;case x.STATE.CONFLICT:return re.CONFLICT;case x.STATE.TOS_BLOCK:return re.TOS_BLOCK;case x.STATE.SMB_TOS_BLOCK:return re.SMB_TOS_BLOCK;case x.STATE.DEPRECATED_VERSION:return re.DEPRECATED_VERSION;case x.STATE.UNLAUNCHED:return re.SYNCING;case x.STATE.UNPAIRED_IDLE:case x.STATE.UNPAIRED:return re.QR;case x.STATE.OPENING:if(!U["default"].online&&!Y["default"].hasSynced)return re.OFFLINE;default:return e||Y["default"].stream===x.STREAM.CONNECTED?re.MAIN:re.SYNCING}}function o(e,t){switch(t){case se.SHOW:return e;case se.HIDE:return Y["default"].hasSynced?ne.NORMAL:ne.CONNECTING;case se.OBSCURE:switch(e){case ne.OPENING:case ne.PAIRING:case ne.SYNCING:case ne.RESUMING:return ne.CONNECTING;default:return e}default:return P["default"].error("Stream:unknown obscure level:",t)(),e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=void 0;var d=i('"cdehffajbd"'),u=n(d),l=i('"ccdjeafbhi"'),c=n(l),f=i('"djecddgbji"'),h=n(f),p=i('"ddcedhgjff"'),g=n(p),v=i('"ebfebbhae"'),_=n(v),m=i('"cfcbddfj"'),y=n(m),b=i('"dfhdhdbidh"'),T=n(b),E=i('"cdfdhedgig"'),M=n(E),C=i('"bejijbfaij"'),S=n(C),j=i('"deijabejja"'),k=n(j),A=i('"cehbbagije"'),P=n(A),w=i('"bebcachjfd"'),O=n(w),I=i('"dacbaddbce"'),L=n(I),N=i('"cbdjfefgci"'),R=n(N),D=i('"ebhdebaagj"'),G=n(D),F=i('"cjdjifdcai"'),U=n(F),x=i('"dafgbfehgf"'),Y=n(x),B=i('"biafgdghfb"'),V=a(B),q=i('"dgfhfgbdeb"'),H=n(q),W=i('"bgeabejhcc"'),K=n(W),z=i('"cjgcdjhhia"'),Q=n(z),J=i('"hcddbeaic"'),X=n(J),Z=i('"dhahhcccgb"'),$=n(Z),ee=i('"fhabbhhjc"'),te=n(ee),ie=i('"bgafgbafci"'),ae=n(ie),ne={OFFLINE:"OFFLINE",OPENING:"OPENING",PAIRING:"PAIRING",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTING:"CONNECTING",NORMAL:"NORMAL",TIMEOUT:"TIMEOUT"},re={QR:"QR",MAIN:"MAIN",
SYNCING:"SYNCING",OFFLINE:"OFFLINE",CONFLICT:"CONFLICT",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"};t.StreamInfo=ne,t.StreamMode=re;var se={SHOW:"SHOW",OBSCURE:"OBSCURE",HIDE:"HIDE"},oe=3e3,de=function(e){function t(){var e,i,a,n;(0,_["default"])(this,t);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=a=(0,T["default"])(this,(e=t.__proto__||(0,g["default"])(t)).call.apply(e,[this].concat(s))),a.info=(0,w.session)(ne.NORMAL),a.mode=(0,w.session)(re.SYNCING),a.obscurity=(0,w.session)(se.HIDE),a.needsUpdate=(0,w.session)(),a.clientExpired=(0,w.session)(!1),a.hardExpired=(0,w.session)(!1),a.couldForce=(0,w.session)(),a.uiActive=(0,w.session)(),a.available=(0,w.session)(!0),a.unavailableShiftTimer=(0,w.session)(),a.unavailableLogoutTimer=(0,w.session)(),a.unobscureShiftTimer=(0,w.session)(),a.timeoutEvent=(0,w.session)(),a.resumeCount=(0,w.session)(0),a.phoneAuthed=(0,w.session)(!1),a._waitForSocketPromise=(0,w.session)(),a._waitForSocketResolve=(0,w.session)(),a.displayInfo=(0,w.derived)(a._displayInfo,["info","obscurity"]),n=i,(0,T["default"])(a,n)}return(0,S["default"])(t,e),(0,y["default"])(t,[{key:"_displayInfo",value:function(){return o(this.info,this.obscurity)}},{key:"initialize",value:function(){var e=this;(0,M["default"])(t.prototype.__proto__||(0,g["default"])(t.prototype),"initialize",this).call(this),P["default"].log("Stream:rememberMe: "+String(X["default"].getRememberMe()))(),this.unavailableShiftTimer=new Q["default"](function(){return e.markUnavailable()}),this.unobscureShiftTimer=new Q["default"](function(){return e.unobscure()}),this.unavailableLogoutTimer=new Q["default"](function(){X["default"].getRememberMe()||(P["default"].log("Stream:unavailableLogoutTimer logout due to inactivity")(),Y["default"].logout())}),this.listenTo(Y["default"],"change:state change:stream change:hasSynced",this.onSocketUpdate),this.listenTo(U["default"],"change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",ae["default"].debounce(this.onSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(te["default"],"midnight",this.updateHardExpire.bind(this)),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}},{key:"delete",value:function(){}},{key:"handle",value:function(e){switch(e[0]){case"asleep":break;case"update":var t=e[2],i=void 0,a=void 0;"number"==typeof e[1]?a=e[1]:i=!!e[1],K["default"].update(t,i,a);break;case"killsw":K["default"].killServiceWorker();break;case"update_desktop":var n=(0,h["default"])(e,5),r=(n[0],n[1]),s=n[2],o=n[3],d=n[4],u=K["default"].activeVersion.lt(r)?(0,c["default"])(s,10):void 0,l=K["default"].activeVersion.lt(o);K["default"].update(void 0,l,u,d);break;case"desktop_manual_download":break;default:P["default"].error("Stream:handle unknown cmd "+e[0],e)()}}},{key:"markAvailable",value:function(){this.unavailableShiftTimer.cancel(),this.available=!0,R["default"].monitor(!0,this.displayInfo===ne.TIMEOUT)}},{key:"markUnavailable",value:function(e){e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1,R["default"].monitor(!1,this.displayInfo===ne.TIMEOUT))}},{key:"hasSocket",value:function(){return this.info===ne.NORMAL||this.info===ne.TIMEOUT}},{key:"waitForSocket",value:function(){var e=this;return this.hasSocket()?u["default"].resolve():this._waitForSocketPromise?this._waitForSocketPromise:this._waitForSocketPromise=new u["default"](function(t){e._waitForSocketResolve=t})}},{key:"onSelfUpdate",value:function(){P["default"].log("Stream:onSelfUpdate mode:"+this.mode+" info:"+this.info+" view:"+this.displayInfo)();var e=this.timeoutEvent;if(this.info===ne.TIMEOUT)e||(this.timeoutEvent=e=new L["default"].WebcPhoneDisconnected),this.displayInfo!==ne.TIMEOUT||this._bbarTime||(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();var t=this._bbarTime;t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null}this.hasSocket()&&this._waitForSocketResolve&&(this._waitForSocketResolve(),this._waitForSocketResolve=null,this._waitForSocketPromise=null)}},{key:"onSocketUpdate",value:function(){var e={},t=r();if(e.info=t,e.mode=s(),e.phoneAuthed=Y["default"].stream!==x.STREAM.DISCONNECTED,t===ne.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=se.HIDE;else if(t===ne.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=se.OBSCURE;else switch(this.obscurity){case se.HIDE:this.unobscureShiftTimer.onOrBefore(k["default"].DIAGNOSTIC_DELAY);break;case se.OBSCURE:this.unobscureShiftTimer.onOrBefore(oe);break;case se.SHOW:}this.set(e)}},{key:"unobscure",value:function(){this.obscurity=se.SHOW}},{key:"onPhoneAuthedUpdate",value:function(){this.phoneAuthed&&(this.sendAvailability(!0),G["default"].RecentEmoji.sync(),G["default"].RecentSticker.sync())}},{key:"onAvailableUpdate",value:function(){var e=this.available;P["default"].log("Stream:onAvailableUpdate user "+(e?"available":"unavailable"))(),e||X["default"].getRememberMe()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(k["default"].IDLE_TIMEOUT_WAIT),this.sendAvailability(!1)}},{key:"sendAvailability",value:function(e){(e||this.uiActive)&&(this.available?H["default"].sendPresenceAvailable()["catch"](V.WapDrop,function(){})["catch"](V.ProtoVersionUndefined,function(){}):H["default"].sendPresenceUnavailable()["catch"](V.WapDrop,function(){})["catch"](V.ProtoVersionUndefined,function(){}))}},{key:"updateCouldForce",value:function(){this.couldForce=!this.uiActive||!this.available&&document.hidden}},{key:"updateHardExpire",value:function(){K["default"].isExpired()&&(this.hardExpired=!0,K["default"].restart(!0))}},{key:"logPageResume",value:function(){this.info===ne.RESUMING&&(this.resumeCount++,new L["default"].WebcPageResume({webcResumeCount:this.resumeCount}).commit())}},{key:"updateWamLog",value:function(){var e=this.info===ne.NORMAL;R["default"].streamInfoChange(this.info,$["default"].numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}},{key:"logModeChange",value:function(){var e=void 0;e=this.mode===re.TOS_BLOCK||this.mode===re.SMB_TOS_BLOCK?L["default"].WEBC_STREAM_MODE_CODE.TOS_BLOCK:L["default"].WEBC_STREAM_MODE_CODE[this.mode],new L["default"].WebcStreamModeChange({webcStreamMode:e}).commit()}}]),t}(O["default"]);de.Proxy="stream";var ue=(0,w.defineModel)(de);t["default"]=new ue},'"cggjbbfigd"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i('"ddcedhgjff"'),r=a(n),s=i('"ebfebbhae"'),o=a(s),d=i('"cfcbddfj"'),u=a(d),l=i('"dfhdhdbidh"'),c=a(l),f=i('"cdfdhedgig"'),h=a(f),p=i('"bejijbfaij"'),g=a(p),v=i('"bgafgbafci"'),_=a(v),m=i('"bebcachjfd"'),y=a(m),b=i('"bhchacaadd"'),T=a(b),E=i('"cehbbagije"'),M=a(E),C=i('"eaafgdhhia"'),S=a(C),j=i('"jfefjijii"'),k=a(j),A=function(e){function t(){var e,i,a,n;(0,o["default"])(this,t);for(var s=arguments.length,d=Array(s),u=0;u<s;u++)d[u]=arguments[u];return i=a=(0,c["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(d))),a.id=(0,m.prop)(),a.pendingMsgs=(0,m.prop)(),a.labels=(0,m.prop)(),a.msgChunks=(0,m.session)(function(){return[]}),a.lastReceivedKey=(0,m.session)(),a.unreadMsgAnchor=(0,m.session)(),a.disableUnreadAnchor=(0,m.session)(),a.msgsLength=(0,m.session)(),a.msgsChanged=(0,m.session)(0),a.msgs=(0,m.collection)(T["default"]),n=i,(0,c["default"])(a,n)}return(0,g["default"])(t,e),(0,u["default"])(t,[{key:"initialize",value:function(){var e=this;(0,h["default"])(t.prototype.__proto__||(0,r["default"])(t.prototype),"initialize",this).call(this),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length}),k["default"].isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection))}},{key:"addLabelsToCollection",value:function(){(0,S["default"])(this.id.toString(),this.labels,"Chat")}},{key:"onEmptyMRM",value:function(){throw new Error("onEmptyMRM not implemented")}},{key:"delete",value:function(){(0,h["default"])(t.prototype.__proto__||(0,r["default"])(t.prototype),"delete",this).call(this),this.getAllCMCs().forEach(function(e){e.forEach(function(e){e["delete"]()}),e["delete"]()})}},{key:"removeMsg",value:function(e){var t=e.msgChunk;if(t){var i=t.indexOf(e);i<0||(M["default"].log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}}},{key:"getAllCMCs",value:function(){return this.msgChunks.concat([this.msgs])}},{key:"getAllMsgs",value:function(){return _["default"].flatten(this.getAllCMCs().map(function(e){return e.getModelsArray()}))}},{key:"replaceMsgsCollection",value:function(e){M["default"].info("model:Chat:replaceMsgsCollection:"+this.id.toString())();var t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=_["default"].without(this.msgChunks,e),e["delete"]()}},{key:"removeMsgsCollection",value:function(e){this.msgChunks=_["default"].without(this.msgChunks,e),e["delete"]()}},{key:"notifyMsgCollectionMerge",value:function(e,t,i,a){this.trigger("change:cmc:merge",e,t,i,a)}}]),t}(y["default"]);t["default"]=A},'"bgcgedafjc"':function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){switch(t.policy){case"LOAD":return new s["default"](e,t);case"IMMEDIATE":return new l["default"](e,t);case"NONE":return new d["default"](e,t)}return new d["default"](e,{id:"none",policy:"NONE"})}Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=void 0,t.createCachePolicy=n;var r=i('"decfihbfhb"'),s=a(r),o=i('"cgijadajjc"'),d=a(o),u=i('"cgeaahbffb"'),l=a(u),c=i('"bifijjbghd"');t.CACHE_POLICY_TYPE=c.CACHE_POLICY_TYPE}});